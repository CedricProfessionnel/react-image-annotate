(this["webpackJsonpreact-image-annotate"]=this["webpackJsonpreact-image-annotate"]||[]).push([[0],{301:function(e,t,a){e.exports=a(913)},723:function(e,t,a){},912:function(e,t,a){},913:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),i=a(15),r=a.n(i),l=a(918),s=a(279),c=a(950),d=Object(l.a)({container:{fontFamily:'"Inter", sans-serif'}}),g=Object(s.a)({typography:{fontFamily:'"Inter", "Roboto", sans-serif'},overrides:{MuiButton:{root:{textTransform:"none"}}}}),m=({children:e})=>{var t=d();return o.a.createElement(c.a,{theme:g},o.a.createElement("div",{className:t.container},e))},u=a(9),h=a(191),p=a(63),b=a(966),y=a(968),f=a(953),E=a(954),O=a(955),v=a(168),x=a.n(v),w=Object(l.a)({editBar:{padding:10,borderBottom:"1px solid #ccc",backgroundColor:"#f8f8f8",display:"flex",alignItems:"center","& .button":{margin:5}},select:{width:240,fontSize:14},contentArea:{padding:10},specificationArea:{padding:10}}),j=()=>{try{return JSON.parse(window.localStorage.getItem("customInput")||"{}")}catch(e){return{}}},I={"Simple Bounding Box":()=>({taskDescription:"Annotate each image according to this _markdown_ specification.",regionTagList:["has-bun"],regionClsList:["hotdog","not-hotdog"],enabledTools:["select","create-box"],images:[{src:"https://images.unsplash.com/photo-1496905583330-eb54c7e5915a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=634&q=80",name:"hot-dogs-1"},{src:"https://www.bianchi.com/wp-content/uploads/2019/07/YPB17I555K.jpg",name:"bianchi-oltre-xr4"}]}),"Simple Segmentation":()=>({taskDescription:"Annotate each image according to this _markdown_ specification.",regionClsList:["car","truck"],enabledTools:["select","create-polygon"],images:[{src:"https://images.unsplash.com/photo-1561518776-e76a5e48f731?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=750&q=80",name:"car-image-1"}]}),Custom:()=>j()},T=({onOpenAnnotator:e,lastOutput:t})=>{var a=w(),i=Object(n.useState)(),r=Object(u.a)(i,2),l=r[0],s=r[1],c=Object(n.useState)(window.localStorage.getItem("customInput")?"Custom":"Simple Bounding Box"),d=Object(u.a)(c,2),g=d[0],m=d[1],v=Object(n.useState)(!1),T=Object(u.a)(v,2),C=T[0],M=T[1],S=Object(n.useState)(JSON.stringify(I[g](),null,"  ")),N=Object(u.a)(S,2),k=N[0],A=N[1];return o.a.createElement("div",null,o.a.createElement("div",{className:a.editBar},o.a.createElement("h3",null,"React Image Annotate"),o.a.createElement("div",{style:{flexGrow:1}}),o.a.createElement("div",null,o.a.createElement("div",{style:{display:"inline-flex"}},o.a.createElement(p.default,{className:a.select,value:{label:g,value:g},options:Object.keys(I).map(e=>({label:e,value:e})),onChange:e=>{m(e.value),A(JSON.stringify("Custom"===e.value?j():I[e.value](),null,"  "))}})),o.a.createElement(h.a,{className:"button",disabled:!t,onClick:()=>M(!0)},"View Output"),o.a.createElement(h.a,{className:"button",variant:"outlined",disabled:Boolean(l),onClick:()=>{e("Custom"===g?j():I[g])}},"Open Annotator"))),o.a.createElement("div",{className:a.contentArea,style:l?{border:"2px solid #f00"}:{border:"2px solid #fff"}},o.a.createElement("div",null,o.a.createElement(x.a,{value:k,language:"javascript",onChange:e=>{try{window.localStorage.setItem("customInput",JSON.stringify(JSON.parse(e))),s(null)}catch(t){s(t.toString())}A(e)},width:"100%",height:"550px"}))),o.a.createElement("div",{className:a.specificationArea},o.a.createElement("h2",null,"React Image Annotate Format"),o.a.createElement(b.a,{language:"javascript"},'\n{\n  taskDescription?: string, // markdown\n  regionTagList?: Array<string>,\n  regionClsList?: Array<string>,\n  imageTagList?: Array<string>,\n  imageClsList?: Array<string>,\n  // all tools are enabled by default\n  enabledTools?: Array< "select" | "create-point" | "create-box" | "create-polygon">,\n  selectedImage?: string, // initial selected image\n  images: Array<{\n    src: string,\n    thumbnailSrc?: string, // use this if you are using high-res images\n    name: string,\n    regions?: Array<{\n      id: string | number,\n      cls?: string,\n      color?: string,\n      tags?: Array<string>,\n\n      // Point\n      type: "point",\n      x: number, // [0-1] % of image width\n      y: number, // [0-1] % of image height\n\n      // Bounding Box\n      type: "box",\n      x: number, // [0-1] % of image width\n      y: number, // [0-1] % of image height\n      w: number, // [0-1] % of image width\n      h: number, // [0-1] % of image height\n\n      // Polygon\n      type: "polygon",\n      open?: boolean, // should last and first points be connected, default: true\n      points: Array<[number, number]> // [0-1] % of image width/height\n    }>\n  }>,\n}\n')),o.a.createElement(y.a,{fullScreen:!0,open:C},o.a.createElement(f.a,null,"React Image Annotate Output"),o.a.createElement(E.a,{style:{minWidth:400}},o.a.createElement(x.a,{value:JSON.stringify(t,null,"  "),language:"javascript",width:"100%",height:"550px"})),o.a.createElement(O.a,null,o.a.createElement(h.a,{onClick:()=>M(!1)},"Close"))))},C=a(5),M=a(146),S=a(280),N=a(135),k=({mousePosition:e,x:t,y:a})=>{var i=Object(n.useState)(),r=Object(u.a)(i,2),l=(r[0],r[1]);return e&&(t=e.current.x,a=e.current.y),Object(n.useEffect)(()=>{if(e){var n=setInterval(()=>{t===e.current.x&&a===e.current.y||l([e.current.x,e.current.y])},10);return()=>clearInterval(n)}}),o.a.createElement(n.Fragment,null,o.a.createElement("div",{style:{position:"absolute",height:"100%",width:1,zIndex:10,backgroundColor:"#f00",left:t,pointerEvents:"none",top:0}}),o.a.createElement("div",{style:{position:"absolute",width:"100%",zIndex:10,height:1,backgroundColor:"#f00",top:a,pointerEvents:"none",left:0}}))},A=a(964),L=a(19),_=Object(S.a)("div")({"& > div":{width:"100%",height:"100%"}}),D=e=>{var t=e.children,a=Object(M.a)(e,["children"]),i=Object(n.useState)(!1),r=Object(u.a)(i,2),l=r[0],s=r[1],c=Object(L.a)(e=>{l||s(!0),a.onMouseMove&&a.onMouseMove(e)}),d=Object(L.a)(e=>{setTimeout(()=>{l&&s(!1)},100)});return o.a.createElement(_,Object.assign({},a,{onMouseMove:c,onMouseLeave:d}),o.a.createElement(A.a,{enabled:l,removeScrollBar:!1},t))},P=a(969),R=a(956),B=(e=1/0,t=1/0)=>{var a="undefined"!==typeof window,o=Object(P.a)({width:a?window.innerWidth:e,height:a?window.innerHeight:t}),i=Object(u.a)(o,2),r=i[0],l=i[1];return Object(n.useEffect)(()=>{if(a){var e=()=>{l({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}},[]),Object(R.a)(()=>{a&&(window.innerWidth===r.width&&window.innerHeight===r.height||l({width:window.innerWidth,height:window.innerHeight}))},100),r},W=({canvasEl:e,changeMat:t,changeDragging:a,zoomStart:o,zoomEnd:i,changeZoomStart:r,changeZoomEnd:l,layoutParams:s,zoomWithPrimary:c,dragWithPrimary:d,mat:g,onMouseMove:m,onMouseUp:u,onMouseDown:h,dragging:p})=>{var b=Object(n.useRef)({x:0,y:0}),y=Object(n.useRef)({x:0,y:0}),f=(e,a)=>{var n=[a.x,a.y],o=n[0],i=n[1],r="object"===typeof e?e.to/g.a:1+.2*e;g.translate(o,i).scaleU(r),g.a>2&&g.scaleU(2/g.a),g.a<.05&&g.scaleU(.05/g.a),g.translate(-o,-i),t(g.clone())};return{mouseEvents:{onMouseMove:a=>{var n=e.current.getBoundingClientRect(),i=n.left,r=n.top;y.current.x=b.current.x,y.current.y=b.current.y,b.current.x=a.clientX-i,b.current.y=a.clientY-r;var d=g.applyToPoint(b.current.x,b.current.y);c&&o&&l(d);var u=s.current,h=u.iw,f=u.ih;m({x:d.x/h,y:d.y/f}),p&&(g.translate(y.current.x-b.current.x,y.current.y-b.current.y),t(g.clone())),a.preventDefault()},onMouseDown:(e,t={})=>{if(e.preventDefault(),1===e.button||2===e.button||0===e.button&&d)return a(!0);var n=g.applyToPoint(b.current.x,b.current.y);if(c&&0===e.button)return r(n),void l(n);if(0===e.button){t.type,t.type;var o=s.current,i=o.iw,m=o.ih;h({x:n.x/i,y:n.y/m})}},onMouseUp:e=>{e.preventDefault();var n=g.applyToPoint(b.current.x,b.current.y);if(o){var i=n;if(Math.abs(o.x-i.x)<10&&Math.abs(o.y-i.y)<10)g.a<1?f({to:1},b.current):f({to:.25},b.current);else{var c=s.current,m=c.iw,h=c.ih;if(o.x>i.x){var p=[i.x,o.x];o.x=p[0],i.x=p[1]}if(o.y>i.y){var y=[i.y,o.y];o.y=y[0],i.y=y[1]}var E=Math.min((i.x-o.x)/m,(i.y-o.y)/h);E<.05&&(E=.05),E>10&&(E=10);var O=N.Matrix.from(1,0,0,1,-10,-10).translate(o.x,o.y).scaleU(E);t(O.clone())}r(null),l(null)}if(1===e.button||2===e.button||0===e.button&&d)return a(!1);if(0===e.button){var v=s.current,x=v.iw,w=v.ih;u({x:n.x/x,y:n.y/w})}},onWheel:e=>{var t=e.deltaY>0?1:e.deltaY<0?-1:0;f(t,b.current)},onContextMenu:e=>{e.preventDefault()}},mousePosition:b}},z=({layoutParams:e,mat:t})=>Object(L.a)(a=>{var n=e.current,o=n.iw,i=n.ih,r=(e=>{switch(e.type){case"polygon":var t={x:Math.min(...e.points.map(([e,t])=>e)),y:Math.min(...e.points.map(([e,t])=>t)),w:0,h:0};return t.w=Math.max(...e.points.map(([e,t])=>e))-t.x,t.h=Math.max(...e.points.map(([e,t])=>t))-t.y,t;case"keypoints":var a=Math.min(...Object.values(e.points).map(({x:e,y:t})=>e)),n=Math.min(...Object.values(e.points).map(({x:e,y:t})=>t));return{x:a,y:n,w:Math.max(...Object.values(e.points).map(({x:e,y:t})=>e))-a,h:Math.max(...Object.values(e.points).map(({x:e,y:t})=>t))-n};case"expanding-line":var o={x:Math.min(...e.points.map(({x:e,y:t})=>e)),y:Math.min(...e.points.map(({x:e,y:t})=>t)),w:0,h:0};return o.w=Math.max(...e.points.map(({x:e,y:t})=>e))-o.x,o.h=Math.max(...e.points.map(({x:e,y:t})=>t))-o.y,o;case"box":return{x:e.x,y:e.y,w:e.w,h:e.h};case"point":return{x:e.x,y:e.y,w:0,h:0};default:return{x:0,y:0,w:0,h:0}}throw new Error("unknown region")})(a),l="point"===a.type?15:2,s={x:r.x*o-l,y:r.y*i-l,w:r.w*o+2*l,h:r.h*i+2*l};return Object(C.a)(Object(C.a)({},t.clone().inverse().applyToPoint(s.x,s.y)),{},{w:s.w/t.a,h:s.h/t.d})}),G=Object(S.a)("svg")({pointerEvents:"none",position:"absolute",zIndex:1,left:0,top:0,width:"100%",height:"100%","& text":{fill:"#fff"},"& path":{vectorEffect:"non-scaling-stroke",strokeWidth:2,opacity:.5,stroke:"#FFF",fill:"none",strokeDasharray:5,animationDuration:"4s",animationTimingFunction:"linear",animationIterationCount:"infinite",animationPlayState:"running"}}),H=({projectRegionBox:e,regions:t,pointDistancePrecision:a,realSize:i})=>o.a.createElement(G,null,t.filter(e=>"point"===e.type).flatMap((r,l)=>t.filter((e,t)=>t>l).filter(e=>"point"===e.type).map(t=>{var l,s=e(r),c=e(t),d={x:(s.x+s.w/2+c.x+c.w/2)/2,y:(s.y+s.h/2+c.y+c.h/2)/2};if(i){var g=i.w,m=i.h,u=i.unitName;l=Math.sqrt(Math.pow(r.x*g-t.x*g,2)+Math.pow(r.y*m-t.y*m,2)).toFixed(a)+u}else l=(100*Math.sqrt(Math.pow(r.x-t.x,2)+Math.pow(r.y-t.y,2))).toFixed(a)+"%";return o.a.createElement(n.Fragment,null,o.a.createElement("path",{d:"M".concat(s.x+s.w/2,",").concat(s.y+s.h/2," L").concat(c.x+c.w/2,",").concat(c.y+c.h/2)}),o.a.createElement("text",{x:d.x,y:d.y},l))}))),V=a(920),U=a(67),F={regionInfo:{fontSize:12,cursor:"default",transition:"opacity 200ms",opacity:.5,"&:hover":{opacity:.9,cursor:"pointer"},"&.highlighted":{opacity:.9,"&:hover":{opacity:1}},fontWeight:600,color:U.a[900],padding:8,"& .name":{display:"flex",flexDirection:"row",alignItems:"center","& .circle":{marginRight:4,boxShadow:"0px 0px 2px rgba(0,0,0,0.4)",width:10,height:10,borderRadius:5}},"& .tags":{"& .tag":{color:U.a[700],display:"inline-block",margin:1,fontSize:10,textDecoration:"underline"}}}},Y=a(31),K=a.n(Y),X=a(284),Z=a(64),J=a.n(Z),q=a(166),$=a.n(q),Q=a(250),ee=a(7),te=a.n(ee),ae=Object(l.a)(F),ne=Object(n.memo)(({region:e,editing:t,allowedClasses:a,allowedTags:n,onDelete:i,onChange:r,onClose:l,onOpen:s,onRegionClassAdded:c})=>{var d=ae();return o.a.createElement(V.a,{onClick:()=>t?null:s(e),className:K()(d.regionInfo,{highlighted:e.highlighted})},t?o.a.createElement("div",{style:{width:200}},o.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},o.a.createElement("div",{style:{display:"flex",backgroundColor:e.color||"#888",color:"#fff",padding:4,paddingLeft:8,paddingRight:8,borderRadius:4,fontWeight:"bold",textShadow:"0px 0px 5px rgba(0,0,0,0.4)"}},e.type),o.a.createElement("div",{style:{flexGrow:1}}),o.a.createElement(X.a,{onClick:()=>i(e),tabIndex:-1,style:{width:22,height:22},size:"small",variant:"outlined"},o.a.createElement(J.a,{style:{marginTop:-8,width:16,height:16}}))),(a||[]).length>0&&o.a.createElement("div",{style:{marginTop:6}},o.a.createElement(Q.a,{placeholder:"Classification",onChange:(t,a)=>("create-option"==a.action&&c(t.value),r(Object(C.a)(Object(C.a)({},e),{},{cls:t.value}))),value:e.cls?{label:e.cls,value:e.cls}:null,options:Object(ee.asMutable)(a.map(e=>({value:e,label:e})))})),(n||[]).length>0&&o.a.createElement("div",{style:{marginTop:4}},o.a.createElement(p.default,{onChange:t=>r(Object(C.a)(Object(C.a)({},e),{},{tags:t.map(e=>e.value)})),placeholder:"Tags",value:(e.tags||[]).map(e=>({label:e,value:e})),isMulti:!0,options:Object(ee.asMutable)(n.map(e=>({value:e,label:e})))})),l&&o.a.createElement("div",{style:{marginTop:4,display:"flex"}},o.a.createElement("div",{style:{flexGrow:1}}),o.a.createElement(h.a,{onClick:()=>l(e),size:"small",variant:"contained",color:"primary"},o.a.createElement($.a,null)))):o.a.createElement("div",null,e.cls&&o.a.createElement("div",{className:"name"},o.a.createElement("div",{className:"circle",style:{backgroundColor:e.color}}),e.cls),e.tags&&o.a.createElement("div",{className:"tags"},e.tags.map(e=>o.a.createElement("div",{key:e,className:"tag"},e)))))},(e,t)=>e.editing===t.editing&&e.region===t.region),oe=a(108),ie=a.n(oe),re=({regions:e,projectRegionBox:t,mouseEvents:a,regionClsList:n,regionTagList:i,onBeginRegionEdit:r,onChangeRegion:l,onCloseRegionEdit:s,onDeleteRegion:c,layoutParams:d,imageSrc:g,RegionEditLabel:m,onRegionClassAdded:u})=>{var h=null!=m?m:ne;return e.filter(e=>e.visible||void 0===e.visible).map(m=>{var p=t(m),b=d.current,y=(b.iw,b.ih,8);m.highlighted&&"box"===m.type&&(y+=6);var f=m.editingLabels&&!m.locked?170:m.tags?60:50,E=p.y>f,O=E?{left:p.x,top:p.y-y/2}:{left:p.x,top:p.y+p.h+y/2};return m.locked?o.a.createElement("div",{key:m.id,style:Object(C.a)(Object(C.a)({position:"absolute"},O),{},{zIndex:10+(m.editingLabels?5:0)})},o.a.createElement(V.a,{style:Object(C.a)(Object(C.a)({position:"absolute",left:0},E?{bottom:0}:{top:0}),{},{zIndex:10,backgroundColor:"#fff",borderRadius:4,padding:2,paddingBottom:0,opacity:.5,pointerEvents:"none"})},o.a.createElement(ie.a,{style:{width:16,height:16,color:"#333"}}))):o.a.createElement("div",{key:m.id,style:Object(C.a)(Object(C.a)({position:"absolute"},O),{},{zIndex:10+(m.editingLabels?5:0),width:200}),onMouseDown:e=>e.preventDefault(),onMouseUp:e=>e.preventDefault(),onMouseEnter:e=>{m.editingLabels&&(a.onMouseUp(e),e.button=1,a.onMouseUp(e))}},o.a.createElement("div",Object.assign({style:Object(C.a)({position:"absolute",zIndex:20,left:0},E?{bottom:0}:{top:0})},m.editingLabels?{}:((e,...t)=>{for(var a=Object(C.a)({},e),n=0,o=t;n<o.length;n++){delete a[o[n]]}return a})(a,"onMouseDown","onMouseUp")),o.a.createElement(h,{allowedClasses:n,allowedTags:i,onOpen:r,onChange:l,onClose:s,onDelete:c,editing:m.editingLabels,region:m,regions:e,imageSrc:g,onRegionClassAdded:u})))})},le=a(87),se=a(89),ce=a(90),de=a(88),ge=a(194),me=a(195),ue=a(86),he=a(196),pe=a(85),be=a(197),ye=a(198),fe=a(199),Ee=[le.a[500],se.a[500],ce.a[500],de.a[800],ge.a[500],me.a[700],ue.a[500],he.a[500],pe.a[500],be.a[500],ye.a[500],fe.a[500]];Ee.map(e=>(2281701376|function(e){var t=(e=e.replace("#","")).substr(4,2)+e.substr(2,2)+e.substr(0,2);return parseInt(t,16)}(e))>>>0);var Oe=Ee,ve=a(972),xe=e=>{var t=Array.from(document.getElementsByTagName("img")).find(t=>t.src===e),a=document.createElement("canvas"),n=a.getContext("2d");return t||((t=new Image).crossOrigin="anonymous",t.src=e),new Promise((e,o)=>{t.onload=()=>{a.width=t.naturalWidth,a.height=t.naturalHeight,n.drawImage(t,0,0);var o=n.getImageData(0,0,t.naturalWidth,t.naturalHeight);e(o)}})},we=a(148),je=a.n(we);var Ie=({regions:e,regionClsList:t,imageSrc:a,imagePosition:i,zIndex:r=1,hide:l=!1,autoSegmentationOptions:s={type:"simple"}})=>{var c=Object(n.useState)(null),d=Object(u.a)(c,2),g=d[0],m=d[1],h=Object(n.useState)(),p=Object(u.a)(h,2),b=p[0],y=p[1];Object(n.useEffect)(()=>{a&&xe(a).then(e=>{je.a.setConfig(Object(C.a)({classNames:t},s)),je.a.loadImage(e),y(e)})},[a]),Object(ve.a)(()=>{if(!l&&g&&b&&!(e.filter(e=>e.cls).length<2)){var t=function(e){return e.map(e=>{switch(e.type){case"point":return{regionType:"point",classification:e.cls,x:e.x,y:e.y};case"polygon":return{regionType:"polygon",classification:e.cls,points:e.points.map(([e,t])=>({x:e,y:t}))};case"box":return{regionType:"bounding-box",classification:e.cls,centerX:e.x+e.w/2,centerY:e.y+e.h/2,width:e.w,height:e.h};default:return null}}).filter(Boolean)}(e);je.a.getMask(t).then(e=>{var t=g.getContext("2d");t.clearRect(0,0,e.width,e.height),t.putImageData(e,0,0)})}},1e3,[g,b,e,l]);var f=Object(n.useMemo)(()=>{var e=i.bottomRight.x-i.topLeft.x,t=i.bottomRight.y-i.topLeft.y;return{display:l?"none":void 0,imageRendering:"pixelated",transform:"translateZ(0px)",left:i.topLeft.x,top:i.topLeft.y,width:isNaN(e)?0:e,height:isNaN(t)?0:t,zIndex:r,position:"absolute",pointerEvents:"none"}},[i.topLeft.x,i.topLeft.y,i.bottomRight.x,i.bottomRight.y,r,l]);return o.a.createElement("canvas",{style:f,width:b?b.width:0,height:b?b.height:0,ref:m})},Te=Object(l.a)({"@keyframes borderDance":{from:{strokeDashoffset:0},to:{strokeDashoffset:100}},highlightBox:{zIndex:2,transition:"opacity 500ms","&.highlighted":{zIndex:3},"&:not(.highlighted)":{opacity:0},"&:not(.highlighted):hover":{opacity:.6},"& path":{vectorEffect:"non-scaling-stroke",strokeWidth:2,stroke:"#FFF",fill:"none",strokeDasharray:5,animationName:"$borderDance",animationDuration:"4s",animationTimingFunction:"linear",animationIterationCount:"infinite",animationPlayState:"running"}}}),Ce=({mouseEvents:e,dragWithPrimary:t,zoomWithPrimary:a,createWithPrimary:n,onBeginMovePoint:i,onSelectRegion:r,region:l,pbox:s})=>{var c=Te();if(!s.w||s.w===1/0)return null;if(!s.h||s.h===1/0)return null;if(l.unfinished)return null;var d="point"===l.type?{left:s.x+s.w/2-30,top:s.y+s.h/2-30,width:60,height:60}:{left:s.x-5,top:s.y-5,width:s.w+10,height:s.h+10},g="point"===l.type?"M5,5 L".concat(d.width-5," 5L").concat(d.width-5," ").concat(d.height-5,"L5 ").concat(d.height-5,"Z"):"M5,5 L".concat(s.w+5,",5 L").concat(s.w+5,",").concat(s.h+5," L5,").concat(s.h+5," Z");return o.a.createElement("svg",Object.assign({key:l.id,className:K()(c.highlightBox,{highlighted:l.highlighted})},e,a||t?{}:{onMouseDown:t=>!l.locked&&"point"===l.type&&l.highlighted&&0===t.button?i(l):0!==t.button||n?void e.onMouseDown(t):r(l)},{style:Object(C.a)(Object(C.a)({},l.highlighted?{pointerEvents:"point"!==l.type?"none":void 0,cursor:"grab"}:{cursor:a||t||n?void 0:"pointer",pointerEvents:a||t||n&&!l.highlighted?"none":void 0}),{},{position:"absolute"},d)}),o.a.createElement("path",{d:g}))},Me=a(970),Se=Object(S.a)("div")({width:8,height:8,zIndex:2,border:"2px solid #FFF",position:"absolute"}),Ne=[["nw-resize","n-resize","ne-resize"],["w-resize","grab","e-resize"],["sw-resize","s-resize","se-resize"]],ke=Object(n.memo)(({region:e,mouseEvents:t,projectRegionBox:a,dragWithPrimary:i,createWithPrimary:r,zoomWithPrimary:l,onBeginMovePoint:s,onSelectRegion:c,layoutParams:d,fullImageSegmentationMode:g=!1,mat:m,onBeginBoxTransform:u,onBeginMovePolygonPoint:h,onBeginMoveKeypoint:p,onAddPolygonPoint:b,showHighlightBox:y})=>{var f=a(e),E=d.current,O=E.iw,v=E.ih;return o.a.createElement(n.Fragment,null,o.a.createElement(D,null,y&&"polygon"!==e.type&&o.a.createElement(Ce,{region:e,mouseEvents:t,dragWithPrimary:i,createWithPrimary:r,zoomWithPrimary:l,onBeginMovePoint:s,onSelectRegion:c,pbox:f}),"box"===e.type&&!i&&!l&&!e.locked&&e.highlighted&&m.a<1.2&&[[0,0],[.5,0],[1,0],[1,.5],[1,1],[.5,1],[0,1],[0,.5],[.5,.5]].map(([a,n],i)=>o.a.createElement(Se,Object.assign({key:i},t,{onMouseDown:o=>{if(0===o.button)return u(e,[2*a-1,2*n-1]);t.onMouseDown(o)},style:{left:f.x-4-2+f.w*a,top:f.y-4-2+f.h*n,cursor:Ne[2*n][2*a],borderRadius:.5===a&&.5===n?4:void 0}}))),"polygon"===e.type&&!i&&!l&&!e.locked&&e.highlighted&&e.points.map(([a,n],i)=>{var r=m.clone().inverse().applyToPoint(a*O,n*v);return o.a.createElement(Se,Object.assign({key:i},t,{onMouseDown:a=>{if(0===a.button&&(!e.open||0===i))return h(e,i);t.onMouseDown(a)},style:{cursor:e.open?0===i?"pointer":void 0:"move",zIndex:10,pointerEvents:e.open&&i===e.points.length-1?"none":void 0,left:r.x-4,top:r.y-4}}))}),"polygon"===e.type&&e.highlighted&&!i&&!l&&!e.locked&&!e.open&&e.points.length>1&&e.points.map((t,a)=>[t,e.points[(a+1)%e.points.length]]).map(([e,t])=>[(e[0]+t[0])/2,(e[1]+t[1])/2]).map((a,n)=>{var i=m.clone().inverse().applyToPoint(a[0]*O,a[1]*v);return o.a.createElement(Se,Object.assign({key:n},t,{onMouseDown:o=>{if(0===o.button)return b(e,a,n+1);t.onMouseDown(o)},style:{cursor:"copy",zIndex:10,left:i.x-4,top:i.y-4,border:"2px dotted #fff",opacity:.5}}))}),"keypoints"===e.type&&!i&&!l&&!e.locked&&e.highlighted&&Object.entries(e.points).map(([a,{x:n,y:i}],r)=>{var l=m.clone().inverse().applyToPoint(n*O,i*v);return o.a.createElement(Me.a,{title:a,key:r},o.a.createElement(Se,Object.assign({key:r},t,{onMouseDown:n=>{if(0===n.button&&(!e.open||0===r))return p(e,a);t.onMouseDown(n)},style:{cursor:e.open?0===r?"pointer":void 0:"move",zIndex:10,pointerEvents:e.open&&r===e.points.length-1?"none":void 0,left:l.x-4,top:l.y-4}})))})))},(e,t)=>e.region===t.region&&e.dragWithPrimary===t.dragWithPrimary&&e.createWithPrimary===t.createWithPrimary&&e.zoomWithPrimary===t.zoomWithPrimary&&e.mat===t.mat),Ae=Object(n.memo)(e=>e.regions.filter(e=>e.visible||void 0===e.visible).filter(e=>!e.locked).map((t,a)=>o.a.createElement(ke,Object.assign({key:t.id},e,{region:t}))),(e,t)=>e.regions===t.regions&&e.mat===t.mat),Le=Object(n.createContext)({showCrosshairs:!1,showHighlightBox:!0,wasdMode:!0}),_e=()=>Object(n.useContext)(Le),De=({children:e})=>{var t=Object(n.useState)(()=>(()=>{if(!window||!window.localStorage)return{};for(var e={},t=0;t<window.localStorage.length;t++){var a=window.localStorage.key(t);if(a.startsWith("settings_"))try{e[a.replace("settings_","")]=JSON.parse(window.localStorage.getItem(a))}catch(n){}}return e})()),a=Object(u.a)(t,2),i=a[0],r=a[1];return o.a.createElement(Le.Provider,{value:Object(C.a)(Object(C.a)({},i),{},{changeSetting:(e,t)=>{r(Object(C.a)(Object(C.a)({},i),{},{[e]:t})),window.localStorage.setItem("settings_".concat(e),JSON.stringify(t))}})},e)},Pe=Object(S.a)("video")({zIndex:0,position:"absolute"}),Re=Object(S.a)("img")({zIndex:0,position:"absolute"}),Be=Object(S.a)("div")({zIndex:0,position:"absolute",left:0,right:0,bottom:0,top:0,backgroundColor:"rgba(255,0,0,0.2)",color:"#ff0000",fontWeight:"bold",whiteSpace:"pre-wrap",padding:50}),We=({imagePosition:e,mouseEvents:t,videoTime:a,videoSrc:i,imageSrc:r,onLoad:l,useCrossOrigin:s=!1,videoPlaying:c,onChangeVideoTime:d,onChangeVideoPlaying:g})=>{var m=_e(),h=Object(n.useRef)(),p=Object(n.useRef)(),b=Object(n.useState)(),y=Object(u.a)(b,2),f=y[0],E=y[1];Object(n.useEffect)(()=>{!c&&h.current&&(h.current.currentTime=(a||0)/1e3)},[a]),Object(n.useEffect)(()=>{var e=!1;return h.current&&(c?(h.current.play(),e=!0,m.videoPlaybackSpeed&&(h.current.playbackRate=parseFloat(m.videoPlaybackSpeed))):h.current.pause()),function t(){if(e&&h.current){var n=Math.floor(1e3*h.current.currentTime);a!==n&&d(n),h.current.paused&&(e=!1,g(!1)),requestAnimationFrame(t)}}(),()=>{e=!1}},[c]);var O=Object(L.a)(e=>{var t=e.currentTarget;t.currentTime=(a||0)/1e3,l&&l({naturalWidth:t.videoWidth,naturalHeight:t.videoHeight,videoElm:t,duration:t.duration})}),v=Object(L.a)(e=>{var t=e.currentTarget;l&&l({naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight,imageElm:t})}),x=Object(L.a)(e=>{E("Could not load image\n\nMake sure your image works by visiting ".concat(r||i," in a web browser. If that URL works, the server hosting the URL may be not allowing you to access the image from your current domain. Adjust server settings to enable the image to be viewed.").concat(s?"\n\nYour image may be blocked because it's not being sent with CORs headers. To do pixel segmentation, browser web security requires CORs headers in order for the algorithm to read the pixel data from the image. CORs headers are easy to add if you're using an S3 bucket or own the server hosting your images.":"","\n\n If you need a hand, reach out to the community at universaldatatool.slack.com"))}),w=Object(n.useMemo)(()=>{var t=e.bottomRight.x-e.topLeft.x,a=e.bottomRight.y-e.topLeft.y;return{imageRendering:"pixelated",left:e.topLeft.x,top:e.topLeft.y,width:isNaN(t)?0:t,height:isNaN(a)?0:a}},[e.topLeft.x,e.topLeft.y,e.bottomRight.x,e.bottomRight.y]);return i||r?f?o.a.createElement(Be,null,f):r&&void 0===a?o.a.createElement(Re,Object.assign({},t,{src:r,ref:p,style:w,onLoad:v,onError:x,crossOrigin:s?"anonymous":void 0})):o.a.createElement(Pe,Object.assign({},t,{ref:h,style:w,onLoadedMetadata:O,src:i||r})):o.a.createElement(Be,null,"No imageSrc or videoSrc provided")},ze=a(52),Ge=a.n(ze);function He(e,t,a){return e<=t?t:e>=a?a:e}for(var Ve={point:Object(n.memo)(({region:e,iw:t,ih:a})=>o.a.createElement("g",{transform:"translate(".concat(e.x*t," ").concat(e.y*a,")")},o.a.createElement("path",{d:"M0 8L8 0L0 -8L-8 0Z",strokeWidth:2,stroke:e.color,fill:"transparent"}))),box:Object(n.memo)(({region:e,iw:t,ih:a})=>o.a.createElement("g",{transform:"translate(".concat(e.x*t," ").concat(e.y*a,")")},o.a.createElement("rect",{strokeWidth:2,x:0,y:0,width:Math.max(e.w*t,0),height:Math.max(e.h*a,0),stroke:Ge()(e.color,.75),fill:Ge()(e.color,.25)}))),polygon:Object(n.memo)(({region:e,iw:t,ih:a,fullSegmentationMode:n})=>{var i=e.open?"polyline":"polygon";return o.a.createElement(i,{points:e.points.map(([e,n])=>[e*t,n*a]).map(e=>e.join(" ")).join(" "),strokeWidth:2,stroke:Ge()(e.color,.75),fill:Ge()(e.color,.25)})}),keypoints:({region:e,iw:t,ih:a,keypointDefinitions:n})=>{var i=e.points,r=e.keypointsDefinitionId;if(!n[r])throw new Error('No definition for keypoint configuration "'.concat(r,'"'));var l=n[r],s=l.landmarks,c=l.connections;return o.a.createElement("g",null,Object.entries(i).map(([e,{x:n,y:i}],r)=>o.a.createElement("g",{key:r,transform:"translate(".concat(n*t," ").concat(i*a,")")},o.a.createElement("path",{d:"M0 8L8 0L0 -8L-8 0Z",strokeWidth:2,stroke:s[e].color,fill:"transparent"}))),c.map(([e,n])=>{var r=i[e],l=i[n],c=(r.x+l.x)/2,d=(r.y+l.y)/2;return o.a.createElement("g",{key:"".concat(r,".").concat(l)},o.a.createElement("line",{x1:r.x*t,y1:r.y*a,x2:c*t,y2:d*a,strokeWidth:2,stroke:s[e].color}),o.a.createElement("line",{x1:l.x*t,y1:l.y*a,x2:c*t,y2:d*a,strokeWidth:2,stroke:s[n].color}))}))},"expanding-line":Object(n.memo)(({region:e,iw:t,ih:a})=>{var n=e.expandingWidth,i=void 0===n?.005:n,r=e.points;i=r.slice(-1)[0].width||i;var l=r.map(({x:e,y:t,angle:a,width:n},o)=>{if(!a){var l=r[He(o+1,0,r.length-1)],s=r[He(o-1,0,r.length-1)];a=Math.atan2(s.x-l.x,s.y-l.y)+Math.PI/2}var c=Math.sin(a)*(n||i)/2,d=Math.cos(a)*(n||i)/2;return[{x:e+c,y:t+d},{x:e-c,y:t-d}]}),s=l.map(([e,t])=>e),c=l.map(([e,t])=>t).asMutable();c.reverse();var d=r.slice(-1)[0];return o.a.createElement(o.a.Fragment,null,o.a.createElement("polygon",{points:s.concat(e.candidatePoint?[e.candidatePoint]:[]).concat(c).map(e=>"".concat(e.x*t," ").concat(e.y*a)).join(" "),strokeWidth:2,stroke:Ge()(e.color,.75),fill:Ge()(e.color,.25)}),r.map(({x:n,y:i,angle:r},l)=>o.a.createElement("g",{key:l,transform:"translate(".concat(n*t," ").concat(i*a,") rotate(").concat(180*-(r||0)/Math.PI,")")},o.a.createElement("g",null,o.a.createElement("rect",{x:-5,y:-5,width:10,height:10,strokeWidth:2,stroke:Ge()(e.color,.75),fill:Ge()(e.color,.25)})))),o.a.createElement("rect",{x:d.x*t-8,y:d.y*a-8,width:16,height:16,strokeWidth:4,stroke:Ge()(e.color,.5),fill:"transparent"}))}),pixel:()=>null},Ue=Object(n.memo)(({regions:e,keypointDefinitions:t,iw:a,ih:n,fullSegmentationMode:i})=>e.filter(e=>!1!==e.visible).map(e=>{var r=Ve[e.type];return o.a.createElement(r,{key:e.regionId,region:e,iw:a,ih:n,keypointDefinitions:t,fullSegmentationMode:i})}),(e,t)=>e.regions===t.regions&&e.iw===t.iw&&e.ih===t.ih),Fe=({mat:e,imagePosition:t,regions:a=[],keypointDefinitions:n,fullSegmentationMode:i})=>{var r=t.bottomRight.x-t.topLeft.x,l=t.bottomRight.y-t.topLeft.y;return isNaN(r)||isNaN(l)?null:o.a.createElement("svg",{width:r,height:l,style:{position:"absolute",zIndex:2,left:t.topLeft.x,top:t.topLeft.y,pointerEvents:"none",width:r,height:l}},o.a.createElement(Ue,{key:"wrapped-region-list",regions:a,iw:r,ih:l,keypointDefinitions:n,fullSegmentationMode:i}))},Ye=Object(l.a)({canvas:{width:"100%",height:"100%",position:"relative",zIndex:1},zoomIndicator:{position:"absolute",bottom:16,right:0,backgroundColor:"rgba(0,0,0,0.4)",color:"#fff",opacity:.5,fontWeight:"bolder",fontSize:14,padding:4},fixedRegionLabel:{position:"absolute",zIndex:10,top:10,left:10,opacity:.5,transition:"opacity 500ms","&:hover":{opacity:1}}}),Ke=(e=null,{iw:t,ih:a}={})=>{var n=N.Matrix.from(1,0,0,1,-10,-10);return e&&t&&(n=n.translate(e.x*t,e.y*a).scaleU(e.w+.05)),n},Xe=({regions:e,imageSrc:t,videoSrc:a,videoTime:i,realSize:r,showTags:l,onMouseMove:s=(e=>null),onMouseDown:c=(e=>null),onMouseUp:d=(e=>null),dragWithPrimary:g=!1,zoomWithPrimary:m=!1,createWithPrimary:h=!1,pointDistancePrecision:p=0,regionClsList:b,regionTagList:y,showCrosshairs:f,showHighlightBox:E=!0,showPointDistances:O,allowedArea:v,RegionEditLabel:x=null,videoPlaying:w=!1,showMask:j=!0,fullImageSegmentationMode:I,autoSegmentationOptions:T,onImageOrVideoLoaded:M,onChangeRegion:S,onBeginRegionEdit:N,onCloseRegionEdit:A,onBeginBoxTransform:_,onBeginMovePolygonPoint:R,onAddPolygonPoint:G,onBeginMoveKeypoint:V,onSelectRegion:U,onBeginMovePoint:F,onDeleteRegion:Y,onChangeVideoTime:K,onChangeVideoPlaying:X,onRegionClassAdded:Z,zoomOnAllowedArea:J=!0,modifyingAllowedArea:q=!1,keypointDefinitions:$})=>{var Q=Ye(),ee=Object(n.useRef)(null),te=Object(n.useRef)({}),ae=Object(P.a)(!1),oe=Object(u.a)(ae,2),ie=oe[0],le=oe[1],se=Object(P.a)(0),ce=Object(u.a)(se,2),de=(ce[0],ce[1],Object(P.a)(null)),ge=Object(u.a)(de,2),me=ge[0],ue=ge[1],he=Object(P.a)(null),pe=Object(u.a)(he,2),be=pe[0],ye=pe[1],fe=Object(P.a)(Ke()),Ee=Object(u.a)(fe,2),Oe=Ee[0],ve=Ee[1],xe=(Object(n.useRef)({}),B());(({getLatestMat:e,changeMat:t})=>{var a=_e().wasdMode;Object(n.useEffect)(()=>{if(a){var n={w:[0,-10],a:[-10,0],s:[0,10],d:[10,0]},o={},i=Object.keys(n),r=e=>{i.includes(e.key)&&(o[e.key]=!0,e.preventDefault(),e.stopPropagation())},l=e=>{i.includes(e.key)&&(o[e.key]=!1,e.preventDefault(),e.stopPropagation())},s=setInterval(()=>{var a=e().clone(),i=!1;for(var r in o)o[r]&&(a=a.translate(...n[r]),i=!0);i&&t(a)},16);return window.addEventListener("keydown",r),window.addEventListener("keyup",l),()=>{clearInterval(s),window.removeEventListener("keydown",r),window.removeEventListener("keyup",l)}}},[a])})({getLatestMat:Object(L.a)(()=>Oe),changeMat:ve});var we=W({canvasEl:ee,dragging:ie,mat:Oe,layoutParams:te,changeMat:ve,zoomStart:me,zoomEnd:be,changeZoomStart:ue,changeZoomEnd:ye,changeDragging:le,zoomWithPrimary:m,dragWithPrimary:g,onMouseMove:s,onMouseDown:c,onMouseUp:d}),je=we.mouseEvents,Te=we.mousePosition;Object(n.useLayoutEffect)(()=>ve(Oe.clone()),[xe]);Oe.applyToPoint(Te.current.x,Te.current.y);var Ce=z({layoutParams:te,mat:Oe}),Me=Object(n.useState)(),Se=Object(u.a)(Me,2),Ne=Se[0],ke=Se[1],Le=Boolean(Ne&&Ne.naturalWidth),De=Object(L.a)(({naturalWidth:e,naturalHeight:t,duration:a})=>{var n={naturalWidth:e,naturalHeight:t,duration:a};M&&M(n),ke(n),setTimeout(()=>ke(n),10)}),Pe=(()=>{var e=Object(n.useRef)(null);if(null===e.current){e.current={image:new Image,pattern:null};var t=document.createElement("canvas");t.width=100,t.height=100;var a=t.getContext("2d");e.current.image.onload=()=>{e.current.pattern=a.createPattern(e.current.image,"repeat")},e.current.image.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4wMSAxY5oG+lzgAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAcSURBVAjXY/jPwPCfAQnA+TAGugLcAhhakRUAAK3lEe8m9qZhAAAAAElFTkSuQmCC"}return e.current.pattern})(),Re=ee.current;if(Re&&Le){var Be=Re.clientWidth,ze=Re.clientHeight,Ge=Math.max(Ne.naturalWidth/(Be-20),Ne.naturalHeight/(ze-20)),He=Ne.naturalWidth/Ge,Ve=Ne.naturalHeight/Ge;te.current={iw:He,ih:Ve,fitScale:Ge,canvasWidth:Be,canvasHeight:ze}}Object(n.useEffect)(()=>{Le&&ve(Ke(J?v:null,te.current))},[Le]),Object(n.useLayoutEffect)(()=>{if(Ne){var e=Re.clientWidth,t=Re.clientHeight;Re.width=e,Re.height=t;var a=Re.getContext("2d");a.save(),a.transform(...Oe.clone().inverse().toArray());var n=te.current,o=n.iw,i=n.ih;if(v){var r=v.x,l=v.y,s=v.w,c=v.h;a.save(),a.globalAlpha=1;var d=[[0,0],[o,0],[o,i],[0,i]],g=[[r*o,l*i],[r*o+s*o,l*i],[r*o+s*o,l*i+c*i],[r*o,l*i+c*i]];a.moveTo(...d[0]),d.forEach(e=>a.lineTo(...e)),a.lineTo(...d[0]),a.closePath(),g.reverse(),a.moveTo(...g[0]),g.forEach(e=>a.lineTo(...e)),a.lineTo(...g[0]),a.fillStyle=Pe||"#f00",a.fill(),a.restore()}a.restore()}});var Ue=te.current,Xe=Ue.iw,Ze=Ue.ih,Je=me&&be?Object(C.a)(Object(C.a)({},Oe.clone().inverse().applyToPoint(me.x,me.y)),{},{w:(be.x-me.x)/Oe.a,h:(be.y-me.y)/Oe.d}):null;Je&&(Je.w<0&&(Je.x+=Je.w,Je.w*=-1),Je.h<0&&(Je.y+=Je.h,Je.h*=-1));var qe={topLeft:Oe.clone().inverse().applyToPoint(0,0),bottomRight:Oe.clone().inverse().applyToPoint(Xe,Ze)},$e=Object(n.useMemo)(()=>{var t=e.filter(e=>e.highlighted);return 1!==t.length?null:t[0]},[e]);return o.a.createElement("div",{style:{width:"100%",height:"100%",maxHeight:"calc(100vh - 68px)",position:"relative",overflow:"hidden",cursor:h?"crosshair":ie?"grabbing":g?"grab":m?Oe.a<1?"zoom-out":"zoom-in":void 0}},f&&o.a.createElement(k,{key:"crossHairs",mousePosition:Te}),Le&&!ie&&o.a.createElement(Ae,{key:"regionSelectAndTransformBoxes",regions:q&&v?[{type:"box",id:"$$allowed_area",cls:"allowed_area",highlighted:!0,x:v.x,y:v.y,w:v.w,h:v.h,visible:!0,color:"#ff0"}]:e,mouseEvents:je,projectRegionBox:Ce,dragWithPrimary:g,createWithPrimary:h,zoomWithPrimary:m,onBeginMovePoint:F,onSelectRegion:U,layoutParams:te,mat:Oe,onBeginBoxTransform:_,onBeginMovePolygonPoint:R,onBeginMoveKeypoint:V,onAddPolygonPoint:G,showHighlightBox:E}),Le&&l&&!ie&&o.a.createElement(D,{key:"regionTags"},o.a.createElement(re,{regions:e,projectRegionBox:Ce,mouseEvents:je,regionClsList:b,regionTagList:y,onBeginRegionEdit:N,onChangeRegion:S,onCloseRegionEdit:A,onDeleteRegion:Y,layoutParams:te,imageSrc:t,RegionEditLabel:x,onRegionClassAdded:Z})),!l&&$e&&o.a.createElement("div",{key:"topLeftTag",className:Q.fixedRegionLabel},o.a.createElement(ne,{disableClose:!0,allowedClasses:b,allowedTags:y,onChange:S,onDelete:Y,editing:!0,region:$e,imageSrc:t})),m&&null!==Je&&o.a.createElement("div",{key:"zoomBox",style:{position:"absolute",zIndex:1,border:"1px solid #fff",pointerEvents:"none",left:Je.x,top:Je.y,width:Je.w,height:Je.h}}),O&&o.a.createElement(H,{key:"pointDistances",regions:e,realSize:r,projectRegionBox:Ce,pointDistancePrecision:p}),o.a.createElement(D,Object.assign({style:{width:"100%",height:"100%"}},je),o.a.createElement(o.a.Fragment,null,I&&o.a.createElement(Ie,{hide:!j,autoSegmentationOptions:T,imagePosition:qe,regionClsList:b,imageSrc:t,regions:e}),o.a.createElement("canvas",{style:{opacity:.25},className:Q.canvas,ref:ee}),o.a.createElement(Fe,{mat:Oe,keypointDefinitions:$,imagePosition:qe,regions:e,fullSegmentationMode:I}),o.a.createElement(We,{videoPlaying:w,imagePosition:qe,mouseEvents:je,onLoad:De,videoTime:i,videoSrc:a,imageSrc:t,useCrossOrigin:I,onChangeVideoTime:K,onChangeVideoPlaying:X}))),o.a.createElement("div",{className:Q.zoomIndicator},(1/Oe.a*100).toFixed(0),"%"))},Ze={container:{display:"flex",flexGrow:1,flexDirection:"column",height:"100%",maxHeight:"100vh",backgroundColor:"#fff",overflow:"hidden","&.fullscreen":{position:"absolute",zIndex:99999,left:0,right:0,top:0,bottom:0}},headerTitle:{fontWeight:"bold",color:U.a[700],paddingLeft:16}},Je=a(252),qe=a.n(Je),$e=a(253),Qe=a.n($e),et=({open:e,onClose:t})=>{var a=_e();return o.a.createElement(y.a,{open:e||!1,onClose:t},o.a.createElement(f.a,null,"Settings"),o.a.createElement(E.a,{style:{minWidth:400}},o.a.createElement(Qe.a,{variant:"flat",noActions:!0,defaultAnswers:a,onQuestionChange:(e,t,n)=>a.changeSetting(e,t),form:{questions:[{type:"boolean",title:"Show Crosshairs",name:"showCrosshairs"},{type:"boolean",title:"Show Highlight Box",name:"showHighlightBox"},{type:"boolean",title:"WASD Mode",name:"wasdMode"},{type:"dropdown",title:"Video Playback Speed",name:"videoPlaybackSpeed",defaultValue:"1x",choices:["0.25x","0.5x","1x","2x"]}]}})),o.a.createElement(O.a,null,o.a.createElement(h.a,{onClick:t},"Close")))},tt=a(170),at=e=>{var t,a,n=null;return"image"===e.annotationType?-1===(n=e.selectedImage)?(n=null,a=null):(t=["images",n],a=Object(ee.getIn)(e,t)):"video"===e.annotationType&&(t=["keyframes",e.currentVideoTime||0],a=Object(ee.getIn)(e,t)||null),{currentImageIndex:n,pathToActiveImage:t,activeImage:a}},nt=a(58),ot=[],it=(e,t)=>{if(e[t||0])return e[t||0].regions;var a=Object.keys(e).map(e=>parseInt(e)).filter(e=>!isNaN(e));if(0===a.length)return ot;a.sort((e,t)=>e-t);var n=a.findIndex(e=>e>=t);if(-1===n)return e[a[a.length-1]].regions||ot;if(0===n)return ot;var o,i=a[n-1],r=e[i],l=a[n],s=e[l],c={},d={},g=Object(nt.a)(r.regions);try{for(g.s();!(o=g.n()).done;){var m=o.value;c[m.id]=m}}catch(v){g.e(v)}finally{g.f()}var u,h=Object(nt.a)(s.regions);try{for(h.s();!(u=h.n()).done;){var p=u.value;d[p.id]=p}}catch(v){h.e(v)}finally{h.f()}var b=[],y=(l-t)/(l-i),f=1-y,E=function(e){var t=[c[e],d[e]],a=t[0],n=t[1];if(!n)return b.push(Object(C.a)(Object(C.a)({},a),{},{highlighted:!1,editingLabels:!1})),"continue";switch(a.type){case"point":b.push(Object(C.a)(Object(C.a)({},a),{},{highlighted:!1,editingLabels:!1,x:a.x*y+n.x*f,y:a.y*y+n.y*f}));break;case"box":b.push(Object(C.a)(Object(C.a)({},a),{},{highlighted:!1,editingLabels:!1,x:a.x*y+n.x*f,y:a.y*y+n.y*f,w:a.w*y+n.w*f,h:a.h*y+n.h*f}));break;case"polygon":n.points.length===a.points.length?b.push(Object(C.a)(Object(C.a)({},a),{},{highlighted:!1,editingLabels:!1,points:a.points.map((e,t)=>[e[0]*y+n.points[t][0]*f,e[1]*y+n.points[t][1]*f])})):b.push(a)}};for(var O in c)E(O);return b},rt=[],lt=a(139),st={},ct=0,dt=[{id:"select_tool",description:"Switch to the Select Tool",binding:"escape"},{id:"zoom_tool",description:"Select the Zoom Tool",binding:"z"},{id:"create_point",description:"Create a point"},{id:"create_bounding_box",description:"Create a bounding box",binding:"b"},{id:"pan_tool",description:"Select the Pan Tool",binding:"m"},{id:"create_polygon",description:"Create a Polygon",binding:"p"},{id:"create_pixel",description:"Create a Pixel Mask"},{id:"save_and_previous_sample",description:"Save and go to previous sample",binding:"ArrowLeft"},{id:"save_and_next_sample",description:"Save and go to next sample",binding:"ArrowRight"},{id:"save_and_exit_sample",description:"Save and exit current sample"},{id:"exit_sample",description:"Exit sample without saving"}];ct<dt.length;ct++){var gt=dt[ct],mt=gt.id,ut=gt.binding;st[mt]=ut}var ht=({dispatch:e})=>Object(n.useMemo)(()=>({select_tool:()=>{e({type:"SELECT_TOOL",selectedTool:"select"})},zoom_tool:()=>{e({type:"SELECT_TOOL",selectedTool:"zoom"})},create_point:()=>{e({type:"SELECT_TOOL",selectedTool:"create-point"})},create_bounding_box:()=>{e({type:"SELECT_TOOL",selectedTool:"create-box"})},pan_tool:()=>{e({type:"SELECT_TOOL",selectedTool:"pan"})},create_polygon:()=>{e({type:"SELECT_TOOL",selectedTool:"create-polygon"})},create_pixel:()=>{e({type:"SELECT_TOOL",selectedTool:"create-pixel"})},save_and_previous_sample:()=>{e({type:"HEADER_BUTTON_CLICKED",buttonName:"Prev"})},save_and_next_sample:()=>{e({type:"HEADER_BUTTON_CLICKED",buttonName:"Next"})},save_and_exit_sample:()=>{e({type:"HEADER_BUTTON_CLICKED",buttonName:"Save"})}}),[e]),pt=a(44),bt=a(45),yt=a(140),ft=a.n(yt),Et=a(258),Ot={marginTop:4,width:16,height:16,marginBottom:4},vt={select:()=>o.a.createElement(pt.a,{style:Ot,size:"xs",fixedWidth:!0,icon:bt.g}),pan:()=>o.a.createElement(pt.a,{style:Ot,size:"xs",fixedWidth:!0,icon:bt.e}),zoom:()=>o.a.createElement(pt.a,{style:Ot,size:"xs",fixedWidth:!0,icon:bt.h}),"show-tags":()=>o.a.createElement(pt.a,{style:Ot,size:"xs",fixedWidth:!0,icon:bt.i}),"create-point":()=>o.a.createElement(pt.a,{style:Ot,size:"xs",fixedWidth:!0,icon:bt.a}),"create-box":()=>o.a.createElement(pt.a,{style:Ot,size:"xs",fixedWidth:!0,icon:bt.j}),"create-polygon":()=>o.a.createElement(pt.a,{style:Ot,size:"xs",fixedWidth:!0,icon:bt.b}),"create-expanding-line":()=>o.a.createElement(pt.a,{style:Ot,size:"xs",fixedWidth:!0,icon:bt.d}),"show-mask":()=>o.a.createElement(pt.a,{style:Ot,size:"xs",fixedWidth:!0,icon:bt.f}),"modify-allowed-area":()=>o.a.createElement(pt.a,{style:Ot,size:"xs",fixedWidth:!0,icon:bt.c}),"create-keypoints":a.n(Et).a,window:ft.a},xt=a(172),wt=a.n(xt),jt=a(259),It=(e,t=1)=>{if(e<1e3)return e+"ms";var a=e/1e3;if(a<60)return Number.isInteger(a)?a+"s":a.toFixed(t)+"s";var n=a/60;return Number.isInteger(n)?n+"m":n.toFixed(t)+"m"},Tt=Object(S.a)("div")({position:"relative",display:"flex",flexGrow:1,minWidth:240,height:64,marginLeft:16,marginRight:16}),Ct=Object(S.a)("div")({position:"absolute",width:2,marginLeft:-1,height:"100%",backgroundColor:U.a[300],bottom:0}),Mt=Object(S.a)("div")({position:"absolute",userSelect:"none",fontSize:10,color:U.a[600],fontWeight:"bold",bottom:0}),St=Object(S.a)("div")({position:"absolute",bottom:"calc(50% + 6px)",fontSize:10,fontWeight:"bold",color:"#fff",display:"grid",placeItems:"center",width:48,marginLeft:-24,borderRadius:2,height:24,backgroundColor:se.a[500],userSelect:"none",fontVariantNumeric:"tabular-nums","&::before":{position:"absolute",bottom:-6,left:16,content:'""',width:0,height:0,borderTop:"8px solid ".concat(se.a[500]),borderLeft:"8px solid transparent",borderRight:"8px solid transparent"}}),Nt=Object(S.a)("div")({position:"absolute",bottom:8,cursor:"pointer",opacity:.75,fontSize:10,fontWeight:"bold",color:"#fff",display:"grid",placeItems:"center",width:16,marginLeft:0,borderTopLeftRadius:2,borderTopRightRadius:2,height:12,marginLeft:-8,backgroundColor:le.a[500],userSelect:"none",fontVariantNumeric:"tabular-nums","&::before":{position:"absolute",bottom:-8,left:0,content:'""',width:0,height:0,borderTop:"8px solid ".concat(le.a[500]),borderLeft:"8px solid transparent",borderRight:"8px solid transparent"}}),kt=6e4,At=[[50,250],[100,500],[250,1e3],[1e3,5e3],[5e3,3e4],[1e4,kt],[3e4,2*kt],[kt,5*kt],[5*kt,30*kt],[10*kt,60*kt],[30*kt,60*kt*3],[60*kt,60*kt*5]],Lt=({currentTime:e=0,duration:t,onChangeCurrentTime:a,keyframes:i})=>{var r=Object(jt.a)(),l=Object(u.a)(r,2),s=l[0],c=l[1],d=Object(n.useState)(e),g=Object(u.a)(d,2),m=g[0],h=g[1],p=Object(P.a)(!1),b=Object(u.a)(p,2),y=b[0],f=b[1],E=Object.keys(i||{}).map(e=>parseInt(e)).filter(e=>!isNaN(e)).sort((e,t)=>e-t);Object(n.useEffect)(()=>{e!==m&&h(e)},[e]);var O=Object(n.useMemo)(()=>(e=>{var t,a=Object(nt.a)(At);try{for(a.s();!(t=a.n()).done;){var n=Object(u.a)(t.value,2),o=n[0],i=n[1];if(e/i<6&&e/i>2)return[o,i]}}catch(r){a.e(r)}finally{a.f()}return[e/4,e]})(t),[t]),v=Object(u.a)(O,2),x=v[0],w=v[1],j=Object(L.a)(e=>{if(y){var a=(e.clientX-c.left)/c.width;h(Math.min(t,Math.max(0,Math.floor(a*t))))}}),I=Object(L.a)(e=>{f(!1);var n=(e.clientX-c.left)/c.width,o=Math.min(t,Math.max(0,Math.floor(n*t)));h(o),a(o)});return t?o.a.createElement(Tt,{onMouseMove:j,onMouseUp:I,ref:s},wt()(0,t,w).map(e=>o.a.createElement(o.a.Fragment,null,o.a.createElement(Ct,{key:e,style:{left:e/t*c.width,height:"50%"}}),o.a.createElement(Mt,{style:{left:e/t*c.width+8,bottom:"calc(50% - 12px)"}},It(e)))),wt()(0,t,x).filter(e=>!Number.isInteger(e/w)).map(e=>o.a.createElement(Ct,{key:e,style:{left:e/t*c.width,height:"25%"}})),E.map(e=>o.a.createElement(Nt,{onClick:()=>a(e),key:e,style:{left:e/t*c.width}})),o.a.createElement(St,{onMouseDown:e=>f(!0),style:{cursor:y?"grabbing":"grab",left:m/t*c.width}},It(m))):null},_t=a(278),Dt=(a(141),a(921),a(264)),Pt=Object(l.a)({container:{margin:8},header:{display:"flex",flexDirection:"row",alignItems:"center",padding:8,paddingLeft:16,paddingRight:16},title:{fontSize:14,fontWeight:"bold",flexGrow:1,paddingLeft:8,color:U.a[800],"& span":{color:U.a[600],fontSize:12}},expandButton:{padding:0,width:30,height:30,"& .icon":{marginTop:-6,width:20,height:20,transition:"500ms transform","&.expanded":{transform:"rotate(180deg)"}}},expandedContent:{maxHeight:300,overflowY:"auto","&.noScroll":{overflowY:"visible",overflow:"visible"}}}),Rt=Object(n.memo)(({icon:e,title:t,subTitle:a,children:i,noScroll:r=!1,expandedByDefault:l=!1})=>{var s=Pt(),c=(K()(s.expandedContent,r&&"noScroll"),Object(n.useState)(l)),d=Object(u.a)(c,2),g=d[0],m=d[1];Object(L.a)(()=>m(!g));return o.a.createElement(Dt.a,{icon:e,title:t},i)},(e,t)=>e.title===t.title&&e.children===t.children),Bt=({state:e,lastAction:t})=>{var a=(e.images||[])[e.selectedImage],n=a?(a.regions||[]).filter(e=>e.highlighted):null;return o.a.createElement(Rt,{title:"Debug",icon:o.a.createElement("span",null),expandedByDefault:!0},o.a.createElement("div",{style:{padding:4}},o.a.createElement("div",null,o.a.createElement("b",null,"region"),":"),o.a.createElement("pre",null,JSON.stringify(n,null,"  ")),o.a.createElement("div",null,o.a.createElement("b",null,"lastAction"),":"),o.a.createElement("pre",null,JSON.stringify(t,null,"  ")),o.a.createElement("div",null,o.a.createElement("b",null,"mode"),":"),o.a.createElement("pre",null,JSON.stringify(e.mode,null,"  ")),o.a.createElement("div",null,o.a.createElement("b",null,"frame:")),o.a.createElement("pre",null,JSON.stringify(e.selectedImageFrameTime,null,"  "))))},Wt=a(265),zt=a.n(Wt),Gt=(Object(l.a)({}),[]),Ht=()=>null,Vt=Object(n.memo)(({currentImage:e,imageClsList:t=Gt,imageTagList:a=Gt,onChangeImage:i=Ht})=>{var r=e||{},l=r.tags,s=void 0===l?[]:l,c=r.cls,d=void 0===c?null:c,g=Object(L.a)(e=>i({cls:e.value})),m=Object(L.a)(e=>i({tags:e.map(e=>e.value)})),u=Object(n.useMemo)(()=>d?{value:d,label:d}:null,[d]),h=Object(n.useMemo)(()=>Object(ee.asMutable)(t.map(e=>({value:e,label:e}))),[t]),b=Object(n.useMemo)(()=>Object(ee.asMutable)(a.map(e=>({value:e,label:e}))),[a]),y=Object(n.useMemo)(()=>s.map(e=>({value:e,label:e})),[s]);return e?o.a.createElement(Rt,{title:"Image Tags",expandedByDefault:!0,noScroll:!0,icon:o.a.createElement(zt.a,{style:{color:U.a[700]}})},t.length>0&&o.a.createElement("div",{style:{padding:8}},o.a.createElement(p.default,{placeholder:"Image Classification",onChange:g,value:u,options:h})),a.length>0&&o.a.createElement("div",{style:{padding:8,paddingTop:0}},o.a.createElement(p.default,{isMulti:!0,placeholder:"Image Tags",onChange:m,value:y,options:b}))):null},(e,t)=>e.currentImage.cls===t.currentImage.cls&&e.currentImage.tags===t.currentImage.tags&&e.imageClsList===t.imageClsList&&e.imageTagList===t.imageTagList),Ut=a(266),Ft=a.n(Ut),Yt=Object(S.a)("div")({cursor:"pointer",display:"flex",alignItems:"center",padding:8,fontSize:14,color:U.a[700],"&.current":{backgroundColor:se.a[100]},"&:hover":{backgroundColor:U.a[100]},"& .time":{flexGrow:1,fontWeight:"bold","& .regionCount":{marginLeft:8,fontWeight:"normal",color:U.a[500]}},"& .trash":{"& .icon":{fontSize:18,color:U.a[600],transition:"transform 80ms","&:hover":{color:U.a[800],transform:"scale(1.25,1.25)"}}}}),Kt=({currentVideoTime:e,keyframes:t,onChangeVideoTime:a,onDeleteKeyframe:n})=>{var i=Object.keys(t).map(e=>parseInt(e));return o.a.createElement(Rt,{title:"Keyframes",subTitle:"",icon:o.a.createElement(Ft.a,{style:{color:U.a[700]}}),expandedByDefault:!0},i.map(i=>{var r;return o.a.createElement(Yt,{fullWidth:!0,key:i,className:e===i?"current":"",onClick:()=>a(i)},o.a.createElement("div",{className:"time"},It(i,2),o.a.createElement("span",{className:"regionCount"},"(",((null===(r=t[i])||void 0===r?void 0:r.regions)||[]).length,")")),o.a.createElement("div",{className:"trash"},o.a.createElement(J.a,{onClick:e=>{n(i),e.stopPropagation()},className:"icon"})))}))},Xt=a(267),Zt=a.n(Xt),Jt=a(142),qt=a.n(Jt),$t=Object(S.a)("div")({paddingLeft:16,paddingRight:16,fontSize:12,"& h1":{fontSize:18},"& h2":{fontSize:14},"& h3":{fontSize:12},"& h4":{fontSize:12},"& h5":{fontSize:12},"& h6":{fontSize:12},"& p":{fontSize:12},"& a":{},"& img":{width:"100%"}}),Qt=Object(n.memo)(({description:e})=>o.a.createElement(Rt,{title:"Task Description",icon:o.a.createElement(Zt.a,{style:{color:U.a[700]}}),expandedByDefault:!e||""===e},o.a.createElement($t,null,o.a.createElement(qt.a,{source:e})))),ea=a(272),ta=a.n(ea),aa=a(962),na=a(268),oa=a.n(na),ia=a(269),ra=a.n(ia),la=a(270),sa=a.n(la),ca=a(176),da=a.n(ca),ga=a(271),ma=a.n(ga),ua={container:{fontSize:11,fontWeight:"bold",color:U.a[700],"& .icon":{marginTop:4,width:16,height:16},"& .icon2":{opacity:.5,width:16,height:16,transition:"200ms opacity","&:hover":{cursor:"pointer",opacity:1}}},row:{padding:4,cursor:"pointer","&.header:hover":{backgroundColor:"#fff"},"&.highlighted":{backgroundColor:se.a[100]},"&:hover":{backgroundColor:se.a[50],color:U.a[800]}},chip:{display:"flex",flexDirection:"row",padding:2,borderRadius:2,paddingLeft:4,paddingRight:4,alignItems:"center","& .color":{borderRadius:5,width:10,height:10,marginRight:4},"& .text":{}}},ha=a(57),pa=a.n(ha),ba=Object(l.a)(ua),ya=Object(S.a)("div")({borderTop:"1px solid ".concat(U.a[200]),marginTop:2,marginBottom:2}),fa=({color:e,text:t})=>{var a=ba();return o.a.createElement("span",{className:a.chip},o.a.createElement("div",{className:"color",style:{backgroundColor:e}}),o.a.createElement("div",{className:"text"},t))},Ea=({header:e,highlighted:t,order:a,classification:i,area:r,tags:l,trash:s,lock:c,visible:d,onClick:g})=>{var m=ba(),h=Object(n.useState)(!1),p=Object(u.a)(h,2),b=(p[0],p[1]);return o.a.createElement("div",{onClick:g,onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),className:K()(m.row,{header:e,highlighted:t})},o.a.createElement(aa.a,{container:!0,alignItems:"center"},o.a.createElement(aa.a,{item:!0,xs:2},o.a.createElement("div",{style:{textAlign:"right",paddingRight:10}},a)),o.a.createElement(aa.a,{item:!0,xs:5},i),o.a.createElement(aa.a,{item:!0,xs:2},o.a.createElement("div",{style:{textAlign:"right",paddingRight:6}},r)),o.a.createElement(aa.a,{item:!0,xs:1},s),o.a.createElement(aa.a,{item:!0,xs:1},c),o.a.createElement(aa.a,{item:!0,xs:1},d)))},Oa=Object(n.memo)(()=>o.a.createElement(Ea,{header:!0,highlighted:!1,order:o.a.createElement(oa.a,{className:"icon"}),classification:o.a.createElement("div",{style:{paddingLeft:10}},"Class"),area:o.a.createElement(ra.a,{className:"icon"}),trash:o.a.createElement(J.a,{className:"icon"}),lock:o.a.createElement(ie.a,{className:"icon"}),visible:o.a.createElement(da.a,{className:"icon"})})),va=Object(n.memo)(({region:e,highlighted:t,onSelectRegion:a,onDeleteRegion:n,onChangeRegion:i,visible:r,locked:l,color:s,cls:c,index:d})=>o.a.createElement(Ea,{header:!1,highlighted:t,onClick:()=>a(e),order:"#".concat(d+1),classification:o.a.createElement(fa,{text:c||"",color:s||"#ddd"}),area:"",trash:o.a.createElement(J.a,{onClick:()=>n(e),className:"icon2"}),lock:e.locked?o.a.createElement(ie.a,{onClick:()=>i(Object(C.a)(Object(C.a)({},e),{},{locked:!1})),className:"icon2"}):o.a.createElement(sa.a,{onClick:()=>i(Object(C.a)(Object(C.a)({},e),{},{locked:!0})),className:"icon2"}),visible:e.visible||void 0===e.visible?o.a.createElement(da.a,{onClick:()=>i(Object(C.a)(Object(C.a)({},e),{},{visible:!1})),className:"icon2"}):o.a.createElement(ma.a,{onClick:()=>i(Object(C.a)(Object(C.a)({},e),{},{visible:!0})),className:"icon2"})}),(e,t)=>e.highlighted===t.highlighted&&e.visible===t.visible&&e.locked===t.locked&&e.id===t.id&&e.index===t.index&&e.cls===t.cls&&e.color===t.color),xa=[],wa=e=>[e.id,e.color,e.locked,e.visible,e.highlighted],ja=Object(n.memo)(({regions:e=xa,onDeleteRegion:t,onChangeRegion:a,onSelectRegion:n})=>{var i=ba();return o.a.createElement(Rt,{title:"Regions",subTitle:"",icon:o.a.createElement(ta.a,{style:{color:U.a[700]}}),expandedByDefault:!0},o.a.createElement("div",{className:i.container},o.a.createElement(Oa,null),o.a.createElement(ya,null),e.map((e,i)=>o.a.createElement(va,Object.assign({key:e.id},e,{region:e,index:i,onSelectRegion:n,onDeleteRegion:t,onChangeRegion:a})))))},(e,t)=>pa()((e.regions||xa).map(wa),(t.regions||xa).map(wa))),Ia=a(273),Ta=a.n(Ia),Ca=a(960),Ma=a(961),Sa=a(204),Na=Object(l.a)({img:{width:40,height:40,borderRadius:8}}),ka=e=>[e.name,(e.regions||[]).length,e.src],Aa=(Object(n.memo)(({images:e,onSelect:t})=>{var a=Na();return o.a.createElement(Rt,{title:"Images",subTitle:"(".concat(e.length,")"),icon:o.a.createElement(Ta.a,{style:{color:U.a[700]}})},o.a.createElement("div",null,o.a.createElement(Ca.a,null,e.map((e,n)=>o.a.createElement(Ma.a,{button:!0,onClick:()=>t(e),dense:!0,key:n},o.a.createElement("img",{className:a.img,src:e.src}),o.a.createElement(Sa.a,{primary:e.name,secondary:"".concat((e.regions||[]).length," Labels")}))))))},(e,t)=>pa()(e.images.map(ka),t.images.map(ka))),a(274)),La=a.n(Aa),_a=a(963),Da=a(167),Pa=a.n(Da),Ra=a(95),Ba=a.n(Ra),Wa=Object(l.a)({emptyText:{fontSize:14,fontWeight:"bold",color:U.a[500],textAlign:"center",padding:20}}),za={paddingLeft:16},Ga=Object(n.memo)(({history:e,onRestoreHistory:t})=>{var a=Wa();return o.a.createElement(Rt,{title:"History",icon:o.a.createElement(La.a,{style:{color:U.a[700]}}),expandedByDefault:!0},o.a.createElement(Ca.a,null,0===e.length&&o.a.createElement("div",{className:a.emptyText},"No History Yet"),e.map(({name:e,time:a},n)=>o.a.createElement(Ma.a,{button:!0,dense:!0,key:n},o.a.createElement(Sa.a,{style:za,primary:e,secondary:Ba()(a).format("LT")}),0===n&&o.a.createElement(_a.a,{onClick:()=>t()},o.a.createElement(X.a,null,o.a.createElement(Pa.a,null)))))))},(e,t)=>pa()(e.history.map(e=>[e.name,e.time]),t.history.map(e=>[e.name,e.time]))),Ha=[],Va=Object(l.a)(Ze),Ua=Object(lt.withHotKeys)(e=>{var t=e.hotKeys,a=e.children,n=e.divRef,i=Object(M.a)(e,["hotKeys","children","divRef"]);return o.a.createElement("div",Object.assign({},Object(C.a)(Object(C.a)({},t),i),{ref:n}),a)}),Fa=Object(S.a)("div")({width:"100%",height:"100%","& .fullscreen":{width:"100%",height:"100%"}}),Ya=({state:e,dispatch:t,alwaysShowNextButton:a=!1,alwaysShowPrevButton:i=!1,RegionEditLabel:r,onRegionClassAdded:l})=>{var s,c=Va(),d=_e(),g=Object(tt.b)(),m=Object(n.useRef)({}),u=(e,...a)=>{var n="".concat(e,"(").concat(a.join(","),")");if(m.current[n])return m.current[n];var o=(...n)=>a.length>0?t(Object(C.a)({type:e},a.reduce((e,t,a)=>(e[t]=n[a],e),{}))):t(Object(C.a)({type:e},n[0]));return m.current[n]=o,o},h=at(e),p=h.currentImageIndex,b=h.activeImage;null!==p&&(s=e.images[p+1]),qe()(()=>t({type:"CANCEL"}),{detectKeys:[27]});b&&b.frameTime;var y=Object(n.useRef)(),f=ht({dispatch:t}),E=(e=>{if("video"!==e.annotationType)return rt;var t=e.keyframes,a=e.currentVideoTime,o=void 0===a?0:a;return Object(n.useMemo)(()=>it(t,o),[t,o])})(e),O=Object(n.useCallback)(e=>{y.current&&(y.current.contains(document.activeElement)||y.current.contains(e.target)&&(y.current.focus(),e.target.focus()))},[]),v=o.a.createElement(Xe,Object.assign({},d,{showCrosshairs:d.showCrosshairs&&!["select","pan","zoom"].includes(e.selectedTool),key:e.selectedImage,showMask:e.showMask,fullImageSegmentationMode:e.fullImageSegmentationMode,autoSegmentationOptions:e.autoSegmentationOptions,showTags:e.showTags,allowedArea:e.allowedArea,modifyingAllowedArea:"modify-allowed-area"===e.selectedTool,regionClsList:e.regionClsList,regionTagList:e.regionTagList,regions:"image"===e.annotationType?b.regions||[]:E,realSize:b?b.realSize:void 0,videoPlaying:e.videoPlaying,imageSrc:"image"===e.annotationType?b.src:null,videoSrc:"video"===e.annotationType?e.videoSrc:null,pointDistancePrecision:e.pointDistancePrecision,createWithPrimary:e.selectedTool.includes("create"),dragWithPrimary:"pan"===e.selectedTool,zoomWithPrimary:"zoom"===e.selectedTool,showPointDistances:e.showPointDistances,videoTime:"image"===e.annotationType?e.selectedImageFrameTime:e.currentVideoTime,keypointDefinitions:e.keypointDefinitions,onMouseMove:u("MOUSE_MOVE"),onMouseDown:u("MOUSE_DOWN"),onMouseUp:u("MOUSE_UP"),onChangeRegion:u("CHANGE_REGION","region"),onBeginRegionEdit:u("OPEN_REGION_EDITOR","region"),onCloseRegionEdit:u("CLOSE_REGION_EDITOR","region"),onDeleteRegion:u("DELETE_REGION","region"),onBeginBoxTransform:u("BEGIN_BOX_TRANSFORM","box","directions"),onBeginMovePolygonPoint:u("BEGIN_MOVE_POLYGON_POINT","polygon","pointIndex"),onBeginMoveKeypoint:u("BEGIN_MOVE_KEYPOINT","region","keypointId"),onAddPolygonPoint:u("ADD_POLYGON_POINT","polygon","point","pointIndex"),onSelectRegion:u("SELECT_REGION","region"),onBeginMovePoint:u("BEGIN_MOVE_POINT","point"),onImageLoaded:u("IMAGE_LOADED","image"),RegionEditLabel:r,onImageOrVideoLoaded:u("IMAGE_OR_VIDEO_LOADED","metadata"),onChangeVideoTime:u("CHANGE_VIDEO_TIME","newTime"),onChangeVideoPlaying:u("CHANGE_VIDEO_PLAYING","isPlaying"),onRegionClassAdded:l})),x=Object(L.a)(e=>{t({type:"SELECT_TOOL",selectedTool:e.name})}),w=Object(L.a)(e=>{"Fullscreen"===e.name?g.enter():"Window"===e.name&&g.exit(),t({type:"HEADER_BUTTON_CLICKED",buttonName:e.name})}),j=Boolean(window.localStorage.$ANNOTATE_DEBUG_MODE&&e),I=!s||s.regions&&s.regions.length>0;return o.a.createElement(Fa,null,o.a.createElement(tt.a,{handle:g,onChange:e=>{e||(g.exit(),u("HEADER_BUTTON_CLICKED","buttonName")("Window"))}},o.a.createElement(Ua,{tabIndex:-1,divRef:y,onMouseDown:O,onMouseOver:O,allowChanges:!0,handlers:f,className:K()(c.container,e.fullScreen&&"Fullscreen")},o.a.createElement(_t.a,{allowFullscreen:!0,iconDictionary:vt,headerLeftSide:["video"===e.annotationType?o.a.createElement(Lt,{currentTime:e.currentVideoTime,duration:e.videoDuration,onChangeCurrentTime:u("CHANGE_VIDEO_TIME","newTime"),keyframes:e.keyframes}):b?o.a.createElement("div",{className:c.headerTitle},b.name):null].filter(Boolean),headerItems:[{name:"Prev"},{name:"Next"},"video"!==e.annotationType?null:e.videoPlaying?{name:"Pause"}:{name:"Play"},!I&&b.regions&&{name:"Clone"},{name:"Settings"},e.fullScreen?{name:"Window"}:{name:"Fullscreen"},{name:"Save"}].filter(Boolean),onClickHeaderItem:w,onClickIconSidebarItem:x,selectedTools:[e.selectedTool,e.showTags&&"show-tags",e.showMask&&"show-mask"].filter(Boolean),iconSidebarItems:[{name:"select",helperText:"Select",alwaysShowing:!0},{name:"pan",helperText:"Drag/Pan",alwaysShowing:!0},{name:"zoom",helperText:"Zoom In/Out",alwaysShowing:!0},{name:"show-tags",helperText:"Show / Hide Tags",alwaysShowing:!0},{name:"create-point",helperText:"Add Point"},{name:"create-box",helperText:"Add Bounding Box"},{name:"create-polygon",helperText:"Add Polygon"},{name:"create-expanding-line",helperText:"Add Expanding Line"},{name:"create-keypoints",helperText:"Add Keypoints (Pose)"},e.fullImageSegmentationMode&&{name:"show-mask",alwaysShowing:!0,helperText:"Show / Hide Mask"},{name:"modify-allowed-area",helperText:"Modify Allowed Area"}].filter(Boolean).filter(t=>t.alwaysShowing||e.enabledTools.includes(t.name)),rightSidebarItems:[j&&o.a.createElement(Bt,{state:j,lastAction:e.lastAction}),e.taskDescription&&o.a.createElement(Qt,{description:e.taskDescription}),e.labelImages&&o.a.createElement(Vt,{currentImage:b,imageClsList:e.imageClsList,imageTagList:e.imageTagList,onChangeImage:u("CHANGE_IMAGE","delta"),expandedByDefault:!0}),o.a.createElement(ja,{regions:b?b.regions:Ha,onSelectRegion:u("SELECT_REGION","region"),onDeleteRegion:u("DELETE_REGION","region"),onChangeRegion:u("CHANGE_REGION","region")}),e.keyframes&&o.a.createElement(Kt,{onChangeVideoTime:u("CHANGE_VIDEO_TIME","newTime"),onDeleteKeyframe:u("DELETE_KEYFRAME","time"),onChangeCurrentTime:u("CHANGE_VIDEO_TIME","newTime"),currentTime:e.currentVideoTime,duration:e.videoDuration,keyframes:e.keyframes}),o.a.createElement(Ga,{history:e.history,onRestoreHistory:u("RESTORE_HISTORY")})].filter(Boolean)},v),o.a.createElement(et,{open:e.settingsOpen,onClose:()=>t({type:"HEADER_BUTTON_CLICKED",buttonName:"Settings"})}))))},Ka={BEGIN_BOX_TRANSFORM:"Transform/Move Box",BEGIN_MOVE_POINT:"Move Point",DELETE_REGION:"Delete Region"},Xa=(e,t)=>Object(ee.updateIn)(e,["history"],a=>[{time:Ba()().toDate(),state:Object(ee.without)(e,"history"),name:t}].concat((a||[]).slice(0,9)));function Za(e,t,a){return e<=t?t:e>=a?a:e}var Ja=e=>{var t=e.expandingWidth||.005,a=e.points.map(({x:a,y:n,angle:o,width:i},r)=>{if(!o){var l=e.points[Za(r+1,0,e.points.length-1)],s=e.points[Za(r-1,0,e.points.length-1)];o=Math.atan2(s.x-l.x,s.y-l.y)+Math.PI/2}var c=Math.sin(o)*(i||t)/2,d=Math.cos(o)*(i||t)/2;return[{x:a+c,y:n+d},{x:a-c,y:n-d}]}),n=a.map(([e,t])=>e),o=a.map(([e,t])=>t).asMutable();o.reverse();var i=n.concat(o).map(({x:e,y:t})=>[e,t]);return Object(C.a)(Object(C.a)({},e),{},{type:"polygon",open:!1,points:i,unfinished:void 0,candidatePoint:void 0})},qa=a(177),$a=a.n(qa),Qa=({center:e,scale:t,landmarks:a})=>{var n,o={},i=Object(nt.a)(Object.entries(a));try{for(i.s();!(n=i.n()).done;){var r=Object(u.a)(n.value,2),l=r[0],s=r[1].defaultPosition;o[l]={x:s[0]*t+e.x,y:s[1]*t+e.y}}}catch(c){i.e(c)}finally{i.f()}return o},en=()=>Math.random().toString().split(".")[1],tn=(e,t)=>{if(e.allowedArea&&"modify-allowed-area"!==e.selectedTool&&["MOUSE_DOWN","MOUSE_UP","MOUSE_MOVE"].includes(t.type)){var a=e.allowedArea;t.x=$a()(t.x,a.x,a.x+a.w),t.y=$a()(t.y,a.y,a.y+a.h)}if("ON_CLS_ADDED"===t.type&&t.cls&&""!==t.cls){var n=e.regionClsList;return Object(C.a)(Object(C.a)({},e),{},{regionClsList:n.concat(t.cls)})}if("MOUSE_MOVE"===t.type){if(Date.now()-(e.lastMouseMoveCall||0)<16)return e;e=Object(ee.setIn)(e,["lastMouseMoveCall"],Date.now())}t.type.includes("MOUSE")||(e=Object(ee.setIn)(e,["lastAction"],t));var o=at(e),i=o.currentImageIndex,r=o.pathToActiveImage,l=o.activeImage,s=e=>{var t="string"===typeof e||"number"===typeof e?e:e.id;if(!l)return null;var a=(l.regions||[]).findIndex(e=>e.id===t);return-1===a?null:a},c=e=>{if(!l)return null;var t=s(e);return null===t?[null,null]:[l.regions[t],t]},d=(t,a)=>{var n=c(t),o=Object(u.a)(n,2),i=o[0],s=o[1];if(!i)return e;if(null!==a)return Object(ee.setIn)(e,[...r,"regions",s],Object(C.a)(Object(C.a)({},i),a));var d=l.regions;return Object(ee.setIn)(e,[...r,"regions"],(d||[]).filter(e=>e.id!==i.id))},g=e=>null===i?e:Object(ee.setIn)(e,[...r,"regions"],(l.regions||[]).map(e=>Object(C.a)(Object(C.a)({},e),{},{editingLabels:!1}))),m=(t,a)=>{var n="object"===typeof t?t:{src:t},o=(n.src,n.frameTime);return Object(ee.setIn)(Object(ee.setIn)(e,["selectedImage"],a),["selectedImageFrameTime"],o)};switch(t.type){case"@@INIT":return e;case"SELECT_IMAGE":return m(t.image,t.imageIndex);case"CHANGE_REGION":var h=s(t.region);if(null===h)return e;var p=l.regions[h];if(p.cls!==t.region.cls){var b=(e=Xa(e,"Change Region Classification")).regionClsList.indexOf(t.region.cls);-1!==b&&(t.region.color=Oe[b%Oe.length])}return pa()(p.tags,t.region.tags)||(e=Xa(e,"Change Region Tags")),Object(ee.setIn)(e,[...r,"regions",h],t.region);case"CHANGE_IMAGE":if(!l)return e;for(var y=t.delta,f=0,E=Object.keys(y);f<E.length;f++){var O=E[f];"cls"===O&&Xa(e,"Change Image Class"),"tags"===O&&Xa(e,"Change Image Tags"),e=Object(ee.setIn)(e,[...r,O],y[O])}return e;case"SELECT_REGION":var v=t.region;if(null===s(t.region))return e;var x=[...l.regions||[]].map(e=>Object(C.a)(Object(C.a)({},e),{},{highlighted:e.id===v.id,editingLabels:e.id===v.id}));return Object(ee.setIn)(e,[...r,"regions"],x);case"BEGIN_MOVE_POINT":return e=g(e),Object(ee.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:t.point.id});case"BEGIN_BOX_TRANSFORM":var w=t.box,j=t.directions;return e=g(e),0===j[0]&&0===j[1]?Object(ee.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:w.id}):Object(ee.setIn)(e,["mode"],{mode:"RESIZE_BOX",regionId:w.id,freedom:j,original:{x:w.x,y:w.y,w:w.w,h:w.h}});case"BEGIN_MOVE_POLYGON_POINT":var I=t.polygon,T=t.pointIndex;return(e=g(e)).mode&&"DRAW_POLYGON"===e.mode.mode&&0===T?Object(ee.setIn)(d(I,{points:I.points.slice(0,-1),open:!1}),["mode"],null):(e=Xa(e,"Move Polygon Point"),Object(ee.setIn)(e,["mode"],{mode:"MOVE_POLYGON_POINT",regionId:I.id,pointIndex:T}));case"BEGIN_MOVE_KEYPOINT":var M=t.region,S=t.keypointId;return e=g(e),e=Xa(e,"Move Keypoint"),Object(ee.setIn)(e,["mode"],{mode:"MOVE_KEYPOINT",regionId:M.id,keypointId:S});case"ADD_POLYGON_POINT":var N=t.polygon,k=t.point,A=t.pointIndex,L=s(N);if(null===L)return e;var _=[...N.points];return _.splice(A,0,k),Object(ee.setIn)(e,[...r,"regions",L],Object(C.a)(Object(C.a)({},N),{},{points:_}));case"MOUSE_MOVE":var D=t.x,P=t.y;if(!e.mode)return e;if(!l)return e;e.mouseDownAt;switch(e.mode.mode){case"MOVE_POLYGON_POINT":var R=e.mode,B=R.pointIndex,W=R.regionId,z=s(W);return null===z?e:Object(ee.setIn)(e,[...r,"regions",z,"points",B],[D,P]);case"MOVE_KEYPOINT":var G=e.mode,H=G.keypointId,V=G.regionId,U=c(V),F=Object(u.a)(U,2),Y=F[0],K=F[1];return null===K?e:Object(ee.setIn)(e,[...r,"regions",K,"points",H],Object(C.a)(Object(C.a)({},Y.points[H]),{},{x:D,y:P}));case"MOVE_REGION":var X=e.mode.regionId;if("$$allowed_area"===X){var Z=e.allowedArea,J=Z.w,q=Z.h;return Object(ee.setIn)(e,["allowedArea"],{x:D-J/2,y:P-q/2,w:J,h:q})}var $=s(X);return null===$?e:Object(ee.setIn)(e,[...r,"regions",$],((e,t,a)=>{switch(e.type){case"point":return Object(C.a)(Object(C.a)({},e),{},{x:t,y:a});case"box":return Object(C.a)(Object(C.a)({},e),{},{x:t-e.w/2,y:a-e.h/2})}return e})(l.regions[$],D,P));case"RESIZE_BOX":var Q=e.mode,te=Q.regionId,ae=Object(u.a)(Q.freedom,2),ne=ae[0],oe=ae[1],ie=Q.original,re=ie.x,le=ie.y,se=ie.w,ce=ie.h,de=0===ne?re:-1===ne?Math.min(re+se,D):re,ge=0===ne?se:-1===ne?se+(re-de):Math.max(0,se+(D-re-se)),me=0===oe?le:-1===oe?Math.min(le+ce,P):le,ue=0===oe?ce:-1===oe?ce+(le-me):Math.max(0,ce+(P-le-ce));if(ge<=.001&&(e=Object(ee.setIn)(e,["mode","freedom"],[-1*ne,oe])),ue<=.001&&(e=Object(ee.setIn)(e,["mode","freedom"],[ne,-1*oe])),"$$allowed_area"===te)return Object(ee.setIn)(e,["allowedArea"],{x:de,w:ge,y:me,h:ue});var he=s(te);if(null===he)return e;var pe=l.regions[he];return Object(ee.setIn)(e,[...r,"regions",he],Object(C.a)(Object(C.a)({},pe),{},{x:de,w:ge,y:me,h:ue}));case"RESIZE_KEYPOINTS":var be=e.mode,ye=be.regionId,fe=be.landmarks,Ee=be.centerX,ve=be.centerY,xe=Math.sqrt(Math.pow(Ee-D,2)+Math.pow(ve-P,2));return d(ye,{points:Qa({landmarks:fe,center:{x:Ee,y:ve},scale:xe/.15})});case"DRAW_POLYGON":var we=e.mode.regionId,je=c(we),Ie=Object(u.a)(je,2),Te=Ie[0],Ce=Ie[1];return Te?Object(ee.setIn)(e,[...r,"regions",Ce,"points",Te.points.length-1],[D,P]):Object(ee.setIn)(e,["mode"],null);case"DRAW_EXPANDING_LINE":var Me=e.mode.regionId,Se=c(Me),Ne=Object(u.a)(Se,2),ke=Ne[0],Ae=Ne[1];if(!ke)return e;if(Boolean(e.mouseDownAt)){var Le=ke.points.slice(-1)[0],_e=Math.sqrt(Math.pow(Le.x-D,2)+Math.pow(Le.y-P,2));return _e<.002&&!Le.width?e:Object(ee.setIn)(e,[...r,"regions",Ae,"points"],ke.points.slice(0,-1).concat([Object(C.a)(Object(C.a)({},Le),{},{width:2*_e,angle:Math.atan2(Le.x-D,Le.y-P)})]))}return Object(ee.setIn)(e,[...r,"regions",Ae],Object(C.a)(Object(C.a)({},ke),{},{candidatePoint:{x:D,y:P}}));case"SET_EXPANDING_LINE_WIDTH":var De=e.mode.regionId,Pe=c(De),Re=Object(u.a)(Pe,2),Be=Re[0],We=Re[1];if(!Be)return e;var ze=Be.points.slice(-1)[0];e.mouseDownAt;return Object(ee.setIn)(e,[...r,"regions",We,"expandingWidth"],Math.sqrt(Math.pow(ze.x-D,2)+Math.pow(ze.y-P,2)));default:return e}case"MOUSE_DOWN":if(!l)return e;var Ge,He=t.x,Ve=t.y;if((e=Object(ee.setIn)(e,["mouseDownAt"],{x:He,y:Ve})).mode)switch(e.mode.mode){case"DRAW_POLYGON":var Ue=c(e.mode.regionId),Fe=Object(u.a)(Ue,2),Ye=Fe[0],Ke=Fe[1];if(!Ye)break;return Object(ee.setIn)(e,[...r,"regions",Ke],Object(C.a)(Object(C.a)({},Ye),{},{points:Ye.points.concat([[He,Ve]])}));case"DRAW_EXPANDING_LINE":var Xe=c(e.mode.regionId),Ze=Object(u.a)(Xe,2),Je=Ze[0],qe=Ze[1];if(!Je)break;var $e=Je.points.slice(-1)[0];return Je.points.length>1&&Math.sqrt(Math.pow($e.x-He,2)+Math.pow($e.y-Ve,2))<.002?$e.width?e.setIn([...r,"regions",qe],Ja(Je)).setIn(["mode"],null):Object(ee.setIn)(e,["mode"],{mode:"SET_EXPANDING_LINE_WIDTH",regionId:e.mode.regionId}):Object(ee.setIn)(e,[...r,"regions",qe,"points"],Je.points.concat([{x:He,y:Ve,angle:null,width:null}]));case"SET_EXPANDING_LINE_WIDTH":var Qe=c(e.mode.regionId),et=Object(u.a)(Qe,2),tt=et[0],nt=et[1];if(!tt)break;var ot=tt.expandingWidth;return e.setIn([...r,"regions",nt],Ja(Object(C.a)(Object(C.a)({},tt),{},{points:tt.points.map(e=>e.width?e:Object(C.a)(Object(C.a)({},e),{},{width:ot})),expandingWidth:void 0}))).setIn(["mode"],null)}var it=void 0,rt="#ff0000";if(l&&(l.regions||[]).length>0){it=l.regions.slice(-1)[0].cls;var lt=(e.regionClsList||[]).indexOf(it);-1!==lt&&(rt=Oe[lt%Oe.length])}switch(e.selectedTool){case"create-point":e=Xa(e,"Create Point"),Ge={type:"point",x:He,y:Ve,highlighted:!0,editingLabels:!0,color:rt,id:en(),cls:it};break;case"create-box":e=Xa(e,"Create Box"),Ge={type:"box",x:He,y:Ve,w:0,h:0,highlighted:!0,editingLabels:!1,color:rt,cls:it,id:en()},e=Object(ee.setIn)(e,["mode"],{mode:"RESIZE_BOX",editLabelEditorAfter:!0,regionId:Ge.id,freedom:[1,1],original:{x:He,y:Ve,w:Ge.w,h:Ge.h},isNew:!0});break;case"create-polygon":if(e.mode&&"DRAW_POLYGON"===e.mode.mode)break;e=Xa(e,"Create Polygon"),Ge={type:"polygon",points:[[He,Ve],[He,Ve]],open:!0,highlighted:!0,color:rt,cls:it,id:en()},e=Object(ee.setIn)(e,["mode"],{mode:"DRAW_POLYGON",regionId:Ge.id});break;case"create-expanding-line":e=Xa(e,"Create Expanding Line"),Ge={type:"expanding-line",unfinished:!0,points:[{x:He,y:Ve,angle:null,width:null}],open:!0,highlighted:!0,color:rt,cls:it,id:en()},e=Object(ee.setIn)(e,["mode"],{mode:"DRAW_EXPANDING_LINE",regionId:Ge.id});break;case"create-keypoints":e=Xa(e,"Create Keypoints");var st=Object.entries(e.keypointDefinitions),ct=Object(u.a)(st,1),dt=Object(u.a)(ct[0],2),gt=dt[0],mt=dt[1],ut=mt.landmarks;mt.connections;Ge={type:"keypoints",keypointsDefinitionId:gt,points:Qa({landmarks:ut,center:{x:He,y:Ve},scale:1}),highlighted:!0,editingLabels:!1,id:en()},e=Object(ee.setIn)(e,["mode"],{mode:"RESIZE_KEYPOINTS",landmarks:ut,centerX:He,centerY:Ve,regionId:Ge.id,isNew:!0})}var ht=[...Object(ee.getIn)(e,r).regions||[]].map(e=>Object(ee.setIn)(e,["editingLabels"],!1).setIn(["highlighted"],!1)).concat(Ge?[Ge]:[]);return Object(ee.setIn)(e,[...r,"regions"],ht);case"MOUSE_UP":var pt=t.x,bt=t.y,yt=e.mouseDownAt,ft=void 0===yt?{x:pt,y:bt}:yt;if(!e.mode)return e;switch((e=Object(ee.setIn)(e,["mouseDownAt"],null)).mode.mode){case"RESIZE_BOX":if(e.mode.isNew&&(Math.abs(e.mode.original.x-pt)<.002||Math.abs(e.mode.original.y-bt)<.002))return Object(ee.setIn)(d(e.mode.regionId,null),["mode"],null);if(e.mode.editLabelEditorAfter)return Object(C.a)(Object(C.a)({},d(e.mode.regionId,{editingLabels:!0})),{},{mode:null});case"MOVE_REGION":case"RESIZE_KEYPOINTS":case"MOVE_POLYGON_POINT":case"MOVE_KEYPOINT":return Object(C.a)(Object(C.a)({},e),{},{mode:null});case"CREATE_POINT_LINE":return e;case"DRAW_EXPANDING_LINE":var Et=c(e.mode.regionId),Ot=Object(u.a)(Et,2),vt=Ot[0],xt=Ot[1];if(!vt)return e;var wt=vt,jt=0!==vt.points.length?vt.points.slice(-1)[0]:ft;if(vt.points.length>1?vt.points.slice(-2)[0]:jt,!(Math.sqrt(Math.pow(jt.x-pt,2)+Math.pow(jt.y-bt,2))>.002))return e;for(var It=[...vt.points],Tt=0;Tt<It.length-1;Tt++)It[Tt].width||(It[Tt]=Object(C.a)(Object(C.a)({},It[Tt]),{},{width:jt.width}));return wt=Object(ee.setIn)(vt,["points"],It),Object(ee.setIn)(e,[...r,"regions",xt],wt);default:return e}case"OPEN_REGION_EDITOR":t.region;var Ct=s(t.region);if(null===Ct)return e;var Mt=Object(ee.setIn)(l.regions.map(e=>Object(C.a)(Object(C.a)({},e),{},{highlighted:!1,editingLabels:!1})),[Ct],Object(C.a)(Object(C.a)({},(l.regions||[])[Ct]),{},{highlighted:!0,editingLabels:!0}));return Object(ee.setIn)(e,[...r,"regions"],Mt);case"CLOSE_REGION_EDITOR":t.region;var St=s(t.region);return null===St?e:Object(ee.setIn)(e,[...r,"regions",St],Object(C.a)(Object(C.a)({},(l.regions||[])[St]),{},{editingLabels:!1}));case"DELETE_REGION":return null===s(t.region)?e:Object(ee.setIn)(e,[...r,"regions"],(l.regions||[]).filter(e=>e.id!==t.region.id));case"HEADER_BUTTON_CLICKED":switch(t.buttonName.toLowerCase()){case"prev":return null===i||0===i?e:m(e.images[i-1],i-1);case"next":return null===i||i===e.images.length-1?e:m(e.images[i+1],i+1);case"clone":return null===i||i===e.images.length-1?e:Object(ee.setIn)(m(e.images[i+1],i+1),["images",i+1,"regions"],l.regions);case"settings":return Object(ee.setIn)(e,["settingsOpen"],!e.settingsOpen);case"help":return e;case"fullscreen":return Object(ee.setIn)(e,["fullScreen"],!0);case"exit fullscreen":case"window":return Object(ee.setIn)(e,["fullScreen"],!1);case"hotkeys":return e;case"exit":case"done":default:return e}case"SELECT_TOOL":return"show-tags"===t.selectedTool?Object(ee.setIn)(e,["showTags"],!e.showTags):"show-mask"===t.selectedTool?Object(ee.setIn)(e,["showMask"],!e.showMask):("modify-allowed-area"!==t.selectedTool||e.allowedArea||(e=Object(ee.setIn)(e,["allowedArea"],{x:0,y:0,w:1,h:1})),e=Object(ee.setIn)(e,["mode"],null),Object(ee.setIn)(e,["selectedTool"],t.selectedTool));case"CANCEL":var Nt=e.mode;if(Nt)switch(Nt.mode){case"DRAW_EXPANDING_LINE":case"SET_EXPANDING_LINE_WIDTH":case"DRAW_POLYGON":return d(Nt.regionId,null);case"MOVE_POLYGON_POINT":case"RESIZE_BOX":case"MOVE_REGION":return Object(ee.setIn)(e,["mode"],null);default:return e}var kt=l.regions;if(kt&&kt.some(e=>e.editingLabels))return Object(ee.setIn)(e,[...r,"regions"],kt.map(e=>Object(C.a)(Object(C.a)({},e),{},{editingLabels:!1})));if(kt)return Object(ee.setIn)(e,[...r,"regions"],kt.map(e=>Object(C.a)(Object(C.a)({},e),{},{highlighted:!1})))}return e},an=(e,t)=>{var a=at(e),n=a.currentImageIndex;a.pathToActiveImage,a.activeImage;switch(t.type){case"IMAGE_OR_VIDEO_LOADED":return Object(ee.setIn)(e,["images",n,"pixelSize"],{w:t.metadata.naturalWidth,h:t.metadata.naturalHeight})}return e},nn=(e,t)=>{var a=()=>Object(ee.setIn)(Xa(e,"Add Keyframe"),["keyframes",e.currentVideoTime||0],{regions:it(e.keyframes,e.currentVideoTime)});switch(t.type){case"IMAGE_OR_VIDEO_LOADED":var n=t.metadata.duration;if("number"===typeof n)return Object(ee.setIn)(e,["videoDuration"],1e3*n);case"HEADER_BUTTON_CLICKED":switch(t.buttonName.toLowerCase()){case"play":return Object(ee.setIn)(e,["videoPlaying"],!0);case"pause":return Object(ee.setIn)(e,["videoPlaying"],!1)}case"CHANGE_VIDEO_TIME":return Object(ee.setIn)(e,["currentVideoTime"],t.newTime);case"CHANGE_VIDEO_PLAYING":return Object(ee.setIn)(e,["videoPlaying"],t.isPlaying);case"DELETE_KEYFRAME":return Object(ee.setIn)(e,["keyframes"],Object(ee.without)(e.keyframes,t.time))}if(!e.keyframes[e.currentVideoTime])switch(t.type){case"BEGIN_BOX_TRANSFORM":case"BEGIN_MOVE_POINT":case"BEGIN_MOVE_POLYGON_POINT":case"ADD_POLYGON_POINT":case"SELECT_REGION":case"CHANGE_REGION":case"DELETE_REGION":case"OPEN_REGION_EDITOR":return a();case"MOUSE_DOWN":switch(e.selectedTool){case"create-point":case"create-polygon":case"create-box":return a()}}return e},on=({images:e,allowedArea:t,selectedImage:a=(e&&e.length>0?0:void 0),showPointDistances:i,pointDistancePrecision:r,showTags:l=!0,enabledTools:s=["select","create-point","create-box","create-polygon","create-expanding-line","show-mask"],selectedTool:c="select",regionTagList:d=[],regionClsList:g=[],imageTagList:m=[],imageClsList:h=[],keyframes:p={},taskDescription:b="",fullImageSegmentationMode:y=!1,RegionEditLabel:f,videoSrc:E,videoTime:O=0,videoName:v,onExit:x,onNextImage:w,onPrevImage:j,keypointDefinitions:I,autoSegmentationOptions:T={type:"autoseg"}})=>{"string"===typeof a&&-1===(a=(e||[]).findIndex(e=>e.src===a))&&(a=void 0);var M,S=e?"image":"video",N=Object(n.useReducer)((M=((...e)=>(t,a)=>{var n,o=Object(nt.a)(e);try{for(o.s();!(n=o.n()).done;)t=(0,n.value)(t,a)}catch(i){o.e(i)}finally{o.f()}return t})("image"===S?an:nn,tn),(e,t)=>{var a=e,n=M(e,t);if("RESTORE_HISTORY"===t.type){if(e.history.length>0)return Object(ee.setIn)(n.history[0].state,["history"],n.history.slice(1))}else if(a!==n&&Object.keys(Ka).includes(t.type))return Object(ee.setIn)(n,["history"],[{time:Ba()().toDate(),state:Object(ee.without)(a,"history"),name:Ka[t.type]||t.type}].concat(n.history||[]).slice(0,9));return n}),te()(Object(C.a)({annotationType:S,showTags:l,allowedArea:t,showPointDistances:i,pointDistancePrecision:r,selectedTool:c,fullImageSegmentationMode:y,autoSegmentationOptions:T,mode:null,taskDescription:b,showMask:!0,labelImages:h.length>0||m.length>0,regionClsList:g,regionTagList:d,imageClsList:h,imageTagList:m,currentVideoTime:O,enabledTools:s,history:[],videoName:v,keypointDefinitions:I},"image"===S?{selectedImage:a,images:e,selectedImageFrameTime:e&&e.length>0?e[0].frameTime:void 0}:{videoSrc:E,keyframes:p}))),k=Object(u.a)(N,2),A=k[0],_=k[1],D=Object(L.a)(e=>{if("HEADER_BUTTON_CLICKED"===e.type){if(["Exit","Done","Save","Complete"].includes(e.buttonName))return x(Object(ee.without)(A,"history"));if("Next"===e.buttonName&&w)return w(Object(ee.without)(A,"history"));if("Prev"===e.buttonName&&j)return j(Object(ee.without)(A,"history"))}_(e)}),P=Object(L.a)(e=>{_({type:"ON_CLS_ADDED",cls:e})});return Object(n.useEffect)(()=>{void 0!==a&&_({type:"SELECT_IMAGE",imageIndex:a,image:A.images[a]})},[a]),e||E?o.a.createElement(De,null,o.a.createElement(Ya,{RegionEditLabel:f,alwaysShowNextButton:Boolean(w),alwaysShowPrevButton:Boolean(j),state:A,dispatch:D,onRegionClassAdded:P})):'Missing required prop "images" or "videoSrc"'};class rn extends n.Component{constructor(...e){super(...e),this.state={hasError:!1,err:""}}componentDidCatch(e,t){this.setState({hasError:!0,err:e.toString()+"\n\n"+t.componentStack})}render(){return this.state.hasError?o.a.createElement(y.a,{open:this.state.hasError,onClose:this.props.onClose},o.a.createElement(f.a,null,"Error Loading Annotator"),o.a.createElement(E.a,null,o.a.createElement("pre",null,this.state.err)),o.a.createElement(O.a,null,o.a.createElement(h.a,{onClick:this.props.onClose},"Close"))):this.props.children}}var ln=()=>{var e=Object(n.useState)(!1),t=Object(u.a)(e,2),a=t[0],i=t[1],r=Object(n.useState)(I.Custom()),l=Object(u.a)(r,2),s=l[0],c=l[1],d=Object(n.useState)(),g=Object(u.a)(d,2),m=g[0],h=g[1];return o.a.createElement("div",null,a?o.a.createElement(rn,{onClose:()=>{i(!1)}},o.a.createElement(on,Object.assign({},s,{onExit:e=>{delete e.lastAction,h(e),i(!1)}}))):o.a.createElement(T,{lastOutput:m,onOpenAnnotator:e=>{c(e),i(!0)}}))},sn=a(275),cn=(a(723),a(967)),dn=a(277),gn=Object(S.a)("div")({display:"flex",flexDirection:"column",alignItems:"center"}),mn=Object(S.a)("div")({width:"100%",boxSizing:"border-box",display:"flex",flexDirection:"column",maxWidth:1200}),un=Object(S.a)("div")({width:"100%",display:"flex",justifyContent:"center",backgroundColor:se.a[600],padding:8,boxSizing:"border-box"}),hn=Object(S.a)(h.a)({color:"white",margin:8,padding:16,paddingLeft:24,paddingRight:24}),pn=Object(S.a)("div")({display:"flex",justifyContent:"center",width:"100%",backgroundColor:se.a[500],padding:16,color:"white",boxSizing:"border-box"}),bn=Object(S.a)("div")({fontSize:48,fontWeight:"bold",paddingTop:64,textShadow:"0px 1px 5px rgba(0,0,0,0.3)"}),yn=Object(S.a)("div")({paddingTop:32,lineHeight:1.5,fontSize:24,textShadow:"0px 1px 3px rgba(0,0,0,0.2)"}),fn=Object(S.a)("div")({paddingTop:32,paddingBottom:48}),En=Object(S.a)("div")({display:"flex",padding:16,paddingTop:32,flexDirection:"column"}),On=({language:e,value:t})=>o.a.createElement(cn.a,{language:e,style:dn.docco},t);function vn(e,t){return"string"===typeof t?e+t:o.a.Children.toArray(t.props.children).reduce(vn,e)}function xn(e){var t=o.a.Children.toArray(e.children).reduce(vn,"").toLowerCase().replace(/\W/g,"-");return o.a.createElement("h"+e.level,{id:t},e.children)}var wn=()=>o.a.createElement(gn,null,o.a.createElement(un,{id:"about"},o.a.createElement(mn,{style:{flexDirection:"row",flexGrow:1}},o.a.createElement(hn,{href:"#features"},"Features"),o.a.createElement(hn,{href:"#usage"},"Usage"),o.a.createElement(hn,{href:"#props"},"Props"),o.a.createElement(hn,{href:"./demo"},"Demo Playground"))),o.a.createElement(pn,null,o.a.createElement(mn,null,o.a.createElement(bn,null,"React Image Annotate"),o.a.createElement(yn,null,"Powerful React component for image annotations with bounding boxes, tagging, classification, multiple images and polygon segmentation."),o.a.createElement(fn,null,o.a.createElement(sn.a,{href:"https://github.com/waoai/react-image-annotate","data-size":"large","data-show-count":"true","aria-label":"Star waoai/react-image-annotate on GitHub"},"Star")))),o.a.createElement(mn,{className:"markdown-body"},o.a.createElement(En,{className:"markdown-body"},o.a.createElement(qt.a,{escapeHtml:!1,source:'# Features\n\n- Simple input/output format\n- Bounding Box, Point and Polygon Annotation\n- Zooming, Scaling, Panning\n- Multiple Images\n- Cursor Crosshair\n\n![Screenshot of Annotator](https://user-images.githubusercontent.com/1910070/51199716-83c72080-18c5-11e9-837c-c3a89c8caef4.png)\n\n# Usage\n\n## Installation\n\n```bash\nnpm install react-image-annotate\n```\n\n## Basic Example\n\n```javascript\nimport ReactImageAnnotate from "react-image-annotate"\n\nconst App = () => (\n  <ReactImageAnnotate\n    selectedImage="https://example.com/image1.png"\n    taskDescription="# Draw region around each animal."\n    images={[{ src: "https://example.com/image1.png", name: "Image 1" }]}\n    regionClsList={["Dog", "Cat"]}\n    enabledTools={["create-box"]}\n  />\n)\n```\n\n# Props\n\nAll of the following properties can be defined on the `ReactImageAnnotate` component...\n\n| Prop                     | Type (\\* = required)                             | Description                                                                             | Default       |\n| ------------------------ | ------------------------------------------------ | --------------------------------------------------------------------------------------- | ------------- |\n| `taskDescription`        | \\*`string`                                       | Markdown description for what to do in the image.                                       |               |\n| `allowedArea`            | `{ x: number, y: number, w: number, h: number }` | Area that is available for annotation.                                                  | Entire image. |\n| `regionTagList`          | `Array<string>`                                  | Allowed "tags" (mutually inclusive classifications) for regions.                        |               |\n| `regionClsList`          | `Array<string>`                                  | Allowed "classes" (mutually exclusive classifications) for regions.                     |               |\n| `imageTagList`           | `Array<string>`                                  | Allowed tags for entire image.                                                          |               |\n| `imageClsList`           | `Array<string>`                                  | Allowed classes for entire image.                                                       |               |\n| `enabledTools`           | `Array<string>`                                  | Tools allowed to be used. e.g. "select", "create-point", "create-box", "create-polygon" | Everything.   |\n| `showTags`               | `boolean`                                        | Show tags and allow tags on regions.                                                    | `true`        |\n| `selectedImage`          | `string`                                         | URL of initially selected image.                                                        |               |\n| `images`                 | `Array<Image>`                                   | Array of images to load into annotator                                                  |               |\n| `showPointDistances`     | `boolean`                                        | Show distances between points.                                                          | `false`       |\n| `pointDistancePrecision` | `number`                                         | Precision on displayed points (e.g. 3 => 0.123)                                         |               |\n| `onExit`                 | `MainLayoutState => any`                         | Called when "Save" is called.                                                           |               |\n\n# Sponsors\n\n[![wao.ai sponsorship image](https://s3.amazonaws.com/asset.workaround.online/sponsorship-banner-1.png)](https://wao.ai)\n',renderers:{code:On,heading:xn}})))),jn=(a(912),()=>{var e=window.location.pathname.replace(/\/$/,"").split("/").slice(-1)[0];return o.a.createElement(m,null,"demo"===e?o.a.createElement(ln,null):o.a.createElement(wn,null))});r.a.render(o.a.createElement(jn,null),document.getElementById("root"))}},[[301,1,2]]]);
//# sourceMappingURL=main.ba6ba9d1.chunk.js.map