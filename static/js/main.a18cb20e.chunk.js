(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{292:function(e,t,n){e.exports=n(930)},297:function(e,t,n){},930:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(25),i=n.n(o),l=n(17),c=n(104),s=n.n(c),u=n(246),g=n.n(u),d=(n(297),Object(l.a)({container:{fontFamily:'"Inter UI", sans-serif'}})),m=s()({typography:{fontFamily:'"Inter UI", "Roboto", sans-serif'},overrides:{MuiButton:{root:{textTransform:"none"}}}}),h=n(10),p=n(15),f=n.n(p),b=n(39),E=n(935),y=n(66),v=n.n(y),O=n(67),x=n.n(O),w=n(68),I=n.n(w),j=n(69),C=n.n(j),T=n(160),N=n.n(T),A=Object(l.a)({editBar:{padding:10,borderBottom:"1px solid #ccc",backgroundColor:"#f8f8f8",display:"flex",alignItems:"center","& .button":{margin:5}},select:{width:240,fontSize:14},contentArea:{padding:10},specificationArea:{padding:10}}),S=function(){try{return JSON.parse(window.localStorage.getItem("customInput")||"{}")}catch(e){return{}}},R={"Simple Bounding Box":function(){return{taskDescription:"Annotate each image according to this _markdown_ specification.",regionTagList:["has-bun"],regionClsList:["hotdog","not-hotdog"],enabledTools:["select","create-box"],images:[{src:"https://images.unsplash.com/photo-1496905583330-eb54c7e5915a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=634&q=80",name:"hot-dogs-1"}]}},Custom:function(){return S()}},k=function(e){var t=e.onOpenAnnotator,n=e.lastOutput,o=A(),i=Object(a.useState)(window.localStorage.getItem("customInput")?"Custom":"Simple Bounding Box"),l=Object(h.a)(i,2),c=l[0],s=l[1],u=Object(a.useState)(!1),g=Object(h.a)(u,2),d=g[0],m=g[1],p=Object(a.useState)(JSON.stringify(R[c](),null,"  ")),y=Object(h.a)(p,2),O=y[0],w=y[1];return r.a.createElement("div",null,r.a.createElement("div",{className:o.editBar},r.a.createElement("h3",null,"React Image Annotate"),r.a.createElement("div",{style:{flexGrow:1}}),r.a.createElement("div",null,r.a.createElement("div",{style:{display:"inline-flex"}},r.a.createElement(b.a,{className:o.select,value:{label:c,value:c},options:Object.keys(R).map(function(e){return{label:e,value:e}}),onChange:function(e){s(e.value),w(JSON.stringify("Custom"===e.value?S():R[e.value],null,"  "))}})),r.a.createElement(f.a,{className:"button",disabled:!n,onClick:function(){return m(!0)}},"View Output"),r.a.createElement(f.a,{className:"button",variant:"outlined",onClick:function(){return t("Custom"===c?S():R[c])}},"Open Annotator"))),r.a.createElement("div",{className:o.contentArea},r.a.createElement("div",null,r.a.createElement(N.a,{value:O,language:"javascript",onChange:function(e){try{window.localStorage.setItem("customInput",JSON.stringify(JSON.parse(e)))}catch(t){}w(e)},width:"100%",height:"550px"}))),r.a.createElement("div",{className:o.specificationArea},r.a.createElement("h2",null,"React Image Annotate Format"),r.a.createElement(E.a,{language:"javascript"},'\n{\n  taskDescription?: string, // markdown\n  regionTagList?: Array<string>,\n  regionClsList?: Array<string>,\n  imageTagList?: Array<string>,\n  imageClsList?: Array<string>,\n  // all tools are enabled by default\n  enabledTools?: Array< "select" | "create-point" | "create-box" | "create-polygon">,\n  selectedImage?: string, // initial selected image\n  images: Array<{\n    src: string,\n    thumbnailSrc?: string, // use this if you are using high-res images\n    name: string,\n    regions?: Array<{\n      id: string | number,\n      cls?: string,\n      color?: string,\n      tags?: Array<string>,\n\n      // Point\n      type: "point",\n      x: number, // [0-1] % of image width\n      y: number, // [0-1] % of image height\n\n      // Bounding Box\n      type: "box",\n      x: number, // [0-1] % of image width\n      y: number, // [0-1] % of image height\n      w: number, // [0-1] % of image width\n      h: number, // [0-1] % of image height\n\n      // Polygon\n      type: "polygon",\n      open?: boolean, // should last and first points be connected, default: true\n      points: Array<[number, number]> // [0-1] % of image width/height\n    }>\n  }>,\n}\n')),r.a.createElement(v.a,{fullScreen:!0,open:d},r.a.createElement(x.a,null,"React Image Annotate Output"),r.a.createElement(I.a,{style:{minWidth:400}},r.a.createElement(N.a,{value:JSON.stringify(n,null,"  "),language:"javascript",width:"100%",height:"550px"})),r.a.createElement(C.a,null,r.a.createElement(f.a,{onClick:function(){return m(!1)}},"Close"))))},L=n(13),D=n(44),M=n.n(D),_=n(249),P=n.n(_),B=n(45),G=n.n(B),z=n(250),W=n.n(z),H=n(7),U=n(6),Y=n.n(U),F=Object(l.a)({container:{margin:8},header:{display:"flex",flexDirection:"row",alignItems:"center",padding:8,paddingLeft:16,paddingRight:16},title:{fontSize:14,fontWeight:"bold",flexGrow:1,paddingLeft:8,color:H.grey[800],"& span":{color:H.grey[600],fontSize:12}},expandButton:{padding:0,width:30,height:30,"& .icon":{marginTop:-6,width:20,height:20,transition:"500ms transform","&.expanded":{transform:"rotate(180deg)"}}},expandedContent:{maxHeight:300,overflowY:"auto","&.noScroll":{overflowY:"visible",overflow:"visible"}}}),V=function(e){var t=e.icon,n=e.title,o=e.subTitle,i=e.children,l=e.noScroll,c=void 0!==l&&l,s=e.expandedByDefault,u=void 0!==s&&s,g=F(),d=r.a.createElement("div",{className:Y()(g.expandedContent,c&&"noScroll")},i),m=Object(a.useState)(u),p=Object(h.a)(m,2),f=p[0],b=p[1];return r.a.createElement(M.a,{className:g.container},r.a.createElement("div",{className:g.header},t,r.a.createElement("div",{className:g.title},n," ",r.a.createElement("span",null,o)),r.a.createElement(G.a,{onClick:function(){return b(!f)},className:g.expandButton},r.a.createElement(P.a,{className:Y()("icon",f&&"expanded")}))),c?f?d:null:r.a.createElement(W.a,{in:f},d))},J=n(252),X=n.n(J),K=n(251),Z=n.n(K),Q=Object(l.a)({markdownContainer:{paddingLeft:16,paddingRight:16,fontSize:12,"& h1":{fontSize:18},"& h2":{fontSize:14},"& h3":{fontSize:12},"& h4":{fontSize:12},"& h5":{fontSize:12},"& h6":{fontSize:12},"& p":{fontSize:12},"& a":{},"& img":{width:"100%"}}}),q=function(e){var t=e.description,n=Q();return r.a.createElement(V,{title:"Task Description",icon:r.a.createElement(X.a,{style:{color:H.grey[700]}}),expandedByDefault:!0},r.a.createElement("div",{className:n.markdownContainer},r.a.createElement(Z.a,{source:t})))},$=n(253),ee=n.n($),te=n(78),ne=n.n(te),ae=n(79),re=n.n(ae),oe=n(80),ie=n.n(oe),le=Object(l.a)({img:{width:40,height:40,borderRadius:8}}),ce=function(e){var t=e.images,n=e.onSelect,a=le();return r.a.createElement(V,{title:"Images",subTitle:"(".concat(t.length,")"),icon:r.a.createElement(ee.a,{style:{color:H.grey[700]}})},r.a.createElement("div",null,r.a.createElement(ne.a,null,t.map(function(e,t){return r.a.createElement(re.a,{button:!0,onClick:function(){return n(e)},dense:!0,key:t},r.a.createElement("img",{className:a.img,src:e.src}),r.a.createElement(ie.a,{primary:e.name,secondary:"".concat((e.regions||[]).length," Labels")}))}))))},se=n(254),ue=n.n(se),ge=n(47),de=n.n(ge),me=n(255),he=n.n(me),pe=n(256),fe=n.n(pe),be=n(53),Ee=n.n(be),ye=n(82),ve=n.n(ye),Oe=n(257),xe=n.n(Oe),we=n(161),Ie=n.n(we),je=n(258),Ce=n.n(je),Te={container:{fontSize:11,fontWeight:"bold",color:H.grey[700],"& .icon":{marginTop:4,width:16,height:16},"& .icon2":{opacity:.5,width:16,height:16,transition:"200ms opacity","&:hover":{cursor:"pointer",opacity:1}}},row:{padding:4,cursor:"pointer","&.header:hover":{backgroundColor:"#fff"},"&.highlighted":{backgroundColor:H.blue[100]},"&:hover":{backgroundColor:H.blue[50],color:H.grey[800]}},chip:{display:"flex",flexDirection:"row",padding:2,borderRadius:2,paddingLeft:4,paddingRight:4,alignItems:"center","& .color":{borderRadius:5,width:10,height:10,marginRight:4},"& .text":{}}},Ne=Object(l.a)(Te),Ae=function(e){var t=e.color,n=e.text,a=Ne();return r.a.createElement("span",{className:a.chip},r.a.createElement("div",{className:"color",style:{backgroundColor:t}}),r.a.createElement("div",{className:"text"},n))},Se=function(e){var t=e.header,n=e.highlighted,o=e.order,i=e.classification,l=e.area,c=(e.tags,e.trash),s=e.lock,u=e.visible,g=e.onClick,d=Ne(),m=Object(a.useState)(!1),p=Object(h.a)(m,2),f=(p[0],p[1]);return r.a.createElement("div",{onClick:g,onMouseEnter:function(){return f(!0)},onMouseLeave:function(){return f(!1)},className:Y()(d.row,{header:t,highlighted:n})},r.a.createElement(de.a,{container:!0,alignItems:"center"},r.a.createElement(de.a,{item:!0,xs:2},r.a.createElement("div",{style:{textAlign:"right",paddingRight:10}},o)),r.a.createElement(de.a,{item:!0,xs:5},i),r.a.createElement(de.a,{item:!0,xs:2},r.a.createElement("div",{style:{textAlign:"right",paddingRight:6}},l)),r.a.createElement(de.a,{item:!0,xs:1},c),r.a.createElement(de.a,{item:!0,xs:1},s),r.a.createElement(de.a,{item:!0,xs:1},u)))},Re=function(e){var t=e.regions,n=e.onDeleteRegion,a=e.onChangeRegion,o=e.onSelectRegion,i=Ne();return r.a.createElement(V,{title:"Regions",subTitle:"",icon:r.a.createElement(ue.a,{style:{color:H.grey[700]}}),expandedByDefault:!0},r.a.createElement("div",{className:i.container},r.a.createElement(Se,{header:!0,highlighted:!1,order:r.a.createElement(he.a,{className:"icon"}),classification:r.a.createElement("div",{style:{paddingLeft:10}},"Class"),area:r.a.createElement(fe.a,{className:"icon"}),trash:r.a.createElement(Ee.a,{className:"icon"}),lock:r.a.createElement(ve.a,{className:"icon"}),visible:r.a.createElement(Ie.a,{className:"icon"})}),r.a.createElement("div",{style:{borderTop:"1px solid ".concat(H.grey[200]),marginTop:2,marginBottom:2}}),t.map(function(e,t){return r.a.createElement(Se,{header:!1,highlighted:e.highlighted,onClick:function(){return o(e)},key:e.id,order:"#".concat(t+1),classification:r.a.createElement(Ae,{text:e.cls||"",color:e.color||"#ddd"}),area:"",trash:r.a.createElement(Ee.a,{onClick:function(){return n(e)},className:"icon2"}),lock:e.locked?r.a.createElement(ve.a,{onClick:function(){return a(Object(L.a)({},e,{locked:!1}))},className:"icon2"}):r.a.createElement(xe.a,{onClick:function(){return a(Object(L.a)({},e,{locked:!0}))},className:"icon2"}),visible:e.visible||void 0===e.visible?r.a.createElement(Ie.a,{onClick:function(){return a(Object(L.a)({},e,{visible:!1}))},className:"icon2"}):r.a.createElement(Ce.a,{onClick:function(){return a(Object(L.a)({},e,{visible:!0}))},className:"icon2"})})})))},ke=n(259),Le=n.n(ke),De=n(260),Me=n.n(De),_e=n(153),Pe=n.n(_e),Be=n(110),Ge=n.n(Be),ze=Object(l.a)({emptyText:{fontSize:14,fontWeight:"bold",color:H.grey[500],textAlign:"center",padding:20}}),We=function(e){var t=e.history,n=e.onRestoreHistory,a=ze();return r.a.createElement(V,{title:"History",icon:r.a.createElement(Le.a,{style:{color:H.grey[700]}}),expandedByDefault:!0},r.a.createElement(ne.a,null,0===t.length&&r.a.createElement("div",{className:a.emptyText},"No History Yet"),t.map(function(e,t){var a=e.name,o=e.time;return r.a.createElement(re.a,{button:!0,dense:!0,key:t},r.a.createElement(ie.a,{primary:a,secondary:Ge()(o).format("LT")}),0===t&&r.a.createElement(Me.a,{onClick:n},r.a.createElement(G.a,null,r.a.createElement(Pe.a,null))))})))},He=function(e){var t=e.state,n=e.lastAction,a=(t.images||[]).find(function(e){return e.src===t.selectedImage}),o=a?(a.regions||[]).find(function(e){return e.highlighted}):null;return r.a.createElement(V,{title:"Debug",icon:r.a.createElement("span",null),expandedByDefault:!0},r.a.createElement("div",{style:{padding:4}},r.a.createElement("div",null,r.a.createElement("b",null,"region"),":"),r.a.createElement("pre",null,JSON.stringify(o,null,"  ")),r.a.createElement("div",null,r.a.createElement("b",null,"lastAction"),":"),r.a.createElement("pre",null,JSON.stringify(n,null,"  ")),r.a.createElement("div",null,r.a.createElement("b",null,"mode"),":"),r.a.createElement("pre",null,JSON.stringify(t.mode,null,"  "))))},Ue=n(261),Ye=n.n(Ue),Fe=(Object(l.a)({}),function(e){var t=e.currentImage,n=e.imageClsList,a=void 0===n?[]:n,o=e.imageTagList,i=void 0===o?[]:o,l=e.onChangeImage,c=t.tags,s=void 0===c?[]:c,u=t.cls,g=void 0===u?null:u;return r.a.createElement(V,{title:"Image Tags",expandedByDefault:!0,noScroll:!0,icon:r.a.createElement(Ye.a,{style:{color:H.grey[700]}})},a.length>0&&r.a.createElement("div",{style:{padding:8}},r.a.createElement(b.a,{placeholder:"Image Classification",onChange:function(e){return l({cls:e.value})},value:g?{value:g,label:g}:g,options:a.map(function(e){return{value:e,label:e}})})),i.length>0&&r.a.createElement("div",{style:{padding:8,paddingTop:0}},r.a.createElement(b.a,{isMulti:!0,placeholder:"Image Tags",onChange:function(e){return l({tags:e.map(function(e){return e.value})})},value:s.map(function(e){return{value:e,label:e}}),options:i.map(function(e){return{value:e,label:e}})})))}),Ve=Object(l.a)({}),Je=function(e){var t=e.debug,n=e.taskDescription,a=e.images,o=e.regions,i=e.history,l=e.labelImages,c=e.currentImage,s=e.imageClsList,u=e.imageTagList,g=e.onChangeImage,d=e.onSelectRegion,m=e.onSelectImage,h=e.onChangeRegion,p=e.onDeleteRegion,f=e.onRestoreHistory;Ve();return r.a.createElement("div",null,t&&r.a.createElement(He,{state:t,lastAction:t.lastAction}),r.a.createElement(q,{description:n}),l&&r.a.createElement(Fe,{currentImage:c,imageClsList:s,imageTagList:u,onChangeImage:g,expandedByDefault:!0}),r.a.createElement(ce,{onSelect:m,images:a}),r.a.createElement(Re,{regions:o,onSelectRegion:d,onChangeRegion:h,onDeleteRegion:p}),r.a.createElement(We,{history:i,onRestoreHistory:function(){return f()}}))},Xe=n(27),Ke=n(262),Ze=(n(763),function(e){var t=e.mousePosition,n=e.x,o=e.y,i=Object(a.useState)(),l=Object(h.a)(i,2),c=(l[0],l[1]);return t&&(n=t.current.x,o=t.current.y),Object(a.useEffect)(function(){if(t){var e=setInterval(function(){n===t.current.x&&o===t.current.y||c([t.current.x,t.current.y])},10);return function(){return clearInterval(e)}}}),r.a.createElement(a.Fragment,null,r.a.createElement("div",{style:{position:"absolute",height:"100%",width:1,backgroundColor:"#f00",left:n,pointerEvents:"none",top:0}}),r.a.createElement("div",{style:{position:"absolute",width:"100%",height:1,backgroundColor:"#f00",top:o,pointerEvents:"none",left:0}}))}),Qe={regionInfo:{fontSize:12,cursor:"default",transition:"opacity 200ms",opacity:.7,"&:hover":{opacity:.9,cursor:"pointer"},"&.highlighted":{opacity:.9,"&:hover":{opacity:1}},fontWeight:600,color:H.grey[900],padding:8,"& .name":{display:"flex",flexDirection:"row",alignItems:"center","& .circle":{marginRight:4,boxShadow:"0px 0px 2px rgba(0,0,0,0.4)",width:10,height:10,borderRadius:5}},"& .tags":{"& .tag":{color:H.grey[700],display:"inline-block",margin:1,fontSize:10,textDecoration:"underline"}}}},qe=n(111),$e=n.n(qe),et=Object(l.a)(Qe),tt=function(e){var t=e.region,n=e.editing,a=e.allowedClasses,o=void 0===a?["Laptop","Mouse","Compuda"]:a,i=e.allowedTags,l=void 0===i?["Dog","Cat","Woof","Electronic Device"]:i,c=e.onDelete,s=e.onChange,u=e.onClose,g=e.onOpen,d=et();return r.a.createElement(M.a,{onClick:function(){return n?null:g(t)},className:Y()(d.regionInfo,{highlighted:t.highlighted})},n?r.a.createElement("div",{style:{width:200}},r.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},r.a.createElement("div",{style:{display:"flex",backgroundColor:t.color,color:"#fff",padding:4,paddingLeft:8,paddingRight:8,borderRadius:4,fontWeight:"bold",textShadow:"0px 0px 5px rgba(0,0,0,0.4)"}},t.type),r.a.createElement("div",{style:{flexGrow:1}}),r.a.createElement(G.a,{onClick:function(){return c(t)},tabIndex:-1,style:{width:22,height:22},size:"small",variant:"outlined"},r.a.createElement(Ee.a,{style:{marginTop:-8,width:16,height:16}}))),o.length>0&&r.a.createElement("div",{style:{marginTop:6}},r.a.createElement(b.a,{placeholder:"Classification",onChange:function(e){return s(Object(L.a)({},t,{cls:e.value}))},value:t.cls?{label:t.cls,value:t.cls}:null,options:o.map(function(e){return{value:e,label:e}})})),l.length>0&&r.a.createElement("div",{style:{marginTop:4}},r.a.createElement(b.a,{onChange:function(e){return s(Object(L.a)({},t,{tags:e.map(function(e){return e.value})}))},placeholder:"Tags",value:(t.tags||[]).map(function(e){return{label:e,value:e}}),isMulti:!0,options:l.map(function(e){return{value:e,label:e}})})),r.a.createElement("div",{style:{marginTop:4,display:"flex"}},r.a.createElement("div",{style:{flexGrow:1}}),r.a.createElement(f.a,{onClick:function(){return u(t)},size:"small",variant:"contained",color:"primary"},r.a.createElement($e.a,null)))):r.a.createElement("div",null,t.cls&&r.a.createElement("div",{className:"name"},r.a.createElement("div",{className:"circle",style:{backgroundColor:t.color}}),t.cls),t.tags&&r.a.createElement("div",{className:"tags"},t.tags.map(function(e){return r.a.createElement("div",{key:e,className:"tag"},e)}))))},nt=Object(l.a)({"@keyframes borderDance":{from:{strokeDashoffset:0},to:{strokeDashoffset:100}},highlightBox:{transition:"opacity 500ms","&:not(.highlighted)":{opacity:0},"&:not(.highlighted):hover":{opacity:.6},"& path":{vectorEffect:"non-scaling-stroke",strokeWidth:2,stroke:"#FFF",fill:"none",strokeDasharray:5,animationName:"$borderDance",animationDuration:"4s",animationTimingFunction:"linear",animationIterationCount:"infinite",animationPlayState:"running"}},canvas:{width:"100%",height:"100%"},transformGrabber:{width:8,height:8,border:"2px solid #FFF",position:"absolute"},zoomIndicator:{position:"absolute",bottom:0,right:0,backgroundColor:"rgba(0,0,0,0.4)",color:"#fff",opacity:.5,fontWeight:"bolder",fontSize:14,padding:4}}),at=[["nw-resize","n-resize","ne-resize"],["w-resize","grab","e-resize"],["sw-resize","s-resize","se-resize"]],rt=function(){return Ke.Matrix.from(1,0,0,1,-10,-10)},ot=function(e){var t=e.regions,n=e.imageSrc,o=e.showTags,i=e.onMouseMove,l=void 0===i?function(e){return null}:i,c=e.onMouseDown,s=void 0===c?function(e){return null}:c,u=e.onMouseUp,g=void 0===u?function(e){return null}:u,d=e.dragWithPrimary,m=void 0!==d&&d,p=e.zoomWithPrimary,f=void 0!==p&&p,b=e.createWithPrimary,E=void 0!==b&&b,y=e.regionClsList,v=e.regionTagList,O=e.showCrosshairs,x=e.allowedArea,w=e.onChangeRegion,I=e.onBeginRegionEdit,j=e.onCloseRegionEdit,C=e.onBeginBoxTransform,T=e.onBeginMovePolygonPoint,N=e.onAddPolygonPoint,A=e.onSelectRegion,S=e.onBeginMovePoint,R=e.onDeleteRegion,k=nt(),D=Object(a.useRef)(null),_=Object(a.useRef)(null),P=Object(a.useRef)({}),B=Object(a.useRef)(null),G=Object(a.useState)(!1),z=Object(h.a)(G,2),W=(z[0],z[1]),H=Object(a.useState)(!1),U=Object(h.a)(H,2),F=U[0],V=U[1],J=Object(a.useState)(0),X=Object(h.a)(J,2),K=X[0],Z=X[1],Q=Object(a.useState)(null),q=Object(h.a)(Q,2),$=q[0],ee=q[1],te=Object(a.useState)(null),ne=Object(h.a)(te,2),ae=ne[0],re=ne[1],oe=Object(a.useRef)({x:0,y:0}),ie=Object(a.useRef)({x:0,y:0}),le=Object(a.useState)(rt()),ce=Object(h.a)(le,2),se=ce[0],ue=ce[1],ge=Object(a.useRef)({}),de=(se.applyToPoint(oe.current.x,oe.current.y),function(e){var t=P.current,n=t.iw,a=t.ih,r=function(e){switch(e.type){case"polygon":var t={x:Math.min.apply(Math,Object(Xe.a)(e.points.map(function(e){var t=Object(h.a)(e,2),n=t[0];return t[1],n}))),y:Math.min.apply(Math,Object(Xe.a)(e.points.map(function(e){var t=Object(h.a)(e,2);return t[0],t[1]}))),w:0,h:0};return t.w=Math.max.apply(Math,Object(Xe.a)(e.points.map(function(e){var t=Object(h.a)(e,2),n=t[0];return t[1],n})))-t.x,t.h=Math.max.apply(Math,Object(Xe.a)(e.points.map(function(e){var t=Object(h.a)(e,2);return t[0],t[1]})))-t.y,t;case"box":return{x:e.x,y:e.y,w:e.w,h:e.h};case"point":return{x:e.x,y:e.y,w:0,h:0};case"pixel":if(void 0!==e.sx&&void 0!==e.sy&&e.w&&e.h)return{x:e.sx,y:e.sy,w:e.w,h:e.h};if(e.points){var n={x:Math.min.apply(Math,Object(Xe.a)(e.points.map(function(e){var t=Object(h.a)(e,2),n=t[0];return t[1],n}))),y:Math.min.apply(Math,Object(Xe.a)(e.points.map(function(e){var t=Object(h.a)(e,2);return t[0],t[1]}))),w:0,h:0};return n.w=Math.max.apply(Math,Object(Xe.a)(e.points.map(function(e){var t=Object(h.a)(e,2),n=t[0];return t[1],n})))-n.x,n.h=Math.max.apply(Math,Object(Xe.a)(e.points.map(function(e){var t=Object(h.a)(e,2);return t[0],t[1]})))-n.y,n}}throw new Error("unknown region")}(e),o="point"===e.type?15:2,i={x:r.x*n-o,y:r.y*a-o,w:r.w*n+2*o,h:r.h*a+2*o};return Object(L.a)({},se.clone().inverse().applyToPoint(i.x,i.y),{w:i.w/se.a,h:i.h/se.d})});Object(a.useLayoutEffect)(function(){null===_.current&&(_.current=new Image,_.current.onload=function(){W(!0)},_.current.src=n);var e=D.current,a=e.clientWidth,r=e.clientHeight;e.width=a,e.height=r;var o=e.getContext("2d");null===B.current&&(B.current={image:new Image,pattern:null},B.current.image.onload=function(){B.current.pattern=o.createPattern(B.current.image,"repeat")},B.current.image.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4wMSAxY5oG+lzgAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAcSURBVAjXY/jPwPCfAQnA+TAGugLcAhhakRUAAK3lEe8m9qZhAAAAAElFTkSuQmCC"),o.save(),o.transform.apply(o,Object(Xe.a)(se.clone().inverse().toArray()));var i=Math.max(_.current.naturalWidth/(a-20),_.current.naturalHeight/(r-20)),l=_.current.naturalWidth/i,c=_.current.naturalHeight/i;if(P.current={iw:l,ih:c,fitScale:i,canvasWidth:a,canvasHeight:r},o.drawImage(_.current,0,0,l,c),x){var s=x.x,u=x.y,g=x.w,d=x.h;o.save(),o.globalAlpha=.25;var m=[[0,0],[l,0],[l,c],[0,c]],p=[[s*l,u*c],[s*l+g*l,u*c],[s*l+g*l,u*c+d*c],[s*l,u*c+d*c]];o.moveTo.apply(o,Object(Xe.a)(m[0])),m.forEach(function(e){return o.lineTo.apply(o,Object(Xe.a)(e))}),o.lineTo.apply(o,Object(Xe.a)(m[0])),o.closePath(),p.reverse(),o.moveTo.apply(o,Object(Xe.a)(p[0])),p.forEach(function(e){return o.lineTo.apply(o,Object(Xe.a)(e))}),o.lineTo.apply(o,Object(Xe.a)(p[0])),o.fillStyle=B.current.pattern||"#f00",o.fill(),o.restore()}o.save(),o.globalAlpha=.5*se.a+.5,o.lineWidth=1*se.a+1,o.globalAlpha>.6&&(o.shadowColor="black",o.shadowBlur=4);var f=!0,b=!1,E=void 0;try{for(var y,v=function(){var e=y.value;switch(e.type){case"point":o.save(),o.beginPath(),o.strokeStyle=e.color,o.moveTo(e.x*l-10,e.y*c),o.lineTo(e.x*l-2,e.y*c),o.moveTo(e.x*l+10,e.y*c),o.lineTo(e.x*l+2,e.y*c),o.moveTo(e.x*l,e.y*c-10),o.lineTo(e.x*l,e.y*c-2),o.moveTo(e.x*l,e.y*c+10),o.lineTo(e.x*l,e.y*c+2),o.moveTo(e.x*l+5,e.y*c),o.arc(e.x*l,e.y*c,5,0,2*Math.PI),o.stroke(),o.restore();break;case"box":o.save(),o.shadowColor="black",o.shadowBlur=4,o.strokeStyle=e.color,o.strokeRect(e.x*l,e.y*c,e.w*l,e.h*c),o.restore();break;case"polygon":o.save(),o.shadowColor="black",o.shadowBlur=4,o.strokeStyle=e.color,o.beginPath(),o.moveTo(e.points[0][0]*l,e.points[0][1]*c);var t=!0,n=!1,a=void 0;try{for(var r,i=e.points[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var s=r.value;o.lineTo(s[0]*l,s[1]*c)}}catch(u){n=!0,a=u}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}e.open||o.closePath(),o.stroke(),o.restore();break;case"pixel":o.save(),ge.current[e.src]?"CANVAS"===ge.current[e.src].nodeName&&(o.globalAlpha=.6,o.drawImage(ge.current[e.src],e.sx*l,e.sy*c,e.w*l,e.h*c)):(ge.current[e.src]=new Image,ge.current[e.src].onload=function(){var t=ge.current[e.src],n=document.createElement("canvas");n.width=t.naturalWidth,n.height=t.naturalHeight;var a=n.getContext("2d");a.drawImage(t,0,0);for(var r=a.getImageData(0,0,t.naturalWidth,t.naturalHeight),o=0;o<r.data.length;o+=4){var i=r.data.slice(o,o+4),l=Object(h.a)(i,4),c=l[0],s=l[1],u=l[2],g=(l[3],c<10&&s<10&&u<10);r.data[o]=0,r.data[o+1]=0,r.data[o+2]=g?255:0,r.data[o+3]=g?255:0}a.clearRect(0,0,t.naturalWidth,t.naturalHeight),a.putImageData(r,0,0),ge.current[e.src]=n,Z(K+1)},ge.current[e.src].src=e.src),o.restore()}},O=t.filter(function(e){return e.visible||void 0===e.visible})[Symbol.iterator]();!(f=(y=O.next()).done);f=!0)v()}catch(w){b=!0,E=w}finally{try{f||null==O.return||O.return()}finally{if(b)throw E}}o.restore(),o.restore()});var me=function(e,t){var n=[t.x,t.y],a=n[0],r=n[1],o="object"===typeof e?e.to/se.a:1+.2*e;se.translate(a,r).scaleU(o),se.a>2&&se.scaleU(2/se.a),se.a<.1&&se.scaleU(.1/se.a),se.translate(-a,-r),ue(se.clone())},he={onMouseMove:function(e){var t=D.current.getBoundingClientRect(),n=t.left,a=t.top;ie.current.x=oe.current.x,ie.current.y=oe.current.y,oe.current.x=e.clientX-n,oe.current.y=e.clientY-a;var r=se.applyToPoint(oe.current.x,oe.current.y);f&&$&&re(r);var o=P.current,i=o.iw,c=o.ih;l({x:r.x/i,y:r.y/c}),F&&(se.translate(ie.current.x-oe.current.x,ie.current.y-oe.current.y),ue(se.clone())),e.preventDefault()},onMouseDown:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.preventDefault(),1===e.button||0===e.button&&m)return V(!0);var n=se.applyToPoint(oe.current.x,oe.current.y);if(f&&0===e.button)return ee(n),void re(n);if(0===e.button){t.type,t.type;var a=P.current,r=a.iw,o=a.ih;s({x:n.x/r,y:n.y/o})}},onMouseUp:function(e){e.preventDefault();var t=se.applyToPoint(oe.current.x,oe.current.y);if($){var n=t;if(Math.abs($.x-n.x)<10&&Math.abs($.y-n.y)<10)se.a<1?me({to:1},oe.current):me({to:.25},oe.current);else{var a=P.current,r=a.iw,o=a.ih;if($.x>n.x){var i=[n.x,$.x];$.x=i[0],n.x=i[1]}if($.y>n.y){var l=[n.y,$.y];$.y=l[0],n.y=l[1]}var c=Math.min((n.x-$.x)/r,(n.y-$.y)/o);c<.1&&(c=.1),c>10&&(c=10);var s=rt().translate($.x,$.y).scaleU(c);ue(s.clone())}ee(null),re(null)}if(1===e.button||0===e.button&&m)return V(!1);if(0===e.button){var u=P.current,d=u.iw,h=u.ih;g({x:t.x/d,y:t.y/h})}},onWheel:function(e){var t=e.deltaY>0?1:e.deltaY<0?-1:0;me(t,oe.current),e.preventDefault()}},pe=P.current,fe=(pe.iw,pe.ih,$?Object(L.a)({},se.clone().inverse().applyToPoint($.x,$.y),{w:(ae.x-$.x)/se.a,h:(ae.y-$.y)/se.d}):null);return fe&&(fe.w<0&&(fe.x+=fe.w,fe.w*=-1),fe.h<0&&(fe.y+=fe.h,fe.h*=-1)),r.a.createElement("div",{style:{width:"100%",height:"100%",maxHeight:"calc(100vh - 68px)",position:"relative",overflow:"hidden",cursor:E?"crosshair":F?"grabbing":m?"grab":f?se.a<1?"zoom-out":"zoom-in":void 0}},O&&r.a.createElement(Ze,{mousePosition:oe}),t.filter(function(e){return e.visible||void 0===e.visible}).filter(function(e){return!e.locked}).map(function(e,t){var n=de(e),o=P.current,i=o.iw,l=o.ih;return r.a.createElement(a.Fragment,null,r.a.createElement("svg",Object.assign({key:e.id,className:Y()(k.highlightBox,{highlighted:e.highlighted})},he,f||m?{}:{onMouseDown:function(t){return!e.locked&&"point"===e.type&&e.highlighted&&0===t.button?S(e):0!==t.button||E?void he.onMouseDown(t):A(e)}},{style:Object(L.a)({},e.highlighted?{pointerEvents:"point"!==e.type?"none":void 0,cursor:"grab"}:{cursor:f||m||E?void 0:"pointer",pointerEvents:f||m||E&&!e.highlighted?"none":void 0},{position:"absolute",left:n.x-5,top:n.y-5,width:n.w+10,height:n.h+10})}),r.a.createElement("path",{d:"M5,5 L".concat(n.w+5,",5 L").concat(n.w+5,",").concat(n.h+5," L5,").concat(n.h+5," Z")})),"box"===e.type&&!m&&!f&&!e.locked&&e.highlighted&&se.a<1.2&&[[0,0],[.5,0],[1,0],[1,.5],[1,1],[.5,1],[0,1],[0,.5],[.5,.5]].map(function(t,a){var o=Object(h.a)(t,2),i=o[0],l=o[1];return r.a.createElement("div",Object.assign({key:a,className:k.transformGrabber},he,{onMouseDown:function(t){if(0===t.button)return C(e,[2*i-1,2*l-1]);he.onMouseDown(t)},style:{left:n.x-4-2+n.w*i,top:n.y-4-2+n.h*l,cursor:at[2*l][2*i],borderRadius:.5===i&&.5===l?4:void 0}}))}),"polygon"===e.type&&!m&&!f&&!e.locked&&e.highlighted&&e.points.map(function(t,n){var a=Object(h.a)(t,2),o=a[0],c=a[1],s=se.clone().inverse().applyToPoint(o*i,c*l);return r.a.createElement("div",Object.assign({key:n},he,{onMouseDown:function(t){if(0===t.button&&(!e.open||0===n))return T(e,n);he.onMouseDown(t)},className:k.transformGrabber,style:{cursor:e.open?0===n?"pointer":void 0:"move",pointerEvents:e.open&&n===e.points.length-1?"none":void 0,left:s.x-4,top:s.y-4}}))}),"polygon"===e.type&&e.highlighted&&!m&&!f&&!e.locked&&!e.open&&e.points.length>1&&e.points.map(function(t,n){return[t,e.points[(n+1)%e.points.length]]}).map(function(e){var t=Object(h.a)(e,2),n=t[0],a=t[1];return[(n[0]+a[0])/2,(n[1]+a[1])/2]}).map(function(t,n){var a=se.clone().inverse().applyToPoint(t[0]*i,t[1]*l);return r.a.createElement("div",Object.assign({key:n},he,{onMouseDown:function(a){if(0===a.button)return N(e,t,n+1);he.onMouseDown(a)},className:k.transformGrabber,style:{cursor:"copy",left:a.x-4,top:a.y-4,border:"2px dotted #fff",opacity:.5}}))}))}),o&&t.filter(function(e){return e.visible||void 0===e.visible}).map(function(e){var t=de(e),n=P.current,a=(n.iw,n.ih,8);e.highlighted&&"box"===e.type&&(a+=6);var o=e.editingLabels&&!e.locked?170:40,i=t.y>o?{left:t.x,bottom:P.current.canvasHeight-t.y+a}:{left:t.x,top:t.y+t.h+a/2};return e.locked?r.a.createElement(M.a,{style:Object(L.a)({position:"absolute"},i,{zIndex:10,backgroundColor:"#fff",borderRadius:4,padding:2,paddingBottom:0,opacity:.5,pointerEvents:"none"})},r.a.createElement(ve.a,{style:{width:16,height:16,color:"#333"}})):r.a.createElement("div",Object.assign({style:Object(L.a)({position:"absolute"},i,{zIndex:10+(e.editingLabels?5:0)})},e.editingLabels?{}:he,{onMouseDown:function(e){return e.preventDefault()},onMouseUp:function(e){return e.preventDefault()},onMouseEnter:function(t){e.editingLabels&&(he.onMouseUp(t),t.button=1,he.onMouseUp(t))}}),r.a.createElement(tt,{allowedClasses:y,allowedTags:v,onOpen:I,onChange:w,onClose:j,onDelete:R,editing:e.editingLabels,region:e}))}),f&&null!==fe&&r.a.createElement("div",{style:{position:"absolute",border:"1px solid #fff",pointerEvents:"none",left:fe.x,top:fe.y,width:fe.w,height:fe.h}}),r.a.createElement("canvas",Object.assign({},he,{className:k.canvas,ref:D})),r.a.createElement("div",{className:k.zoomIndicator},(1/se.a*100).toFixed(0),"%"))},it=Object(a.createContext)(),lt=function(e){var t=e.name,n=e.Icon;return r.a.createElement(it.Consumer,null,function(e){var a=e.onHeaderButtonClick;return r.a.createElement(f.a,{onClick:function(){return a(t)},style:{width:80,margin:2}},r.a.createElement("div",null,r.a.createElement(n,{style:{}}),r.a.createElement("div",{style:{fontWeight:"bold"}},t)))})},ct=n(112),st=n.n(ct),ut=n(113),gt=n.n(ut),dt=n(263),mt=n.n(dt),ht=n(162),pt=n.n(ht),ft=n(264),bt=n.n(ft),Et={header:{display:"flex",position:"relative",flexDirection:"row",flexShrink:0,zIndex:10,boxShadow:"0px 3px 8px rgba(0,0,0,.1)"},fileInfo:{flexGrow:1,alignItems:"center",display:"flex",fontWeight:"bold",color:H.grey[800],fontSize:24,paddingLeft:16}},yt=Object(l.a)(Et),vt=function(e){var t=e.onHeaderButtonClick,n=e.title,a=e.inFullScreen,o=yt();return r.a.createElement("div",{className:o.header},r.a.createElement("div",{className:o.fileInfo},n),r.a.createElement("div",{className:o.headerActions},r.a.createElement(it.Provider,{value:{onHeaderButtonClick:t}},r.a.createElement(lt,{name:"Prev",Icon:st.a}),r.a.createElement(lt,{name:"Next",Icon:gt.a}),r.a.createElement(lt,{name:"Settings",Icon:mt.a}),a?r.a.createElement(lt,{name:"Window",Icon:pt.a}):r.a.createElement(lt,{name:"Fullscreen",Icon:pt.a}),r.a.createElement(lt,{name:"Done",Icon:bt.a}))))},Ot=n(54),xt=n(55),wt=n(265),It=n.n(wt),jt=Object(a.createContext)(),Ct=function(e){var t=e.id,n=e.name,o=e.icon,i=e.selected,l=e.togglable,c=e.alwaysShowing,s=void 0!==c&&c,u=Object(a.useContext)(jt),g=u.enabledTools,d=u.selectedTool,m=u.onClickTool;return g.includes(t)||s?(i=i||d===t,r.a.createElement(It.a,{placement:"right",title:n},r.a.createElement("div",null,r.a.createElement(G.a,{disabled:l?void 0:i,"aria-label":n,onClick:function(){return m(t)},size:"small",style:{width:50,height:50,margin:1,color:i?H.blue[500]:void 0}},o)))):null},Tt=Object(l.a)({iconTools:{display:"flex",padding:4,flexDirection:"column",zIndex:9,boxShadow:"0px 0px 5px rgba(0,0,0,0.1)",borderRight:"1px solid ".concat(H.grey[300]),backgroundColor:H.grey[100]}}),Nt=function(e){var t=e.showTags,n=e.selectedTool,a=e.onClickTool,o=e.enabledTools,i=void 0===o?["select","create-point","create-box","create-polygon"]:o,l=Tt();return r.a.createElement("div",{className:l.iconTools},r.a.createElement(jt.Provider,{value:{enabledTools:i,selectedTool:n,onClickTool:a}},r.a.createElement(Ct,{id:"select",name:"Select Region",icon:r.a.createElement(Ot.a,{size:"xs",fixedWidth:!0,icon:xt.d})}),r.a.createElement(Ct,{alwaysShowing:!0,id:"pan",name:"Drag/Pan",icon:r.a.createElement(Ot.a,{size:"xs",fixedWidth:!0,icon:xt.c})}),r.a.createElement(Ct,{alwaysShowing:!0,id:"zoom",name:"Zoom In/Out",icon:r.a.createElement(Ot.a,{size:"xs",fixedWidth:!0,icon:xt.e})}),r.a.createElement(Ct,{alwaysShowing:!0,togglable:!0,id:"show-tags",selected:t,name:"Show Tags",icon:r.a.createElement(Ot.a,{size:"xs",fixedWidth:!0,icon:xt.f})}),r.a.createElement(Ct,{id:"create-point",name:"Add Point",icon:r.a.createElement(Ot.a,{size:"xs",fixedWidth:!0,icon:xt.a})}),r.a.createElement(Ct,{id:"create-box",name:"Add Bounding Box",icon:r.a.createElement(Ot.a,{size:"xs",fixedWidth:!0,icon:xt.g})}),r.a.createElement(Ct,{id:"create-polygon",name:"Add Polygon",icon:r.a.createElement(Ot.a,{size:"xs",fixedWidth:!0,icon:xt.b})})))},At={container:{display:"flex",flexGrow:1,flexDirection:"column",minHeight:"98vh",maxHeight:"100vh",backgroundColor:"#fff",overflow:"hidden","&.fullscreen":{position:"absolute",zIndex:99999,left:0,right:0,top:0,bottom:0}},workspace:{backgroundColor:H.grey[200],flexGrow:1,display:"flex",flexDirection:"row"},iconToolsContainer:{display:"flex"},imageCanvasContainer:{display:"flex",flexGrow:1,alignItems:"center",justifyContent:"center"},noImageSelected:{fontWeight:"bold",fontSize:32,color:H.grey[500]},sidebarContainer:{width:300,overflowY:"auto",backgroundColor:H.grey[100],borderLeft:"1px solid ".concat(H.grey[300]),zIndex:9,maxHeight:"calc(100% - 68px)",boxShadow:"0px 0px 5px rgba(0,0,0,0.1)"}},St=n(266),Rt=n.n(St),kt=(n(109),Object(a.createContext)({showCrosshairs:!1})),Lt=function(){return Object(a.useContext)(kt)},Dt=n(283),Mt=function(e){var t=e.open,n=e.onClose,a=Lt();return r.a.createElement(v.a,{open:t,onClose:n},r.a.createElement(x.a,null,"Settings"),r.a.createElement(I.a,{style:{minWidth:400}},r.a.createElement(Dt.a,{variant:"flat",noActions:!0,defaultAnswers:a,onQuestionChange:function(e,t,n){a.changeSetting(e,t)},form:{questions:[{type:"boolean",title:"Show Crosshairs",name:"showCrosshairs"}]}})),r.a.createElement(C.a,null,r.a.createElement(f.a,{onClick:n},"Close")))},_t=n(279),Pt=n.n(_t),Bt=Object(l.a)(At),Gt=function(e){var t=e.state,n=e.dispatch,a=Bt(),o=Lt(),i=function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];return function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return a.length>0?n(Object(L.a)({type:e},a.reduce(function(e,t,n){return e[t]=r[n],e},{}))):n(Object(L.a)({type:e},r[0]))}},l=t.images.find(function(e){return e.src===t.selectedImage});return Rt()(function(){return n({type:"CANCEL"})},{detectKeys:[27]}),r.a.createElement(Pt.a,{enabled:t.fullScreen,onChange:function(e){e||i("HEADER_BUTTON_CLICKED","buttonName")("Exit Fullscreen")}},r.a.createElement("div",{className:Y()(a.container,t.fullScreen&&"Fullscreen")},r.a.createElement("div",{className:a.headerContainer},r.a.createElement(vt,{onHeaderButtonClick:i("HEADER_BUTTON_CLICKED","buttonName"),inFullScreen:t.fullScreen,title:l?l.name:"No Image Selected"})),r.a.createElement("div",{className:a.workspace},r.a.createElement("div",{className:a.iconToolsContainer},r.a.createElement(Nt,{enabledTools:t.enabledTools,showTags:t.showTags,selectedTool:t.selectedTool,onClickTool:i("SELECT_TOOL","selectedTool")})),r.a.createElement("div",{className:a.imageCanvasContainer},t.selectedImage?r.a.createElement(ot,Object.assign({},o,{key:t.selectedImage,showTags:t.showTags,allowedArea:t.allowedArea,regionClsList:t.regionClsList,regionTagList:t.regionTagList,regions:l&&l.regions||[],imageSrc:t.selectedImage,createWithPrimary:t.selectedTool.includes("create"),dragWithPrimary:"pan"===t.selectedTool,zoomWithPrimary:"zoom"===t.selectedTool,onMouseMove:i("MOUSE_MOVE"),onMouseDown:i("MOUSE_DOWN"),onMouseUp:i("MOUSE_UP"),onChangeRegion:i("CHANGE_REGION","region"),onBeginRegionEdit:i("OPEN_REGION_EDITOR","region"),onCloseRegionEdit:i("CLOSE_REGION_EDITOR","region"),onDeleteRegion:i("DELETE_REGION","region"),onBeginBoxTransform:i("BEGIN_BOX_TRANSFORM","box","directions"),onBeginMovePolygonPoint:i("BEGIN_MOVE_POLYGON_POINT","polygon","pointIndex"),onAddPolygonPoint:i("ADD_POLYGON_POINT","polygon","point","pointIndex"),onSelectRegion:i("SELECT_REGION","region"),onBeginMovePoint:i("BEGIN_MOVE_POINT","point")})):r.a.createElement("div",{className:a.noImageSelected},"No Image Selected")),r.a.createElement("div",{className:a.sidebarContainer},r.a.createElement(Je,{debug:window.localStorage.$ANNOTATE_DEBUG_MODE&&t,taskDescription:t.taskDescription,images:t.images,regions:l&&l.regions||[],history:t.history,currentImage:l,labelImages:t.labelImages,imageClsList:t.imageClsList,imageTagList:t.imageTagList,onChangeImage:i("CHANGE_IMAGE","delta"),onSelectRegion:i("SELECT_REGION","region"),onDeleteRegion:i("DELETE_REGION","region"),onSelectImage:i("SELECT_IMAGE","image"),onChangeRegion:i("CHANGE_REGION","region"),onRestoreHistory:i("RESTORE_HISTORY")}))),r.a.createElement(Mt,{open:t.settingsOpen,onClose:function(){return n({type:"HEADER_BUTTON_CLICKED",buttonName:"Settings"})}})))},zt=n(11),Wt=n(114),Ht=n.n(Wt),Ut=function(){return Math.random().toString().split(".")[1]},Yt=function(){var e,t,n=(e=0,t=360,Math.floor(Math.random()*(t-e+1))+e);return"hsl(".concat(n,",").concat(100,"%,").concat(50,"%)")},Ft={BEGIN_BOX_TRANSFORM:"Transform/Move Box",BEGIN_MOVE_POINT:"Move Point",DELETE_REGION:"Delete Region"},Vt=function(e,t){t.type.includes("MOUSE")||(e=Object(zt.setIn)(e,["lastAction"],t));var n=e.images.findIndex(function(t){return t.src===e.selectedImage});-1===n&&(n=null);var a=function(t){var a="string"===typeof t?t:t.id;if(null===n)return null;var r=(e.images[n].regions||[]).findIndex(function(e){return e.id===a});return-1===r?null:r},r=function(t){var r=a(t);return null===r?[null,null]:[e.images[n].regions[r],r]},o=function(t,a){var o=r(t),i=Object(h.a)(o,2),l=i[0],c=i[1];if(!l)return e;if(null!==a)return Object(zt.setIn)(e,["images",n,"regions",c],Object(L.a)({},e.images[n].regions[c],a));var s=e.images[n].regions;return Object(zt.setIn)(e,["images",n,"regions"],(s||[]).filter(function(e){return e.id!==l.id}))},i=function(e){return null===n?e:Object(zt.setIn)(e,["images",n,"regions"],(e.images[n].regions||[]).map(function(e){return Object(L.a)({},e,{highlighted:!1})}))},l=function(e,t){return Object(zt.updateIn)(e,["history"],function(n){return[{time:Ge()().toDate(),state:e,name:t}].concat((n||[]).slice(0,9))})};Object.keys(Ft).includes(t.type)&&(e=l(e,Ft[t.type]||t.type));var c=function(e){return null===n?e:Object(zt.setIn)(e,["images",n,"regions"],(e.images[n].regions||[]).map(function(e){return Object(L.a)({},e,{editingLabels:!1})}))},s=function(t){return Object(zt.setIn)(e,["selectedImage"],t)};switch(t.type){case"@@INIT":return e;case"SELECT_IMAGE":return s(t.image.src);case"CHANGE_REGION":var u=a(t.region);if(null===u)return e;var g=e.images[n].regions[u];return g.cls!==t.region.cls&&(e=l(e,"Change Region Classification")),Ht()(g.tags,t.region.tags)||(e=l(e,"Change Region Tags")),Object(zt.setIn)(e,["images",n,"regions",u],t.region);case"RESTORE_HISTORY":return e.history.length>0?e.history[0].state:e;case"CHANGE_IMAGE":if(null===n)return e;for(var d=t.delta,m=Object.keys(d),p=0;p<m.length;p++){var f=m[p];"cls"===f&&l(e,"Change Image Class"),"tags"===f&&l(e,"Change Image Tags"),e=Object(zt.setIn)(e,["images",n,f],d[f])}return e;case"SELECT_REGION":var b=t.region;if(null===a(t.region))return e;var E=Object(Xe.a)(e.images[n].regions||[]).map(function(e){return Object(L.a)({},e,{highlighted:e.id===b.id,editingLabels:e.id===b.id})});return Object(zt.setIn)(e,["images",n,"regions"],E);case"BEGIN_MOVE_POINT":return e=c(e),Object(zt.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:t.point.id});case"BEGIN_BOX_TRANSFORM":var y=t.box,v=t.directions;return e=c(e),0===v[0]&&0===v[1]?Object(zt.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:y.id}):Object(zt.setIn)(e,["mode"],{mode:"RESIZE_BOX",regionId:y.id,freedom:v,original:{x:y.x,y:y.y,w:y.w,h:y.h}});case"BEGIN_MOVE_POLYGON_POINT":var O=t.polygon,x=t.pointIndex;return(e=c(e)).mode&&"DRAW_POLYGON"===e.mode.mode&&0===x?Object(zt.setIn)(o(O,{points:O.points.slice(0,-1),open:!1}),["mode"],null):(e=l(e,"Move Polygon Point"),Object(zt.setIn)(e,["mode"],{mode:"MOVE_POLYGON_POINT",regionId:O.id,pointIndex:x}));case"ADD_POLYGON_POINT":var w=t.polygon,I=t.point,j=t.pointIndex,C=a(w);if(null===C)return e;var T=Object(Xe.a)(w.points);return T.splice(j,0,I),Object(zt.setIn)(e,["images",n,"regions",C],Object(L.a)({},w,{points:T}));case"MOUSE_MOVE":var N=t.x,A=t.y;if(!e.mode)return e;if(null===n)return e;switch(e.mode.mode){case"MOVE_POLYGON_POINT":var S=e.mode,R=S.pointIndex,k=S.regionId,D=a(k);return null===D?e:Object(zt.setIn)(e,["images",n,"regions",D,"points",R],[N,A]);case"MOVE_REGION":var M=e.mode.regionId,_=a(M);return null===_?e:Object(zt.setIn)(e,["images",n,"regions",_],function(e,t,n){switch(e.type){case"point":return Object(L.a)({},e,{x:t,y:n});case"box":return Object(L.a)({},e,{x:t-e.w/2,y:n-e.h/2})}return e}(e.images[n].regions[_],N,A));case"RESIZE_BOX":var P=e.mode,B=P.regionId,G=Object(h.a)(P.freedom,2),z=G[0],W=G[1],H=P.original,U=H.x,Y=H.y,F=H.w,V=H.h,J=a(B);if(null===J)return e;var X=e.images[n].regions[J],K=0===z?U:-1===z?Math.min(U+F,N):U,Z=0===z?F:-1===z?F+(U-K):Math.max(0,F+(N-U-F)),Q=0===W?Y:-1===W?Math.min(Y+V,A):Y,q=0===W?V:-1===W?V+(Y-Q):Math.max(0,V+(A-Y-V));return Z<=.001&&(e=Object(zt.setIn)(e,["mode","freedom"],[-1*z,W])),q<=.001&&(e=Object(zt.setIn)(e,["mode","freedom"],[z,-1*W])),Object(zt.setIn)(e,["images",n,"regions",J],Object(L.a)({},X,{x:K,w:Z,y:Q,h:q}));case"DRAW_POLYGON":var $=e.mode.regionId,ee=r($),te=Object(h.a)(ee,2),ne=te[0],ae=te[1];return ne?Object(zt.setIn)(e,["images",n,"regions",ae,"points",ne.points.length-1],[N,A]):Object(zt.setIn)(e,["mode"],null)}return e;case"MOUSE_DOWN":var re,oe=t.x,ie=t.y;if(null!==n){e.images[n].regions;if(e.allowedArea){var le=e.allowedArea;if(oe<le.x||oe>le.x+le.w||ie<le.y||ie>le.y+le.h)return e}switch(e.selectedTool){case"create-point":e=l(e,"Create Point"),re={type:"point",x:oe,y:ie,highlighted:!0,editingLabels:!0,color:Yt(),id:Ut()};break;case"create-box":e=l(e,"Create Box"),re={type:"box",x:oe,y:oe,w:.01,h:.01,highlighted:!0,editingLabels:!1,color:Yt(),id:Ut()},e=i(e),e=Object(zt.setIn)(e,["mode"],{mode:"RESIZE_BOX",editLabelEditorAfter:!0,regionId:re.id,freedom:[1,1],original:{x:oe,y:ie,w:re.w,h:re.h}});break;case"create-polygon":if(e.mode&&"DRAW_POLYGON"===e.mode.mode)break;e=l(e,"Create Polygon"),re={type:"polygon",points:[[oe,ie],[oe,ie]],open:!0,highlighted:!0,color:Yt(),id:Ut()},e=Object(zt.setIn)(e,["mode"],{mode:"DRAW_POLYGON",regionId:re.id})}}if(re&&(e=i(e)),e.mode)switch(e.mode.mode){case"DRAW_POLYGON":var ce=r(e.mode.regionId),se=Object(h.a)(ce,2),ue=se[0],ge=se[1];if(!ue)break;e=Object(zt.setIn)(e,["images",n,"regions",ge],Object(L.a)({},ue,{points:ue.points.concat([[oe,ie]])}))}var de=Object(Xe.a)(e.images[n].regions||[]).map(function(e){return Object(L.a)({},e,{editingLabels:!1})}).concat(re?[re]:[]);return Object(zt.setIn)(e,["images",n,"regions"],de);case"MOUSE_UP":t.x,t.y;if(!e.mode)return e;switch(e.mode.mode){case"RESIZE_BOX":if(e.mode.editLabelEditorAfter)return Object(L.a)({},o(e.mode.regionId,{editingLabels:!0}),{mode:null});case"MOVE_REGION":case"MOVE_POLYGON_POINT":return Object(L.a)({},e,{mode:null})}return e;case"CHANGE_REGION":var me=t.region,he=a(t.region);return null===he?e:Object(zt.setIn)(e,["images",n,"regions",he],me);case"OPEN_REGION_EDITOR":t.region;var pe=a(t.region);if(null===pe)return e;var fe=Object(zt.setIn)(e.images[n].regions.map(function(e){return Object(L.a)({},e,{highlighted:!1,editingLabels:!1})}),[pe],Object(L.a)({},(e.images[n].regions||[])[pe],{highlighted:!0,editingLabels:!0}));return Object(zt.setIn)(e,["images",n,"regions"],fe);case"CLOSE_REGION_EDITOR":t.region;var be=a(t.region);return null===be?e:Object(zt.setIn)(e,["images",n,"regions",be],Object(L.a)({},(e.images[n].regions||[])[be],{editingLabels:!1}));case"DELETE_REGION":return null===a(t.region)?e:Object(zt.setIn)(e,["images",n,"regions"],(e.images[n].regions||[]).filter(function(e){return e.id!==t.region.id}));case"HEADER_BUTTON_CLICKED":switch(t.buttonName.toLowerCase()){case"prev":return null===n?e:0===n?e:s(e.images[n-1].src);case"next":return null===n?e:n===e.images.length-1?e:s(e.images[n+1].src);case"settings":return Object(zt.setIn)(e,["settingsOpen"],!e.settingsOpen);case"help":return e;case"fullscreen":return Object(zt.setIn)(e,["fullScreen"],!0);case"exit fullscreen":case"window":return Object(zt.setIn)(e,["fullScreen"],!1);case"hotkeys":return e;case"exit":case"done":return e}return e;case"SELECT_TOOL":return e=Object(zt.setIn)(e,["mode"],null),"show-tags"===t.selectedTool?Object(zt.setIn)(e,["showTags"],!e.showTags):Object(zt.setIn)(e,["selectedTool"],t.selectedTool);case"CANCEL":var Ee=e.mode;if(Ee)switch(Ee.mode){case"DRAW_POLYGON":return o(Ee.regionId,null);case"MOVE_POLYGON_POINT":case"RESIZE_BOX":case"MOVE_REGION":return Object(zt.setIn)(e,["mode"],null)}var ye=e.images[n].regions;return ye.some(function(e){return e.editingLabels})?Object(zt.setIn)(e,["images",n,"regions"],ye.map(function(e){return Object(L.a)({},e,{editingLabels:!1})})):Object(zt.setIn)(e,["images",n,"regions"],ye.map(function(e){return Object(L.a)({},e,{highlighted:!1})}))}return e},Jt=function(e){var t=e.images,n=e.allowedArea,o=e.selectedImage,i=void 0===o?t.length>0?t[0].src:void 0:o,l=e.showTags,c=void 0===l||l,s=e.enabledTools,u=void 0===s?["select","create-point","create-box","create-polygon"]:s,g=e.regionTagList,d=void 0===g?[]:g,m=e.regionClsList,p=void 0===m?[]:m,f=e.imageTagList,b=void 0===f?[]:f,E=e.imageClsList,y=void 0===E?[]:E,v=e.taskDescription,O=e.onExit,x=Object(a.useReducer)(Vt,{showTags:c,allowedArea:n,selectedImage:i,selectedTool:"select",mode:null,taskDescription:v,images:t,labelImages:y.length>0||b.length>0,regionClsList:p,regionTagList:d,imageClsList:y,imageTagList:b,enabledTools:u,history:[]}),w=Object(h.a)(x,2),I=w[0],j=w[1];return r.a.createElement(Gt,{debug:!0,state:I,dispatch:function(e){"HEADER_BUTTON_CLICKED"!==e.type||"Exit"!==e.buttonName&&"Done"!==e.buttonName&&"Complete"!==e.buttonName?j(e):O(Object(L.a)({},I,{history:void 0}))}})},Xt=n(280),Kt=n(281),Zt=n(284),Qt=n(282),qt=n(285),$t=function(e){function t(){var e,n;Object(Xt.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(Zt.a)(this,(e=Object(Qt.a)(t)).call.apply(e,[this].concat(r)))).state={hasError:!1,err:""},n}return Object(qt.a)(t,e),Object(Kt.a)(t,[{key:"componentDidCatch",value:function(e,t){this.setState({hasError:!0,err:e.toString()+"\n\n"+t.componentStack})}},{key:"render",value:function(){return this.state.hasError?r.a.createElement(v.a,{open:this.state.hasError,onClose:this.props.onClose},r.a.createElement(x.a,null,"Error Loading Annotator"),r.a.createElement(I.a,null,r.a.createElement("pre",null,this.state.err)),r.a.createElement(C.a,null,r.a.createElement(f.a,{onClick:this.props.onClose},"Close"))):this.props.children}}]),t}(a.Component);i.a.render(r.a.createElement(function(e){var t=e.children,n=d();return r.a.createElement(g.a,{theme:m},r.a.createElement("div",{className:n.container},t))},null,r.a.createElement(function(){var e=Object(a.useState)(!1),t=Object(h.a)(e,2),n=t[0],o=t[1],i=Object(a.useState)(R.Custom()),l=Object(h.a)(i,2),c=l[0],s=l[1],u=Object(a.useState)(),g=Object(h.a)(u,2),d=g[0],m=g[1];return r.a.createElement("div",null,n?r.a.createElement($t,{onClose:function(){o(!1)}},r.a.createElement(Jt,Object.assign({},c,{onExit:function(e){delete e.lastAction,m(e),o(!1)}}))):r.a.createElement(k,{lastOutput:d,onOpenAnnotator:function(e){s(e),o(!0)}}))},null)),document.getElementById("root"))}},[[292,1,2]]]);
//# sourceMappingURL=main.a18cb20e.chunk.js.map