(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{211:function(e,t,n){e.exports=n(723)},723:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(6),i=n(35),l=n.n(i),c=n(13),s=n(115),u=n(39),g=n(729),d=n(179),m=n.n(d),h=n(180),p=n.n(h),f=n(181),b=n.n(f),y=n(182),v=n.n(y),E=Object(c.a)({editBar:{padding:10,borderBottom:"1px solid #ccc",backgroundColor:"#f8f8f8",display:"flex",alignItems:"center","& .button":{margin:5}},select:{width:240,fontSize:14},contentArea:{padding:10},specificationArea:{padding:10}}),O={"Simple Bounding Box":{taskDescription:"Annotate each image according to this _markdown_ specification.",regionTagList:["has-bun"],regionClsList:["hotdog","not-hotdog"],enabledTools:["select","create-box"],images:[{src:"https://images.unsplash.com/photo-1496905583330-eb54c7e5915a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=634&q=80",name:"hot-dogs-1"}]},Custom:function(){return JSON.parse(window.localStorage.getItem("customInput")||"{}")}},x=function(e){var t=e.onOpenAnnotator,n=e.lastOutput,i=E(),c=Object(a.useState)("Simple Bounding Box"),d=Object(r.a)(c,2),h=d[0],f=d[1],y=Object(a.useState)(!1),x=Object(r.a)(y,2),I=x[0],w=x[1];return o.a.createElement("div",null,o.a.createElement("div",{className:i.editBar},o.a.createElement("h3",null,"React Image Annotate"),o.a.createElement("div",{style:{flexGrow:1}}),o.a.createElement("div",null,o.a.createElement("div",{style:{display:"inline-flex"}},o.a.createElement(u.a,{className:i.select,value:{label:h,value:h},options:Object.keys(O).map(function(e){return{label:e,value:e}}),onChange:function(e){return f(e.value)}})),o.a.createElement(l.a,{className:"button",disabled:!n,onClick:function(){return w(!0)}},"View Output"),o.a.createElement(l.a,{className:"button",variant:"outlined",onClick:function(){return t(JSON.parse(window.localStorage.getItem("customInput")))}},"Open Annotator"))),o.a.createElement("div",{className:i.contentArea},o.a.createElement("div",null,o.a.createElement(s.a,{onChange:function(e){var t=e.jsObject;window.localStorage.setItem("customInput",JSON.stringify(t)),f("Custom")},placeholder:"function"===typeof O[h]?O[h]():O[h],width:"100%",height:"550px"}))),o.a.createElement("div",{className:i.specificationArea},o.a.createElement("h2",null,"React Image Annotate Format"),o.a.createElement(g.a,{language:"javascript"},'\n{\n  taskDescription?: string, // markdown\n  regionTagList?: Array<string>,\n  regionClsList?: Array<string>,\n  imageTagList?: Array<string>,\n  imageClsList?: Array<string>,\n  // all tools are enabled by default\n  enabledTools?: Array< "select" | "create-point" | "create-box" | "create-polygon">,\n  selectedImage?: string, // initial selected image\n  images: Array<{\n    src: string,\n    thumbnailSrc?: string, // use this if you are using high-res images\n    name: string,\n    regions?: Array<{\n      id: string | number,\n      cls?: string,\n      color?: string,\n      tags?: Array<string>,\n\n      // Point\n      type: "point",\n      x: number, // [0-1] % of image width\n      y: number, // [0-1] % of image height\n\n      // Bounding Box\n      type: "box",\n      x: number, // [0-1] % of image width\n      y: number, // [0-1] % of image height\n      w: number, // [0-1] % of image width\n      h: number, // [0-1] % of image height\n\n      // Polygon\n      type: "polygon",\n      open?: boolean, // should last and first points be connected, default: true\n      points: Array<[number, number]> // [0-1] % of image width/height\n    }>\n  }>,\n}\n')),o.a.createElement(m.a,{open:I},o.a.createElement(p.a,null,"React Image Annotate Output"),o.a.createElement(b.a,null,o.a.createElement(s.a,{placeholder:n,height:"550px"})),o.a.createElement(v.a,null,o.a.createElement(l.a,{onClick:function(){return w(!1)}},"Close"))))},I=n(7),w=n(45),j=n.n(w),C=n(183),T=n.n(C),N=n(38),S=n.n(N),R=n(184),k=n.n(R),L=n(9),M=n(11),D=n.n(M),_=Object(c.a)({container:{margin:8},header:{display:"flex",flexDirection:"row",alignItems:"center",padding:8,paddingLeft:16,paddingRight:16},title:{fontSize:14,fontWeight:"bold",flexGrow:1,paddingLeft:8,color:L.grey[800],"& span":{color:L.grey[600],fontSize:12}},expandButton:{padding:0,width:30,height:30,"& .icon":{marginTop:-6,width:20,height:20,transition:"500ms transform","&.expanded":{transform:"rotate(180deg)"}}},expandedContent:{maxHeight:300,overflowY:"auto","&.noScroll":{overflowY:"visible",overflow:"visible"}}}),A=function(e){var t=e.icon,n=e.title,i=e.subTitle,l=e.children,c=e.noScroll,s=void 0!==c&&c,u=e.expandedByDefault,g=void 0!==u&&u,d=_(),m=o.a.createElement("div",{className:D()(d.expandedContent,s&&"noScroll")},l),h=Object(a.useState)(g),p=Object(r.a)(h,2),f=p[0],b=p[1];return o.a.createElement(j.a,{className:d.container},o.a.createElement("div",{className:d.header},t,o.a.createElement("div",{className:d.title},n," ",o.a.createElement("span",null,i)),o.a.createElement(S.a,{onClick:function(){return b(!f)},className:d.expandButton},o.a.createElement(T.a,{className:D()("icon",f&&"expanded")}))),s?f?m:null:o.a.createElement(k.a,{in:f},m))},P=n(186),B=n.n(P),G=n(185),z=n.n(G),W=Object(c.a)({markdownContainer:{paddingLeft:16,paddingRight:16,fontSize:12,"& h1":{fontSize:18},"& h2":{fontSize:14},"& h3":{fontSize:12},"& h4":{fontSize:12},"& h5":{fontSize:12},"& h6":{fontSize:12},"& p":{fontSize:12},"& a":{},"& img":{width:"100%"}}}),H=function(e){var t=e.description,n=W();return o.a.createElement(A,{title:"Task Description",icon:o.a.createElement(B.a,{style:{color:L.grey[700]}}),expandedByDefault:!0},o.a.createElement("div",{className:n.markdownContainer},o.a.createElement(z.a,{source:t})))},U=n(187),Y=n.n(U),V=n(75),F=n.n(V),J=n(76),X=n.n(J),Z=n(77),K=n.n(Z),$=Object(c.a)({img:{width:40,height:40,borderRadius:8}}),q=function(e){var t=e.images,n=e.onSelect,a=$();return o.a.createElement(A,{title:"Images",subTitle:"(".concat(t.length,")"),icon:o.a.createElement(Y.a,{style:{color:L.grey[700]}})},o.a.createElement("div",null,o.a.createElement(F.a,null,t.map(function(e,t){return o.a.createElement(X.a,{button:!0,onClick:function(){return n(e)},dense:!0,key:t},o.a.createElement("img",{className:a.img,src:e.src}),o.a.createElement(K.a,{primary:e.name,secondary:"".concat((e.regions||[]).length," Labels")}))}))))},Q=n(188),ee=n.n(Q),te=n(36),ne=n.n(te),ae=n(189),oe=n.n(ae),re=n(190),ie=n.n(re),le=n(57),ce=n.n(le),se=n(58),ue=n.n(se),ge=n(191),de=n.n(ge),me=n(113),he=n.n(me),pe=n(192),fe=n.n(pe),be={container:{fontSize:11,fontWeight:"bold",color:L.grey[700],"& .icon":{marginTop:4,width:16,height:16},"& .icon2":{opacity:.5,width:16,height:16,transition:"200ms opacity","&:hover":{cursor:"pointer",opacity:1}}},row:{padding:4,cursor:"pointer","&.header:hover":{backgroundColor:"#fff"},"&.highlighted":{backgroundColor:L.blue[100]},"&:hover":{backgroundColor:L.blue[50],color:L.grey[800]}},chip:{display:"flex",flexDirection:"row",padding:2,borderRadius:2,paddingLeft:4,paddingRight:4,alignItems:"center","& .color":{borderRadius:5,width:10,height:10,marginRight:4},"& .text":{}}},ye=Object(c.a)(be),ve=function(e){var t=e.color,n=e.text,a=ye();return o.a.createElement("span",{className:a.chip},o.a.createElement("div",{className:"color",style:{backgroundColor:t}}),o.a.createElement("div",{className:"text"},n))},Ee=function(e){var t=e.header,n=e.highlighted,i=e.order,l=e.classification,c=e.area,s=(e.tags,e.trash),u=e.lock,g=e.visible,d=e.onClick,m=ye(),h=Object(a.useState)(!1),p=Object(r.a)(h,2),f=(p[0],p[1]);return o.a.createElement("div",{onClick:d,onMouseEnter:function(){return f(!0)},onMouseLeave:function(){return f(!1)},className:D()(m.row,{header:t,highlighted:n})},o.a.createElement(ne.a,{container:!0,alignItems:"center"},o.a.createElement(ne.a,{item:!0,xs:2},o.a.createElement("div",{style:{textAlign:"right",paddingRight:10}},i)),o.a.createElement(ne.a,{item:!0,xs:5},l),o.a.createElement(ne.a,{item:!0,xs:2},o.a.createElement("div",{style:{textAlign:"right",paddingRight:6}},c)),o.a.createElement(ne.a,{item:!0,xs:1},s),o.a.createElement(ne.a,{item:!0,xs:1},u),o.a.createElement(ne.a,{item:!0,xs:1},g)))},Oe=function(e){var t=e.regions,n=e.onDeleteRegion,a=e.onChangeRegion,r=e.onSelectRegion,i=ye();return o.a.createElement(A,{title:"Regions",subTitle:"",icon:o.a.createElement(ee.a,{style:{color:L.grey[700]}}),expandedByDefault:!0},o.a.createElement("div",{className:i.container},o.a.createElement(Ee,{header:!0,highlighted:!1,order:o.a.createElement(oe.a,{className:"icon"}),classification:o.a.createElement("div",{style:{paddingLeft:10}},"Class"),area:o.a.createElement(ie.a,{className:"icon"}),trash:o.a.createElement(ce.a,{className:"icon"}),lock:o.a.createElement(ue.a,{className:"icon"}),visible:o.a.createElement(he.a,{className:"icon"})}),o.a.createElement("div",{style:{borderTop:"1px solid ".concat(L.grey[200]),marginTop:2,marginBottom:2}}),t.map(function(e,t){return o.a.createElement(Ee,{header:!1,highlighted:e.highlighted,onClick:function(){return r(e)},key:e.id,order:"#".concat(t+1),classification:o.a.createElement(ve,{text:e.cls||"",color:e.color||"#ddd"}),area:"",trash:o.a.createElement(ce.a,{onClick:function(){return n(e)},className:"icon2"}),lock:e.locked?o.a.createElement(ue.a,{onClick:function(){return a(Object(I.a)({},e,{locked:!1}))},className:"icon2"}):o.a.createElement(de.a,{onClick:function(){return a(Object(I.a)({},e,{locked:!0}))},className:"icon2"}),visible:e.visible||void 0===e.visible?o.a.createElement(he.a,{onClick:function(){return a(Object(I.a)({},e,{visible:!1}))},className:"icon2"}):o.a.createElement(fe.a,{onClick:function(){return a(Object(I.a)({},e,{visible:!0}))},className:"icon2"})})})))},xe=n(193),Ie=n.n(xe),we=n(194),je=n.n(we),Ce=n(112),Te=n.n(Ce),Ne=n(78),Se=n.n(Ne),Re=Object(c.a)({emptyText:{fontSize:14,fontWeight:"bold",color:L.grey[500],textAlign:"center",padding:20}}),ke=function(e){var t=e.history,n=e.onRestoreHistory,a=Re();return o.a.createElement(A,{title:"History",icon:o.a.createElement(Ie.a,{style:{color:L.grey[700]}}),expandedByDefault:!0},o.a.createElement(F.a,null,0===t.length&&o.a.createElement("div",{className:a.emptyText},"No History Yet"),t.map(function(e,t){var a=e.name,r=e.time;return o.a.createElement(X.a,{button:!0,dense:!0,key:t},o.a.createElement(K.a,{primary:a,secondary:Se()(r).format("LT")}),0===t&&o.a.createElement(je.a,{onClick:n},o.a.createElement(S.a,null,o.a.createElement(Te.a,null))))})))},Le=function(e){var t=e.state,n=e.lastAction,a=(t.images||[]).find(function(e){return e.src===t.selectedImage}),r=a?(a.regions||[]).find(function(e){return e.highlighted}):null;return o.a.createElement(A,{title:"Debug",icon:o.a.createElement("span",null),expandedByDefault:!0},o.a.createElement("div",{style:{padding:4}},o.a.createElement("div",null,o.a.createElement("b",null,"region"),":"),o.a.createElement("pre",null,JSON.stringify(r,null,"  ")),o.a.createElement("div",null,o.a.createElement("b",null,"lastAction"),":"),o.a.createElement("pre",null,JSON.stringify(n,null,"  ")),o.a.createElement("div",null,o.a.createElement("b",null,"mode"),":"),o.a.createElement("pre",null,JSON.stringify(t.mode,null,"  "))))},Me=n(195),De=n.n(Me),_e=(Object(c.a)({}),function(e){var t=e.currentImage,n=e.imageClsList,a=void 0===n?[]:n,r=e.imageTagList,i=void 0===r?[]:r,l=e.onChangeImage,c=t.tags,s=void 0===c?[]:c,g=t.cls,d=void 0===g?null:g;return o.a.createElement(A,{title:"Image Tags",expandedByDefault:!0,noScroll:!0,icon:o.a.createElement(De.a,{style:{color:L.grey[700]}})},a.length>0&&o.a.createElement("div",{style:{padding:8}},o.a.createElement(u.a,{placeholder:"Image Classification",onChange:function(e){return l({cls:e.value})},value:d?{value:d,label:d}:d,options:a.map(function(e){return{value:e,label:e}})})),i.length>0&&o.a.createElement("div",{style:{padding:8,paddingTop:0}},o.a.createElement(u.a,{isMulti:!0,placeholder:"Image Tags",onChange:function(e){return l({tags:e.map(function(e){return e.value})})},value:s.map(function(e){return{value:e,label:e}}),options:i.map(function(e){return{value:e,label:e}})})))}),Ae=Object(c.a)({}),Pe=function(e){var t=e.debug,n=e.taskDescription,a=e.images,r=e.regions,i=e.history,l=e.labelImages,c=e.currentImage,s=e.imageClsList,u=e.imageTagList,g=e.onChangeImage,d=e.onSelectRegion,m=e.onSelectImage,h=e.onChangeRegion,p=e.onDeleteRegion,f=e.onRestoreHistory;Ae();return o.a.createElement("div",null,t&&o.a.createElement(Le,{state:t,lastAction:t.lastAction}),o.a.createElement(H,{description:n}),l&&o.a.createElement(_e,{currentImage:c,imageClsList:s,imageTagList:u,onChangeImage:g,expandedByDefault:!0}),o.a.createElement(q,{onSelect:m,images:a}),o.a.createElement(Oe,{regions:r,onSelectRegion:d,onChangeRegion:h,onDeleteRegion:p}),o.a.createElement(ke,{history:i,onRestoreHistory:function(){return f()}}))},Be=n(25),Ge=n(196),ze=(n(645),{regionInfo:{fontSize:12,cursor:"default",transition:"opacity 200ms",opacity:.7,"&:hover":{opacity:.9,cursor:"pointer"},"&.highlighted":{opacity:.9,"&:hover":{opacity:1}},fontWeight:600,color:L.grey[900],padding:8,"& .name":{display:"flex",flexDirection:"row",alignItems:"center","& .circle":{marginRight:4,boxShadow:"0px 0px 2px rgba(0,0,0,0.4)",width:10,height:10,borderRadius:5}},"& .tags":{"& .tag":{color:L.grey[700],display:"inline-block",margin:1,fontSize:10,textDecoration:"underline"}}}}),We=n(197),He=n.n(We),Ue=Object(c.a)(ze),Ye=function(e){var t=e.region,n=e.editing,a=e.allowedClasses,r=void 0===a?["Laptop","Mouse","Compuda"]:a,i=e.allowedTags,c=void 0===i?["Dog","Cat","Woof","Electronic Device"]:i,s=e.onDelete,g=e.onChange,d=e.onClose,m=e.onOpen,h=Ue();return o.a.createElement(j.a,{onClick:function(){return n?null:m(t)},className:D()(h.regionInfo,{highlighted:t.highlighted})},n?o.a.createElement("div",{style:{width:200}},o.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},o.a.createElement("div",{style:{display:"flex",backgroundColor:t.color,color:"#fff",padding:4,paddingLeft:8,paddingRight:8,borderRadius:4,fontWeight:"bold",textShadow:"0px 0px 5px rgba(0,0,0,0.4)"}},t.type),o.a.createElement("div",{style:{flexGrow:1}}),o.a.createElement(S.a,{onClick:function(){return s(t)},tabIndex:-1,style:{width:22,height:22},size:"small",variant:"outlined"},o.a.createElement(ce.a,{style:{marginTop:-8,width:16,height:16}}))),r.length>0&&o.a.createElement("div",{style:{marginTop:6}},o.a.createElement(u.a,{placeholder:"Classification",onChange:function(e){return g(Object(I.a)({},t,{cls:e.value}))},value:t.cls?{label:t.cls,value:t.cls}:null,options:r.map(function(e){return{value:e,label:e}})})),c.length>0&&o.a.createElement("div",{style:{marginTop:4}},o.a.createElement(u.a,{onChange:function(e){return g(Object(I.a)({},t,{tags:e.map(function(e){return e.value})}))},placeholder:"Tags",value:(t.tags||[]).map(function(e){return{label:e,value:e}}),isMulti:!0,options:c.map(function(e){return{value:e,label:e}})})),o.a.createElement("div",{style:{marginTop:4,display:"flex"}},o.a.createElement("div",{style:{flexGrow:1}}),o.a.createElement(l.a,{onClick:function(){return d(t)},size:"small",variant:"contained",color:"primary"},o.a.createElement(He.a,null)))):o.a.createElement("div",null,t.cls&&o.a.createElement("div",{className:"name"},o.a.createElement("div",{className:"circle",style:{backgroundColor:t.color}}),t.cls),t.tags&&o.a.createElement("div",{className:"tags"},t.tags.map(function(e){return o.a.createElement("div",{key:e,className:"tag"},e)}))))},Ve=Object(c.a)({"@keyframes borderDance":{from:{strokeDashoffset:0},to:{strokeDashoffset:100}},highlightBox:{transition:"opacity 500ms","&:not(.highlighted)":{opacity:0},"&:not(.highlighted):hover":{opacity:.6},"& path":{vectorEffect:"non-scaling-stroke",strokeWidth:2,stroke:"#FFF",fill:"none",strokeDasharray:5,animationName:"$borderDance",animationDuration:"4s",animationTimingFunction:"linear",animationIterationCount:"infinite",animationPlayState:"running"}},canvas:{width:"100%",height:"100%"},transformGrabber:{width:8,height:8,border:"2px solid #FFF",position:"absolute"},zoomIndicator:{position:"absolute",bottom:0,right:0,backgroundColor:"rgba(0,0,0,0.4)",color:"#fff",opacity:.5,fontWeight:"bolder",fontSize:14,padding:4}}),Fe=[["nw-resize","n-resize","ne-resize"],["w-resize","grab","e-resize"],["sw-resize","s-resize","se-resize"]],Je=function(){return Ge.Matrix.from(1,0,0,1,-10,-10)},Xe=function(e){var t=e.regions,n=e.imageSrc,i=e.showTags,l=e.onMouseMove,c=void 0===l?function(e){return null}:l,s=e.onMouseDown,u=void 0===s?function(e){return null}:s,g=e.onMouseUp,d=void 0===g?function(e){return null}:g,m=e.dragWithPrimary,h=void 0!==m&&m,p=e.zoomWithPrimary,f=void 0!==p&&p,b=e.createWithPrimary,y=void 0!==b&&b,v=e.regionClsList,E=e.regionTagList,O=e.onChangeRegion,x=e.onBeginRegionEdit,w=e.onCloseRegionEdit,C=e.onBeginBoxTransform,T=e.onBeginMovePolygonPoint,N=e.onAddPolygonPoint,S=e.onSelectRegion,R=e.onBeginMovePoint,k=e.onDeleteRegion,L=Ve(),M=Object(a.useRef)(null),_=Object(a.useRef)(null),A=Object(a.useRef)({}),P=Object(a.useState)(!1),B=Object(r.a)(P,2),G=(B[0],B[1]),z=Object(a.useState)(!1),W=Object(r.a)(z,2),H=W[0],U=W[1],Y=Object(a.useState)(0),V=Object(r.a)(Y,2),F=V[0],J=V[1],X=Object(a.useState)(null),Z=Object(r.a)(X,2),K=Z[0],$=Z[1],q=Object(a.useState)(null),Q=Object(r.a)(q,2),ee=Q[0],te=Q[1],ne=Object(a.useRef)({x:0,y:0}),ae=Object(a.useRef)({x:0,y:0}),oe=Object(a.useState)(Je()),re=Object(r.a)(oe,2),ie=re[0],le=re[1],ce=Object(a.useRef)({}),se=(ie.applyToPoint(ne.current.x,ne.current.y),function(e){var t=A.current,n=t.iw,a=t.ih,o=function(e){switch(e.type){case"polygon":var t={x:Math.min.apply(Math,Object(Be.a)(e.points.map(function(e){var t=Object(r.a)(e,2),n=t[0];return t[1],n}))),y:Math.min.apply(Math,Object(Be.a)(e.points.map(function(e){var t=Object(r.a)(e,2);return t[0],t[1]}))),w:0,h:0};return t.w=Math.max.apply(Math,Object(Be.a)(e.points.map(function(e){var t=Object(r.a)(e,2),n=t[0];return t[1],n})))-t.x,t.h=Math.max.apply(Math,Object(Be.a)(e.points.map(function(e){var t=Object(r.a)(e,2);return t[0],t[1]})))-t.y,t;case"box":return{x:e.x,y:e.y,w:e.w,h:e.h};case"point":return{x:e.x,y:e.y,w:0,h:0};case"pixel":if(void 0!==e.sx&&void 0!==e.sy&&e.w&&e.h)return{x:e.sx,y:e.sy,w:e.w,h:e.h};if(e.points){var n={x:Math.min.apply(Math,Object(Be.a)(e.points.map(function(e){var t=Object(r.a)(e,2),n=t[0];return t[1],n}))),y:Math.min.apply(Math,Object(Be.a)(e.points.map(function(e){var t=Object(r.a)(e,2);return t[0],t[1]}))),w:0,h:0};return n.w=Math.max.apply(Math,Object(Be.a)(e.points.map(function(e){var t=Object(r.a)(e,2),n=t[0];return t[1],n})))-n.x,n.h=Math.max.apply(Math,Object(Be.a)(e.points.map(function(e){var t=Object(r.a)(e,2);return t[0],t[1]})))-n.y,n}}throw new Error("unknown region")}(e),i="point"===e.type?15:2,l={x:o.x*n-i,y:o.y*a-i,w:o.w*n+2*i,h:o.h*a+2*i};return Object(I.a)({},ie.clone().inverse().applyToPoint(l.x,l.y),{w:l.w/ie.a,h:l.h/ie.d})});Object(a.useLayoutEffect)(function(){null===_.current&&(_.current=new Image,_.current.onload=function(){G(!0)},_.current.src=n);var e=M.current,a=e.clientWidth,o=e.clientHeight;e.width=a,e.height=o;var i=e.getContext("2d");i.save(),i.transform.apply(i,Object(Be.a)(ie.clone().inverse().toArray()));var l=Math.max(_.current.naturalWidth/(a-20),_.current.naturalHeight/(o-20)),c=_.current.naturalWidth/l,s=_.current.naturalHeight/l;A.current={iw:c,ih:s,fitScale:l,canvasWidth:a,canvasHeight:o},i.drawImage(_.current,0,0,c,s),i.save(),i.globalAlpha=.5*ie.a+.5,i.lineWidth=1*ie.a+1,i.globalAlpha>.6&&(i.shadowColor="black",i.shadowBlur=4);var u=!0,g=!1,d=void 0;try{for(var m,h=function(){var e=m.value;switch(e.type){case"point":i.save(),i.beginPath(),i.strokeStyle=e.color,i.moveTo(e.x*c-10,e.y*s),i.lineTo(e.x*c-2,e.y*s),i.moveTo(e.x*c+10,e.y*s),i.lineTo(e.x*c+2,e.y*s),i.moveTo(e.x*c,e.y*s-10),i.lineTo(e.x*c,e.y*s-2),i.moveTo(e.x*c,e.y*s+10),i.lineTo(e.x*c,e.y*s+2),i.moveTo(e.x*c+5,e.y*s),i.arc(e.x*c,e.y*s,5,0,2*Math.PI),i.stroke(),i.restore();break;case"box":i.save(),i.shadowColor="black",i.shadowBlur=4,i.strokeStyle=e.color,i.strokeRect(e.x*c,e.y*s,e.w*c,e.h*s),i.restore();break;case"polygon":i.save(),i.shadowColor="black",i.shadowBlur=4,i.strokeStyle=e.color,i.beginPath(),i.moveTo(e.points[0][0]*c,e.points[0][1]*s);var t=!0,n=!1,a=void 0;try{for(var o,l=e.points[Symbol.iterator]();!(t=(o=l.next()).done);t=!0){var u=o.value;i.lineTo(u[0]*c,u[1]*s)}}catch(g){n=!0,a=g}finally{try{t||null==l.return||l.return()}finally{if(n)throw a}}e.open||i.closePath(),i.stroke(),i.restore();break;case"pixel":i.save(),ce.current[e.src]?"CANVAS"===ce.current[e.src].nodeName&&(i.globalAlpha=.6,i.drawImage(ce.current[e.src],e.sx*c,e.sy*s,e.w*c,e.h*s)):(ce.current[e.src]=new Image,ce.current[e.src].onload=function(){var t=ce.current[e.src],n=document.createElement("canvas");n.width=t.naturalWidth,n.height=t.naturalHeight;var a=n.getContext("2d");a.drawImage(t,0,0);for(var o=a.getImageData(0,0,t.naturalWidth,t.naturalHeight),i=0;i<o.data.length;i+=4){var l=o.data.slice(i,i+4),c=Object(r.a)(l,4),s=c[0],u=c[1],g=c[2],d=(c[3],s<10&&u<10&&g<10);o.data[i]=0,o.data[i+1]=0,o.data[i+2]=d?255:0,o.data[i+3]=d?255:0}a.clearRect(0,0,t.naturalWidth,t.naturalHeight),a.putImageData(o,0,0),ce.current[e.src]=n,J(F+1)},ce.current[e.src].src=e.src),i.restore()}},p=t.filter(function(e){return e.visible||void 0===e.visible})[Symbol.iterator]();!(u=(m=p.next()).done);u=!0)h()}catch(f){g=!0,d=f}finally{try{u||null==p.return||p.return()}finally{if(g)throw d}}i.restore(),i.restore()});var ge=function(e,t){var n=[t.x,t.y],a=n[0],o=n[1],r="object"===typeof e?e.to/ie.a:1+.2*e;ie.translate(a,o).scaleU(r),ie.a>2&&ie.scaleU(2/ie.a),ie.a<.1&&ie.scaleU(.1/ie.a),ie.translate(-a,-o),le(ie)},de={onMouseMove:function(e){var t=M.current.getBoundingClientRect(),n=t.left,a=t.top;ae.current.x=ne.current.x,ae.current.y=ne.current.y,ne.current.x=e.clientX-n,ne.current.y=e.clientY-a;var o=ie.applyToPoint(ne.current.x,ne.current.y);f&&K&&te(o);var r=A.current,i=r.iw,l=r.ih;c({x:o.x/i,y:o.y/l}),H&&(ie.translate(ae.current.x-ne.current.x,ae.current.y-ne.current.y),le(ie)),e.preventDefault()},onMouseDown:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.preventDefault(),1===e.button||0===e.button&&h)return U(!0);var n=ie.applyToPoint(ne.current.x,ne.current.y);if(f&&0===e.button)return $(n),void te(n);if(0===e.button){t.type,t.type;var a=A.current,o=a.iw,r=a.ih;u({x:n.x/o,y:n.y/r})}},onMouseUp:function(e){e.preventDefault();var t=ie.applyToPoint(ne.current.x,ne.current.y);if(K){var n=t;if(Math.abs(K.x-n.x)<10&&Math.abs(K.y-n.y)<10)ie.a<1?ge({to:1},ne.current):ge({to:.25},ne.current);else{var a=A.current,o=a.iw,r=a.ih;if(K.x>n.x){var i=[n.x,K.x];K.x=i[0],n.x=i[1]}if(K.y>n.y){var l=[n.y,K.y];K.y=l[0],n.y=l[1]}var c=Math.min((n.x-K.x)/o,(n.y-K.y)/r);c<.1&&(c=.1),c>10&&(c=10);var s=Je().translate(K.x,K.y).scaleU(c);le(s)}$(null),te(null)}if(1===e.button||0===e.button&&h)return U(!1);if(0===e.button){var u=A.current,g=u.iw,m=u.ih;d({x:t.x/g,y:t.y/m})}},onWheel:function(e){var t=e.deltaY>0?1:e.deltaY<0?-1:0;ge(t,ne.current),e.preventDefault()}},me=A.current,he=(me.iw,me.ih,K?Object(I.a)({},ie.clone().inverse().applyToPoint(K.x,K.y),{w:(ee.x-K.x)/ie.a,h:(ee.y-K.y)/ie.d}):null);return he&&(he.w<0&&(he.x+=he.w,he.w*=-1),he.h<0&&(he.y+=he.h,he.h*=-1)),o.a.createElement("div",{style:{width:"100%",height:"100%",position:"relative",overflow:"hidden",cursor:y?"crosshair":H?"grabbing":h?"grab":f?ie.a<1?"zoom-out":"zoom-in":void 0}},t.filter(function(e){return e.visible||void 0===e.visible}).filter(function(e){return!e.locked}).map(function(e,t){var n=se(e),i=A.current,l=i.iw,c=i.ih;return o.a.createElement(a.Fragment,null,o.a.createElement("svg",Object.assign({key:e.id,className:D()(L.highlightBox,{highlighted:e.highlighted})},de,f||h?{}:{onMouseDown:function(t){return!e.locked&&"point"===e.type&&e.highlighted&&0===t.button?R(e):0!==t.button||y?void de.onMouseDown(t):S(e)}},{style:Object(I.a)({},e.highlighted?{pointerEvents:"point"!==e.type?"none":void 0,cursor:"grab"}:{cursor:f||h||y?void 0:"pointer",pointerEvents:f||h||y&&!e.highlighted?"none":void 0},{position:"absolute",left:n.x-5,top:n.y-5,width:n.w+10,height:n.h+10})}),o.a.createElement("path",{d:"M5,5 L".concat(n.w+5,",5 L").concat(n.w+5,",").concat(n.h+5," L5,").concat(n.h+5," Z")})),"box"===e.type&&!h&&!f&&!e.locked&&e.highlighted&&ie.a<1.2&&[[0,0],[.5,0],[1,0],[1,.5],[1,1],[.5,1],[0,1],[0,.5],[.5,.5]].map(function(t,a){var i=Object(r.a)(t,2),l=i[0],c=i[1];return o.a.createElement("div",Object.assign({key:a,className:L.transformGrabber},de,{onMouseDown:function(t){if(0===t.button)return C(e,[2*l-1,2*c-1]);de.onMouseDown(t)},style:{left:n.x-4-2+n.w*l,top:n.y-4-2+n.h*c,cursor:Fe[2*c][2*l],borderRadius:.5===l&&.5===c?4:void 0}}))}),"polygon"===e.type&&!h&&!f&&!e.locked&&e.highlighted&&e.points.map(function(t,n){var a=Object(r.a)(t,2),i=a[0],s=a[1],u=ie.clone().inverse().applyToPoint(i*l,s*c);return o.a.createElement("div",Object.assign({key:n},de,{onMouseDown:function(t){if(0===t.button&&(!e.open||0===n))return T(e,n);de.onMouseDown(t)},className:L.transformGrabber,style:{cursor:e.open?0===n?"pointer":void 0:"move",pointerEvents:e.open&&n===e.points.length-1?"none":void 0,left:u.x-4,top:u.y-4}}))}),"polygon"===e.type&&e.highlighted&&!h&&!f&&!e.locked&&!e.open&&e.points.length>1&&e.points.map(function(t,n){return[t,e.points[(n+1)%e.points.length]]}).map(function(e){var t=Object(r.a)(e,2),n=t[0],a=t[1];return[(n[0]+a[0])/2,(n[1]+a[1])/2]}).map(function(t,n){var a=ie.clone().inverse().applyToPoint(t[0]*l,t[1]*c);return o.a.createElement("div",Object.assign({key:n},de,{onMouseDown:function(a){if(0===a.button)return N(e,t,n+1);de.onMouseDown(a)},className:L.transformGrabber,style:{cursor:"copy",left:a.x-4,top:a.y-4,border:"2px dotted #fff",opacity:.5}}))}))}),i&&t.filter(function(e){return e.visible||void 0===e.visible}).map(function(e){var t=se(e),n=A.current,a=(n.iw,n.ih,8);e.highlighted&&"box"===e.type&&(a+=6);var r=e.editingLabels&&!e.locked?170:40,i=t.y>r?{left:t.x,bottom:A.current.canvasHeight-t.y+a}:{left:t.x,top:t.y+t.h+a/2};return e.locked?o.a.createElement(j.a,{style:Object(I.a)({position:"absolute"},i,{zIndex:10,backgroundColor:"#fff",borderRadius:4,padding:2,paddingBottom:0,opacity:.5,pointerEvents:"none"})},o.a.createElement(ue.a,{style:{width:16,height:16,color:"#333"}})):o.a.createElement("div",Object.assign({style:Object(I.a)({position:"absolute"},i,{zIndex:10+(e.editingLabels?5:0)})},e.editingLabels?{}:de,{onMouseDown:function(e){return e.preventDefault()},onMouseUp:function(e){return e.preventDefault()},onMouseEnter:function(t){e.editingLabels&&(de.onMouseUp(t),t.button=1,de.onMouseUp(t))}}),o.a.createElement(Ye,{allowedClasses:v,allowedTags:E,onOpen:x,onChange:O,onClose:w,onDelete:k,editing:e.editingLabels,region:e}))}),f&&null!==he&&o.a.createElement("div",{style:{position:"absolute",border:"1px solid #fff",pointerEvents:"none",left:he.x,top:he.y,width:he.w,height:he.h}}),o.a.createElement("canvas",Object.assign({},de,{className:L.canvas,ref:M})),o.a.createElement("div",{className:L.zoomIndicator},(1/ie.a*100).toFixed(0),"%"))},Ze=Object(a.createContext)(),Ke=function(e){var t=e.name,n=e.Icon;return o.a.createElement(Ze.Consumer,null,function(e){var a=e.onHeaderButtonClick;return o.a.createElement(l.a,{onClick:function(){return a(t)},style:{width:80,margin:2}},o.a.createElement("div",null,o.a.createElement(n,{style:{}}),o.a.createElement("div",{style:{fontWeight:"bold"}},t)))})},$e=n(198),qe=n.n($e),Qe=n(199),et=n.n(Qe),tt=n(200),nt=n.n(tt),at=n(201),ot=n.n(at),rt={header:{display:"flex",position:"relative",flexDirection:"row",flexShrink:0,zIndex:10,boxShadow:"0px 3px 8px rgba(0,0,0,.1)"},fileInfo:{flexGrow:1,alignItems:"center",display:"flex",fontWeight:"bold",color:L.grey[800],fontSize:24,paddingLeft:16}},it=Object(c.a)(rt),lt=function(e){var t=e.onHeaderButtonClick,n=e.title,a=it();return o.a.createElement("div",{className:a.header},o.a.createElement("div",{className:a.fileInfo},n),o.a.createElement("div",{className:a.headerActions},o.a.createElement(Ze.Provider,{value:{onHeaderButtonClick:t}},o.a.createElement(Ke,{name:"Prev",Icon:qe.a}),o.a.createElement(Ke,{name:"Next",Icon:et.a}),o.a.createElement(Ke,{name:"Fullscreen",Icon:nt.a}),o.a.createElement(Ke,{name:"Done",Icon:ot.a}))))},ct=n(41),st=n(42),ut=n(202),gt=n.n(ut),dt=Object(a.createContext)(),mt=function(e){var t=e.id,n=e.name,r=e.icon,i=e.selected,l=e.togglable,c=e.alwaysShowing,s=void 0!==c&&c,u=Object(a.useContext)(dt),g=u.enabledTools,d=u.selectedTool,m=u.onClickTool;return g.includes(t)||s?(i=i||d===t,o.a.createElement(gt.a,{placement:"right",title:n},o.a.createElement(S.a,{disabled:l?void 0:i,"aria-label":n,onClick:function(){return m(t)},size:"small",style:{width:50,height:50,margin:1,color:i?L.blue[500]:void 0}},r))):null},ht=Object(c.a)({iconTools:{display:"flex",padding:4,flexDirection:"column",zIndex:9,boxShadow:"0px 0px 5px rgba(0,0,0,0.1)",borderRight:"1px solid ".concat(L.grey[300]),backgroundColor:L.grey[100]}}),pt=function(e){var t=e.showTags,n=e.selectedTool,a=e.onClickTool,r=e.enabledTools,i=void 0===r?["select","create-point","create-box","create-polygon"]:r,l=ht();return o.a.createElement("div",{className:l.iconTools},o.a.createElement(dt.Provider,{value:{enabledTools:i,selectedTool:n,onClickTool:a}},o.a.createElement(mt,{id:"select",name:"Select Region",icon:o.a.createElement(ct.a,{size:"xs",fixedWidth:!0,icon:st.d})}),o.a.createElement(mt,{alwaysShowing:!0,id:"pan",name:"Drag/Pan",icon:o.a.createElement(ct.a,{size:"xs",fixedWidth:!0,icon:st.c})}),o.a.createElement(mt,{alwaysShowing:!0,id:"zoom",name:"Zoom In/Out",icon:o.a.createElement(ct.a,{size:"xs",fixedWidth:!0,icon:st.e})}),o.a.createElement(mt,{alwaysShowing:!0,togglable:!0,id:"show-tags",selected:t,name:"Show Tags",icon:o.a.createElement(ct.a,{size:"xs",fixedWidth:!0,icon:st.f})}),o.a.createElement(mt,{id:"create-point",name:"Add Point",icon:o.a.createElement(ct.a,{size:"xs",fixedWidth:!0,icon:st.a})}),o.a.createElement(mt,{id:"create-box",name:"Add Bounding Box",icon:o.a.createElement(ct.a,{size:"xs",fixedWidth:!0,icon:st.g})}),o.a.createElement(mt,{id:"create-polygon",name:"Add Polygon",icon:o.a.createElement(ct.a,{size:"xs",fixedWidth:!0,icon:st.b})})))},ft={container:{display:"flex",flexGrow:1,flexDirection:"column",minHeight:"98vh",maxHeight:"100vh",backgroundColor:"#fff",overflow:"hidden","&.fullscreen":{position:"absolute",zIndex:99999,left:0,right:0,top:0,bottom:0}},workspace:{backgroundColor:L.grey[200],flexGrow:1,display:"flex",flexDirection:"row"},iconToolsContainer:{display:"flex"},imageCanvasContainer:{display:"flex",flexGrow:1,alignItems:"center",justifyContent:"center"},noImageSelected:{fontWeight:"bold",fontSize:32,color:L.grey[500]},sidebarContainer:{width:300,overflowY:"auto",backgroundColor:L.grey[100],borderLeft:"1px solid ".concat(L.grey[300]),zIndex:9,boxShadow:"0px 0px 5px rgba(0,0,0,0.1)"}},bt=n(203),yt=n.n(bt),vt=Object(c.a)(ft),Et=function(e){var t=e.state,n=e.dispatch,a=vt(),r=function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),o=1;o<t;o++)a[o-1]=arguments[o];return function(){for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return a.length>0?n(Object(I.a)({type:e},a.reduce(function(e,t,n){return e[t]=o[n],e},{}))):n(Object(I.a)({type:e},o[0]))}},i=t.images.find(function(e){return e.src===t.selectedImage});return yt()(function(){return n({type:"CANCEL"})},{detectKeys:[27]}),o.a.createElement("div",{className:D()(a.container,t.fullScreen&&"fullscreen")},o.a.createElement("div",{className:a.headerContainer},o.a.createElement(lt,{onHeaderButtonClick:r("HEADER_BUTTON_CLICKED","buttonName"),title:i?i.name:"No Image Selected"})),o.a.createElement("div",{className:a.workspace},o.a.createElement("div",{className:a.iconToolsContainer},o.a.createElement(pt,{enabledTools:t.enabledTools,showTags:t.showTags,selectedTool:t.selectedTool,onClickTool:r("SELECT_TOOL","selectedTool")})),o.a.createElement("div",{className:a.imageCanvasContainer},t.selectedImage?o.a.createElement(Xe,{key:t.selectedImage,showTags:t.showTags,regionClsList:t.regionClsList,regionTagList:t.regionTagList,regions:i&&i.regions||[],imageSrc:t.selectedImage,createWithPrimary:t.selectedTool.includes("create"),dragWithPrimary:"pan"===t.selectedTool,zoomWithPrimary:"zoom"===t.selectedTool,onMouseMove:r("MOUSE_MOVE"),onMouseDown:r("MOUSE_DOWN"),onMouseUp:r("MOUSE_UP"),onChangeRegion:r("CHANGE_REGION","region"),onBeginRegionEdit:r("OPEN_REGION_EDITOR","region"),onCloseRegionEdit:r("CLOSE_REGION_EDITOR","region"),onDeleteRegion:r("DELETE_REGION","region"),onBeginBoxTransform:r("BEGIN_BOX_TRANSFORM","box","directions"),onBeginMovePolygonPoint:r("BEGIN_MOVE_POLYGON_POINT","polygon","pointIndex"),onAddPolygonPoint:r("ADD_POLYGON_POINT","polygon","point","pointIndex"),onSelectRegion:r("SELECT_REGION","region"),onBeginMovePoint:r("BEGIN_MOVE_POINT","point")}):o.a.createElement("div",{className:a.noImageSelected},"No Image Selected")),o.a.createElement("div",{className:a.sidebarContainer},o.a.createElement(Pe,{debug:window.localStorage.$ANNOTATE_DEBUG_MODE&&t,taskDescription:t.taskDescription,images:t.images,regions:i&&i.regions||[],history:t.history,currentImage:i,labelImages:t.labelImages,imageClsList:t.imageClsList,imageTagList:t.imageTagList,onChangeImage:r("CHANGE_IMAGE","delta"),onSelectRegion:r("SELECT_REGION","region"),onDeleteRegion:r("DELETE_REGION","region"),onSelectImage:r("SELECT_IMAGE","image"),onChangeRegion:r("CHANGE_REGION","region"),onRestoreHistory:r("RESTORE_HISTORY")}))))},Ot=n(8),xt=n(204),It=n.n(xt),wt=function(){return Math.random().toString().split(".")[1]},jt=function(){var e,t,n=(e=0,t=360,Math.floor(Math.random()*(t-e+1))+e);return"hsl(".concat(n,",").concat(100,"%,").concat(50,"%)")},Ct={BEGIN_BOX_TRANSFORM:"Transform/Move Box",BEGIN_MOVE_POINT:"Move Point",DELETE_REGION:"Delete Region"},Tt=function(e,t){t.type.includes("MOUSE")||(e=Object(Ot.setIn)(e,["lastAction"],t));var n=e.images.findIndex(function(t){return t.src===e.selectedImage});-1===n&&(n=null);var a=function(t){var a="string"===typeof t?t:t.id;if(null===n)return null;var o=(e.images[n].regions||[]).findIndex(function(e){return e.id===a});return-1===o?null:o},o=function(t){var o=a(t);return null===o?[null,null]:[e.images[n].regions[o],o]},i=function(t,a){var i=o(t),l=Object(r.a)(i,2),c=l[0],s=l[1];if(!c)return e;if(null!==a)return Object(Ot.setIn)(e,["images",n,"regions",s],Object(I.a)({},e.images[n].regions[s],a));var u=e.images[n].regions;return Object(Ot.setIn)(e,["images",n,"regions"],(u||[]).filter(function(e){return e.id!==c.id}))},l=function(e){return null===n?e:Object(Ot.setIn)(e,["images",n,"regions"],(e.images[n].regions||[]).map(function(e){return Object(I.a)({},e,{highlighted:!1})}))},c=function(e,t){return Object(Ot.updateIn)(e,["history"],function(n){return[{time:Se()().toDate(),state:e,name:t}].concat((n||[]).slice(0,9))})};Object.keys(Ct).includes(t.type)&&(e=c(e,Ct[t.type]||t.type));var s=function(e){return null===n?e:Object(Ot.setIn)(e,["images",n,"regions"],(e.images[n].regions||[]).map(function(e){return Object(I.a)({},e,{editingLabels:!1})}))},u=function(t){return Object(Ot.setIn)(e,["selectedImage"],t)};switch(t.type){case"@@INIT":return e;case"SELECT_IMAGE":return u(t.image.src);case"CHANGE_REGION":var g=a(t.region);if(null===g)return e;var d=e.images[n].regions[g];return d.cls!==t.region.cls&&(e=c(e,"Change Region Classification")),It()(d.tags,t.region.tags)||(e=c(e,"Change Region Tags")),Object(Ot.setIn)(e,["images",n,"regions",g],t.region);case"RESTORE_HISTORY":return e.history.length>0?e.history[0].state:e;case"CHANGE_IMAGE":if(null===n)return e;for(var m=t.delta,h=Object.keys(m),p=0;p<h.length;p++){var f=h[p];"cls"===f&&c(e,"Change Image Class"),"tags"===f&&c(e,"Change Image Tags"),e=Object(Ot.setIn)(e,["images",n,f],m[f])}return e;case"SELECT_REGION":var b=t.region;if(null===a(t.region))return e;var y=Object(Be.a)(e.images[n].regions||[]).map(function(e){return Object(I.a)({},e,{highlighted:e.id===b.id,editingLabels:e.id===b.id})});return Object(Ot.setIn)(e,["images",n,"regions"],y);case"BEGIN_MOVE_POINT":return e=s(e),Object(Ot.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:t.point.id});case"BEGIN_BOX_TRANSFORM":var v=t.box,E=t.directions;return e=s(e),0===E[0]&&0===E[1]?Object(Ot.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:v.id}):Object(Ot.setIn)(e,["mode"],{mode:"RESIZE_BOX",regionId:v.id,freedom:E,original:{x:v.x,y:v.y,w:v.w,h:v.h}});case"BEGIN_MOVE_POLYGON_POINT":var O=t.polygon,x=t.pointIndex;return(e=s(e)).mode&&"DRAW_POLYGON"===e.mode.mode&&0===x?Object(Ot.setIn)(i(O,{points:O.points.slice(0,-1),open:!1}),["mode"],null):(e=c(e,"Move Polygon Point"),Object(Ot.setIn)(e,["mode"],{mode:"MOVE_POLYGON_POINT",regionId:O.id,pointIndex:x}));case"ADD_POLYGON_POINT":var w=t.polygon,j=t.point,C=t.pointIndex,T=a(w);if(null===T)return e;var N=Object(Be.a)(w.points);return N.splice(C,0,j),Object(Ot.setIn)(e,["images",n,"regions",T],Object(I.a)({},w,{points:N}));case"MOUSE_MOVE":var S=t.x,R=t.y;if(!e.mode)return e;if(null===n)return e;switch(e.mode.mode){case"MOVE_POLYGON_POINT":var k=e.mode,L=k.pointIndex,M=k.regionId,D=a(M);return null===D?e:Object(Ot.setIn)(e,["images",n,"regions",D,"points",L],[S,R]);case"MOVE_REGION":var _=e.mode.regionId,A=a(_);return null===A?e:Object(Ot.setIn)(e,["images",n,"regions",A],function(e,t,n){switch(e.type){case"point":return Object(I.a)({},e,{x:t,y:n});case"box":return Object(I.a)({},e,{x:t-e.w/2,y:n-e.h/2})}return e}(e.images[n].regions[A],S,R));case"RESIZE_BOX":var P=e.mode,B=P.regionId,G=Object(r.a)(P.freedom,2),z=G[0],W=G[1],H=P.original,U=H.x,Y=H.y,V=H.w,F=H.h,J=a(B);if(null===J)return e;var X=e.images[n].regions[J],Z=0===z?U:-1===z?Math.min(U+V,S):U,K=0===z?V:-1===z?V+(U-Z):Math.max(0,V+(S-U-V)),$=0===W?Y:-1===W?Math.min(Y+F,R):Y,q=0===W?F:-1===W?F+(Y-$):Math.max(0,F+(R-Y-F));return Object(Ot.setIn)(e,["images",n,"regions",J],Object(I.a)({},X,{x:Z,w:K,y:$,h:q}));case"DRAW_POLYGON":var Q=e.mode.regionId,ee=o(Q),te=Object(r.a)(ee,2),ne=te[0],ae=te[1];return ne?Object(Ot.setIn)(e,["images",n,"regions",ae,"points",ne.points.length-1],[S,R]):Object(Ot.setIn)(e,["mode"],null)}return e;case"MOUSE_DOWN":var oe,re=t.x,ie=t.y;if(null!==n){e.images[n].regions;switch(e.selectedTool){case"create-point":e=c(e,"Create Point"),oe={type:"point",x:re,y:ie,highlighted:!0,editingLabels:!0,color:jt(),id:wt()};break;case"create-box":e=c(e,"Create Box"),oe={type:"box",x:re,y:re,w:.01,h:.01,highlighted:!0,editingLabels:!1,color:jt(),id:wt()},e=l(e),e=Object(Ot.setIn)(e,["mode"],{mode:"RESIZE_BOX",editLabelEditorAfter:!0,regionId:oe.id,freedom:[1,1],original:{x:re,y:ie,w:oe.w,h:oe.h}});break;case"create-polygon":if(e.mode&&"DRAW_POLYGON"===e.mode.mode)break;e=c(e,"Create Polygon"),oe={type:"polygon",points:[[re,ie],[re,ie]],open:!0,highlighted:!0,color:jt(),id:wt()},e=Object(Ot.setIn)(e,["mode"],{mode:"DRAW_POLYGON",regionId:oe.id})}}if(oe&&(e=l(e)),e.mode)switch(e.mode.mode){case"DRAW_POLYGON":var le=o(e.mode.regionId),ce=Object(r.a)(le,2),se=ce[0],ue=ce[1];if(!se)break;e=Object(Ot.setIn)(e,["images",n,"regions",ue],Object(I.a)({},se,{points:se.points.concat([[re,ie]])}))}var ge=Object(Be.a)(e.images[n].regions||[]).map(function(e){return Object(I.a)({},e,{editingLabels:!1})}).concat(oe?[oe]:[]);return Object(Ot.setIn)(e,["images",n,"regions"],ge);case"MOUSE_UP":t.x,t.y;if(!e.mode)return e;switch(e.mode.mode){case"RESIZE_BOX":if(e.mode.editLabelEditorAfter)return Object(I.a)({},i(e.mode.regionId,{editingLabels:!0}),{mode:null});case"MOVE_REGION":case"MOVE_POLYGON_POINT":return Object(I.a)({},e,{mode:null})}return e;case"CHANGE_REGION":var de=t.region,me=a(t.region);return null===me?e:Object(Ot.setIn)(e,["images",n,"regions",me],de);case"OPEN_REGION_EDITOR":t.region;var he=a(t.region);if(null===he)return e;var pe=Object(Ot.setIn)(e.images[n].regions.map(function(e){return Object(I.a)({},e,{highlighted:!1,editingLabels:!1})}),[he],Object(I.a)({},(e.images[n].regions||[])[he],{highlighted:!0,editingLabels:!0}));return Object(Ot.setIn)(e,["images",n,"regions"],pe);case"CLOSE_REGION_EDITOR":t.region;var fe=a(t.region);return null===fe?e:Object(Ot.setIn)(e,["images",n,"regions",fe],Object(I.a)({},(e.images[n].regions||[])[fe],{editingLabels:!1}));case"DELETE_REGION":return null===a(t.region)?e:Object(Ot.setIn)(e,["images",n,"regions"],(e.images[n].regions||[]).filter(function(e){return e.id!==t.region.id}));case"HEADER_BUTTON_CLICKED":switch(t.buttonName.toLowerCase()){case"prev":return null===n?e:0===n?e:u(e.images[n-1].src);case"next":return null===n?e:n===e.images.length-1?e:u(e.images[n+1].src);case"settings":case"help":return e;case"fullscreen":return Object(Ot.setIn)(e,["fullScreen"],!e.fullScreen);case"hotkeys":return e;case"exit":case"done":return e}return e;case"SELECT_TOOL":return e=Object(Ot.setIn)(e,["mode"],null),"show-tags"===t.selectedTool?Object(Ot.setIn)(e,["showTags"],!e.showTags):Object(Ot.setIn)(e,["selectedTool"],t.selectedTool);case"CANCEL":var be=e.mode;if(be)switch(be.mode){case"DRAW_POLYGON":return i(be.regionId,null);case"MOVE_POLYGON_POINT":case"RESIZE_BOX":case"MOVE_REGION":return Object(Ot.setIn)(e,["mode"],null)}var ye=e.images[n].regions;return ye.some(function(e){return e.editingLabels})?Object(Ot.setIn)(e,["images",n,"regions"],ye.map(function(e){return Object(I.a)({},e,{editingLabels:!1})})):Object(Ot.setIn)(e,["images",n,"regions"],ye.map(function(e){return Object(I.a)({},e,{highlighted:!1})}))}return e},Nt=function(e){var t=e.images,n=e.selectedImage,i=void 0===n?t.length>0?t[0].src:void 0:n,l=e.showTags,c=void 0===l||l,s=e.enabledTools,u=void 0===s?["select","create-point","create-box","create-polygon"]:s,g=e.regionTagList,d=void 0===g?[]:g,m=e.regionClsList,h=void 0===m?[]:m,p=e.imageTagList,f=void 0===p?[]:p,b=e.imageClsList,y=void 0===b?[]:b,v=e.taskDescription,E=e.onExit,O=Object(a.useReducer)(Tt,{showTags:c,selectedImage:i,selectedTool:"select",mode:null,taskDescription:v,images:t,labelImages:y.length>0||f.length>0,regionClsList:h,regionTagList:d,imageClsList:y,imageTagList:f,enabledTools:u,history:[]}),x=Object(r.a)(O,2),w=x[0],j=x[1];return o.a.createElement(Et,{debug:!0,state:w,dispatch:function(e){"HEADER_BUTTON_CLICKED"!==e.type||"Exit"!==e.buttonName&&"Done"!==e.buttonName&&"Complete"!==e.buttonName?j(e):E(Object(I.a)({},w,{history:void 0}))}})},St=function(){var e=Object(a.useState)(!1),t=Object(r.a)(e,2),n=t[0],i=t[1],l=Object(a.useState)({}),c=Object(r.a)(l,2),s=c[0],u=c[1],g=Object(a.useState)(),d=Object(r.a)(g,2),m=d[0],h=d[1];return o.a.createElement("div",null,n?o.a.createElement(Nt,Object.assign({},s,{onExit:function(e){delete e.lastAction,h(e),i(!1)}})):o.a.createElement(x,{lastOutput:m,onOpenAnnotator:function(e){u(e),i(!0)}}))};t.default=function(){return o.a.createElement(St,null)}}},[[211,2,1]]]);
//# sourceMappingURL=main.e2e07580.chunk.js.map